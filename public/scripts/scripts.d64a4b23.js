"use strict";!function(a){var b={nodiff:"",year:"Year",years:"Years",month:"Month",months:"Months",day:"Day",days:"Days",hour:"Hour",hours:"Hours",minute:"Minute",minutes:"Minutes",second:"Second",seconds:"Seconds",delimiter:" "};a.fn.preciseDiff=function(b,c){return"break"!==c?a.preciseDiff(this,b):"break"===c?a.preciseDiff(this,b,"break"):void 0},a.preciseDiff=function(c,d,e){function f(a,c){return a+" "+b[c+(1===a?"":"s")]}var g=a(c),h=a(d);if(g.isSame(h))return b.nodiff;if(g.isAfter(h)){var i=g;g=h,h=i}var j=h.year()-g.year(),k=h.month()-g.month(),l=h.date()-g.date(),m=h.hour()-g.hour(),n=h.minute()-g.minute(),o=h.second()-g.second();if(0>o&&(o=60+o,n--),0>n&&(n=60+n,m--),0>m&&(m=24+m,l--),0>l){var p=a(h.year()+"-"+(h.month()+1),"YYYY-MM").subtract(1,"month").daysInMonth();l=p<g.date()?p+l+(g.date()-p):p+l,k--}0>k&&(k=12+k,j--);var q=[];return j&&q.push(f(j,"year")),k&&q.push(f(k,"month")),l&&q.push(f(l,"day")),m&&q.push(f(m,"hour")),n&&(m||q.push(f(n,"minute"))),"break"===e&&(b.delimiter="<br>"),q.join(b.delimiter)}}(moment),function(a){var b={nodiff:"",year:"Year",years:"Years",month:"Month",months:"Months",day:"Day",days:"Days",hour:"Hour",hours:"Hours",minute:"Minute",minutes:"Minutes",second:"Second",seconds:"Seconds",delimiter:" "};a.fn.shortDiff=function(b,c){return"break"!==c?a.shortDiff(this,b):"break"===c?a.shortDiff(this,b,"break"):void 0},a.shortDiff=function(c,d,e){function f(a,c){return a+" "+b[c+(1===a?"":"s")]}var g=a(c),h=a(d);if(g.isSame(h))return b.nodiff;if(g.isAfter(h)){var i=g;g=h,h=i}var j=h.year()-g.year(),k=h.month()-g.month(),l=h.date()-g.date(),m=h.hour()-g.hour(),n=h.minute()-g.minute(),o=h.second()-g.second();if(0>o&&(o=60+o,n--),0>n&&(n=60+n,m--),0>m&&(m=24+m,l--),0>l){var p=a(h.year()+"-"+(h.month()+1),"YYYY-MM").subtract(1,"month").daysInMonth();l=p<g.date()?p+l+(g.date()-p):p+l,k--}0>k&&(k=12+k,j--);var q=[];return j&&q.push(f(j,"year")),k&&q.push(f(k,"month")),l&&q.push(f(l,"day")),m&&(l||q.push(f(m,"hour"))),n&&(m||q.push(f(n,"minute"))),"break"===e&&(b.delimiter="<br>"),q.join(b.delimiter)}}(moment);var SunCalc={};!function(){function a(a){return a.valueOf()/z-.5+A}function b(a){return new Date((a+.5-A)*z)}function c(b){return a(b)-B}function d(a,b){return w(s(a)*t(C)-u(b)*s(C),t(a))}function e(a,b){return v(s(b)*t(C)+t(b)*s(C)*s(a))}function f(a,b,c){return w(s(a),t(a)*s(b)-u(c)*t(b))}function g(a,b,c){return v(s(b)*s(c)+t(b)*t(c)*t(a))}function h(a,b){return y*(280.16+360.9856235*a)-b}function i(a){return y*(357.5291+.98560028*a)}function j(a){var b=y*(1.9148*s(a)+.02*s(2*a)+3e-4*s(3*a)),c=102.9372*y;return a+b+c+r}function k(a){var b=i(a),c=j(b);return{dec:e(c,0),ra:d(c,0)}}function l(a,b){return Math.round(a-E-b/(2*r))}function m(a,b,c){return E+(a+b)/(2*r)+c}function n(a,b,c){return B+a+.0053*s(b)-.0069*s(2*c)}function o(a,b,c){return x((s(a)-s(b)*s(c))/(t(b)*t(c)))}function p(a,b,c,d,e,f,g){var h=o(a,c,d),i=m(h,b,e);return n(i,f,g)}function q(a){var b=y*(218.316+13.176396*a),c=y*(134.963+13.064993*a),f=y*(93.272+13.22935*a),g=b+6.289*y*s(c),h=5.128*y*s(f),i=385001-20905*t(c);return{ra:d(g,h),dec:e(g,h),dist:i}}var r=Math.PI,s=Math.sin,t=Math.cos,u=Math.tan,v=Math.asin,w=Math.atan2,x=Math.acos,y=r/180,z=864e5,A=2440588,B=2451545,C=23.4397*y;SunCalc.getPosition=function(a,b,d){var e=y*-d,i=y*b,j=c(a),l=k(j),m=h(j,e)-l.ra;return{azimuth:f(m,i,l.dec),altitude:g(m,i,l.dec)}};var D=SunCalc.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];SunCalc.addTime=function(a,b,c){D.push([a,b,c])};var E=9e-4;SunCalc.getTimes=function(a,d,f){var g,h,k,o,q,r=y*-f,s=y*d,t=c(a),u=l(t,r),v=m(0,r,u),w=i(v),x=j(w),z=e(x,0),A=n(v,w,x),B={solarNoon:b(A),nadir:b(A-.5)};for(g=0,h=D.length;h>g;g+=1)k=D[g],o=p(k[0]*y,r,s,z,u,w,x),q=A-(o-A),B[k[1]]=b(q),B[k[2]]=b(o);return B},SunCalc.getMoonPosition=function(a,b,d){var e=y*-d,i=y*b,j=c(a),k=q(j),l=h(j,e)-k.ra,m=g(l,i,k.dec);return m+=.017*y/u(m+10.26*y/(m+5.1*y)),{azimuth:f(l,i,k.dec),altitude:m,distance:k.dist}},SunCalc.getMoonIllumination=function(a){var b=c(a),d=k(b),e=q(b),f=149598e3,g=x(s(d.dec)*s(e.dec)+t(d.dec)*t(e.dec)*t(d.ra-e.ra)),h=w(f*s(g),e.dist-f*t(g)),i=w(t(d.dec)*s(d.ra-e.ra),s(d.dec)*t(e.dec)-t(d.dec)*s(e.dec)*t(d.ra-e.ra));return{fraction:(1+t(h))/2,phase:.5+.5*h*(0>i?-1:1)/Math.PI,angle:i}},"function"==typeof define&&define.amd?define(SunCalc):"undefined"!=typeof module?module.exports=SunCalc:window.SunCalc=SunCalc}(),angular.module("cloakroomApp.parseWrappers",[]).factory("FacebookAngularPatch",["$q","$window","$timeout",function(a,b,c){var d=a.defer(),e=d.promise;b.fbAsyncInit=function(){d.resolve(b.FB)};var f=function(){var b=[].splice.call(arguments,0),d=a.defer(),f=c;return e.then(function(a){b.push(function(a){return _.isUndefined(a.error)?void f(function(){d.resolve(a)}):void f(function(){d.reject(a.error)})}),a.api.apply(a,b)}),d.promise};return e.then(function(a){a.apiAngular=f}),{getFacebookSDK:e}}]),angular.module("cloakroomApp.parseWrappers").factory("ParseSDK",["FacebookAngularPatch",function(a){Parse.initialize("Aei0OqEhpTIYENRvjm926yigPR6r9poODYXX3wg2","BjjYxkhiZ8IWPE6wo6K7edBA0vqsJO45pa6DADya"),a.getFacebookSDK.then(function(){Parse.FacebookUtils.init({appId:0xe384c380e667,channelUrl:"//www.cloakroom.me/channel.html",cookie:!0,xfbml:!1,frictionlessRequests:!0})})}]),angular.module("angular-log-table",[]).config(["$provide",function(a){a.decorator("$log",["$delegate",function(a){return a.table=function(){var b=[].slice.call(arguments);window.console&&window.console.table?console.table(b[0],b[1]):a.log(null,b)},a}])}]);var utilities=angular.module("cloakroom.utilities",["angular-log-table","ui.router"]),utilities=angular.module("cloakroom.utilities");utilities.service("crLog",["$log",function(a){var b={loggers:{log:log,table:a.table,error:a.error,info:log,debug:log}};this.create=function(a,c,d){var e=function(a,c,d){var e=function(a){var b,c="	";if(!_.isUndefined(a)&&!_.isNull(a)&&_.isNumber(a)&&a>0){for(var d=a;d>0;d--)_.isUndefined(b)||_.isNull(b)?b=c:b+=c;return b}return""},f=function(){return a+":"},g=function(a,b,c){return _.isUndefined(a)||_.isNull(a)||!_.isString(a)?a:!_.isUndefined(b)&&!_.isNull(b)&&_.isNumber(b)&&b>0?c?f()+e(b)+a:e(b)+f()+a:f()+a},h=function(a,b){return'[c="color:'+a+'"]'+b+"[c]"};this.info=function(a,e){return c?b.loggers.info(_.isUndefined(d)||_.isNull(d)?g(a,e):h(d,g(a,e))):void 0},this.debug=function(a,c){return b.loggers.debug(g(a,c))},this.error=function(a,c){return b.loggers.error(g(a,c))},this.table=function(a){return b.loggers.table(a)},this.json=function(a,b,c){return c?this.info(b+"\n		"+JSON.stringify(a)):(this.info(b),this.info(a),!0)},this.log=function(a,b,c,d){switch(a){case"info":return this.info(b,c);case"debug":return this.debug(b,c);case"error":return this.error(b,c);case"table":return this.table(b);case"json":return this.table(b,c,d);default:return this.debug(b,c)}}};return new e(a,c,d)}}]);var utilities=angular.module("cloakroom.utilities");utilities.service("cr",["$log","$q","crLog",function(){this.exists=function(a){return!_.isUndefined(a)&&!_.isNull(a)}}]);var utilities=angular.module("cloakroom.utilities");utilities.service("crTimeout",["$log",function(a){this.register=function(b){a.error(b+" should work")}}]);var utilities=angular.module("cloakroom.utilities");utilities.service("crPrivateBrowsing",["$rootScope","$log","$q","cr","$state",function(a,b,c,d){var e=this,f=["event.detail","login"];this.privateBrowsingStatus={safeStates:f,isPrivateBrowsing:void 0,watching:!1};var g=function(){var a,b;try{return a=new Date,localStorage.setItem(a,a.toString()),b=localStorage.getItem(a)===a.toString(),localStorage.removeItem(a),b}catch(c){}};this.check=function(){if(d.exists(e.privateBrowsingStatus)&&d.exists(e.privateBrowsingStatus.isPrivateBrowsing))return e.privateBrowsingStatus.isPrivateBrowsing;var a=!g();return d.exists(e.privateBrowsingStatus)?e.privateBrowsingStatus.isPrivateBrowsing=a:e.privateBrowsingStatus={safeStates:f,isPrivateBrowsing:a},a};var h=function(a,b){if(d.exists(a)&&_.isFunction(a))return a.call(b);throw"no alertMethod or alertMethod not a function"};this.alert=h;var i=function(c){var g=d.exists(e.privateBrowsingStatus.watching)&&e.privateBrowsingStatus.watching===!0;if(g){if(!d.exists(e.privateBrowsingStatus.watching))throw"watching property does not exist"}else b.debug("cr.privateBrowsing: setting up watcher"),a.$on("$stateChangeStart",function(a,g){var h=g.name;if(_.contains(f,h)){if(d.exists(f)&&_.isArray(f))return b.debug("state is safe, not checking if private browsing");throw"private browsing safe states list undefined or not array"}var i=e.check();if(i){var j=["Private Browsing Error","Unfortunately, due to technical limitations iOS devices in private browsing mode enabled are unable to continue.<br><br>Please <strong>disable private browsing mode</strong> and <strong>reload this page</strong> to retry."];return e.alert(c,j)}}),e.privateBrowsingStatus.watching=!0};this.setup=i}]),angular.module("cloakroomApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","cloakroomApp.parseWrappers","angular-log-table","ui.router","ui.bootstrap","duScroll","oc.lazyLoad","cfp.loadingBar","parse-angular","cloakroom.utilities","parse-angular.enhance","LocalForageModule","snap","sun.scrollable","pasvaz.bindonce","angulartics","angulartics.google.analytics"]);var CLOAKROOM_IN_DEVELOPMENT=!1,CLOAKROOM_DESIGN_MODE=!1;if(angular.module("cloakroomApp").constant("CLOAKROOM_IN_DEVELOPMENT",CLOAKROOM_IN_DEVELOPMENT),angular.module("cloakroomApp").constant("CLOAKROOM_DESIGN_MODE",CLOAKROOM_DESIGN_MODE),angular.module("cloakroomApp").constant("FORCE_ENABLE_SNAP_DRAWERS",!1),CLOAKROOM_IN_DEVELOPMENT)console.debug("Cloakroom is in Development Mode.");else{var light="'background-color: #000; color: #fff; font-family: 'Helvetica Neue', 'Helvetica', sans-serif; font-size: 3rem; font-weight: 100;'",regular="'background-color: #000; color: #fff; font-family: 'Helvetica Neue', 'Helvetica', sans-serif; font-size: 3rem; font-weight: 300;'",bold="'background-color: #000; color: #fff; font-family: 'Helvetica Neue', 'Helvetica', sans-serif; font-size: 3rem; font-weight: 500;'";log("[c="+light+"]We [c][c="+regular+"]Change[c][c="+light+"] At [c][c="+bold+"]Night[c]\n\n")}var stringOnly=/^[A-Za-z]+$/,ukPhone=/^\(?(?:(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?\(?(?:0\)?[\s-]?\(?)?|0)(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}|\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4}|\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3})|\d{5}\)?[\s-]?\d{4,5}|8(?:00[\s-]?11[\s-]?11|45[\s-]?46[\s-]?4\d))(?:(?:[\s-]?(?:x|ext\.?\s?|\#)\d+)?)$/,intPhoneNumber=/^\s*(?:\+?(\d{1,3}))?[-. (]*(\d{3})[-. )]*(\d{3})[-. ]*(\d{4})(?: *x(\d+))?\s*$/g,validPassword=/^[a-zA-Z0-9]+$/g,emailAddress=/[^\s@]+@[^\s@]+\.[^\s@]+/g,timeFormats={shortest:"HH:mm",hms:"HH:mm:ss",hmdm:"HH:mm DD/MM",pretty:"dddd, Do MMMM YYYY, HH:mm:ss",full:"HH:mm:ss DD/MM/YYYY"};angular.module("cloakroomApp").constant("INT_PHONE_REGEX",intPhoneNumber),angular.module("cloakroomApp").constant("EMAIL_REGEX",emailAddress),angular.module("cloakroomApp").constant("STRING_ONLY_REGEX",stringOnly),angular.module("cloakroomApp").constant("UK_MOBILE_REGEX",ukPhone),angular.module("cloakroomApp").constant("VALID_PASSWORD_REGEX",validPassword),angular.module("cloakroomApp").constant("CLOAKROOM_PHOTO_CDN_URL","http://www.ucarecdn.com/"),angular.module("cloakroomApp").constant("CLOAKROOM_TIME_STRINGS",timeFormats),angular.module("cloakroomApp").controller("MasterCtrl",["$q","$document","$log","crLog","$rootScope","$location","$state","$stateParams","$timeout","CLOAKROOM_IN_DEVELOPMENT","FORCE_ENABLE_SNAP_DRAWERS","ModalInterface","snapRemote","CacheService","ApplicationService","ParseSDK","UserService","AuthenticationService","ParseUser","FacebookAuthentication","MemberLinkService","cfpLoadingBar","SignupService","StatusService","ErrorInterface","memberNotification","TitleService","crPrivateBrowsing",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){var C=this,D=d.create("MasterCtrl",!1,"tomato");B.setup(y.popup);var E=function(){e.currentUser=q.currentUser,Parse.User.current()&&(q.currentUser.isLogged||s.initUserService());var a=moment(q.currentUser.lastUpdated).isBefore(moment().subtract("5","minutes"));q.currentUser.isLogged&&!_.isUndefined(q.currentUser.lastUpdated)&&!_.isNull(q.currentUser.lastUpdated)&&a&&(D.info(" User data is outdated, refreshing using Parse.User.current().fetch"),Parse.User.current().fetch().then(function(){return s.setParseUser({force:!0})},function(a){D.error(a),D.error("Unable to fetch current parse user")}).then(function(){D.info(" successfully refreshed current parse user"),e.currentUser=q.currentUser},function(a){D.error(a),D.error(" failed to refresh current parse user")}))};e.logout=function(){var a={softCancel:!1,text:"Are you sure you want to <strong>log out</strong> from cloakroom?",title:"Log Out",yesText:"Log Out",size:"sm",noText:"Cancel",showNoButton:!0};l.yesNo(a).then(function(){D.error("User has Logged Out of Cloakroom"),r.logout().then(function(){e.currentParseUser=null,q.resetUser(),e.applicationCache=null,e.facebookControls=null,e.newMember=null,e.linkCache=null,e.linkedGuestlistsCache=null,z.clear(),x.reset(),n.clearAll().then(function(a){c.info("Successfully Logged Out: "+JSON.stringify(a)),f.path("/login")},function(a){D.error("Logout: Failed to Logged Out: "+a),f.path("/login")})},function(a){D.error(a)})},function(){D.error("User cancelled logout")})},E(),this.autoRefresh={waitingForFinish:!1,timesTried:0,startWaiting:function(a,b,c,d,e){C.autoRefresh.waitingForFinish=!0,D.info("started to wait for state change finish");var f=function(a,b,c){C.autoRefresh.waitingForFinish?!_.isUndefined(C.autoRefresh.timesTried)&&!_.isNull(C.autoRefresh.timesTried)&&C.autoRefresh.timesTried>0?(D.info("already retried state, now redirecting to home or login if appropriate"),C.autoRefresh.timesTried++,y.popup("Connection Problems","We have detected that you are experiencing connection problems and are automatically redirecting you to your home page. <br>Sorry for the inconvenience!"),_.isUndefined(C.autoRefresh.promiseRef)||_.isNull(C.autoRefresh.promiseRef)||i.cancel(C.autoRefresh.promiseRef),"home"!==b.name?(C.autoRefresh.waitingForFinish=!1,g.go("home")):(C.autoRefresh.waitingForFinish=!1,D.info("already trying to go home"),g.go("error",{id:1}))):(D.info("retrying this state as it is first time"),C.autoRefresh.timesTried++,C.autoRefresh.waitingForFinish=!1,g.go(b.name,c,{reload:!0})):(C.autoRefresh.waitingForFinish=!1,D.info("finished loading so no autorefresh needed"))};C.autoRefresh.promiseRef=0!==C.autoRefresh.timesTried?i(function(){return f(a,b,c,d,e)},7e3):_.isUndefined(b)||_.isNull(b)||_.isUndefined(b.name)||_.isNull(b.name)||!(Parse.User.current()&&"home"===b.name||!Parse.User.current()&&"login"===b.name)?i(function(){return f(a,b,c,d,e)},1e4):i(function(){return f(a,b,c,d,e)},14e3)},stopWaiting:function(){_.isUndefined(C.autoRefresh.promiseRef)||_.isNull(C.autoRefresh.promiseRef)||i.cancel(C.autoRefresh.promiseRef),C.autoRefresh.timesTried=0,C.autoRefresh.waitingForFinish=!1,D.info("stopped waiting for state change finish and reset timesTried to 0")}},e.$on("$stateChangeStart",function(a,b,c,d,f){D.info("LOADING START: state change to "+b.name+" from "+d.name),v.start(),e.checkHeaderVisibility=function(){var a=["login"];return _(a).contains(b.name)?!1:!0},_.isUndefined(C.autoRefresh)||_.isNull(C.autoRefresh)||_.isUndefined(C.autoRefresh.startWaiting)||_.isNull(C.autoRefresh.startWaiting)||!_.isFunction(C.autoRefresh.startWaiting)||_.debounce(function(){return C.autoRefresh.startWaiting(a,b,c,d,f)},1e3,{leading:!0})()}),e.$on("$stateChangeSuccess",function(){D.info("LOADING FINISHED: state change"),C.autoRefresh.stopWaiting(),v.complete(),E()}),j||e.$on("$stateChangeStart",function(){b.scrollTop(0,50)}),e.$on("$stateChangeSuccess",function(a,b){var c=["login","error","event.detail","event.apply","event.confirmation","profile","membership.new","membership.alias","membership.mobile","alias"],d=function(a){return _(c).contains(a)?!0:!1};q.currentUser.isLogged||d(b.name)||("alias"===b.name?w.status.pickingAlias===!1&&(y.popup("Uhh...","Sorry, you seem to be in the wrong place. Redirecting you."),D.error("Redirecting to home"),f.path("/login")):(D.error("You need to be logged in to view that page! Redirecting to home"),_.isUndefined(b.name)||_.isNull(b.name)?g.go("login"):"login"!==b.name?f.path("/login"):D.error("already going to login")))}),e.$on("$stateChangeStart",function(a,b){"membership.new"!==b.name&&"alias"!==b.name||!q.currentUser.isLogged||(D.error("User trying to initiate create membership, but already logged in - redirecting."),h.inv=null,f.url(f.path("/home")))});e.$on("$stateChangeSuccess",function(a,b){q.currentUser.isLogged&&z.getNotifications(),e.pageDescription=A.currentDescription;var c=["event","event.detail","event.apply","event.confirmation"];_.isUndefined(b.name)||_.isNull(b.name)||!_.contains(c,b.name)?A.setImage(A.defaultImage):e.pageImage=A.currentImage}),e.$on("$stateChangeStart",function(){m.getSnapper("main").then(function(a){"left"===a.state().state&&a.close()},function(a){D.error(a)})}),e.$on("$stateChangeSuccess",function(){m.getSnapper("main").then(function(a){"left"===a.state().state&&a.close(),q.currentUser.isLogged||k?a.enable():(a.close(),a.disable())},function(a){D.error(a)})})}]),angular.module("cloakroomApp").service("TitleService",["$rootScope",function(a){var b=this;this.currentTitle="Cloakroom - weCAN.",this.currentDescription="Exclusive Nightlife Platform",this.currentImage="http://m.cloakroom.me/apple152.png",this.defaultImage="http://m.cloakroom.me/apple152.png",this.setTitle=function(c){var d=c+" - Cloakroom";b.currentTitle=d,a.pageTitle=d},this.setDescription=function(c){var d=c+" on Cloakroom";b.currentDescription=d,a.pageDescription=d},this.setImage=function(c){var d=c;b.currentImage=d,a.pageImage=d}}]),angular.module("cloakroomApp").service("CacheService",["$q","$log","$localForage","cr","crLog","CloudCode","CLOAKROOM_TIME_STRINGS",function(a,b,c,d,e,f,g){var h=e.create("CacheService",!0,"green"),i=this;this.cacheStatus={loaded:!1};var j={DEFAULT_EXPIRY:moment.duration(5,"minutes").asMilliseconds()},k={members:{defaultExpiry:moment.duration(1,"hour").asMilliseconds(),data:{},populated:!1},links:{defaultExpiry:moment.duration(5,"minutes").asMilliseconds(),data:{},populated:!1},getRecentActivities:{defaultExpiry:moment.duration(5,"minutes").asMilliseconds(),data:{},populated:!1},applications:{defaultExpiry:moment.duration(5,"minutes").asMilliseconds(),data:{},populated:!1},signup:{defaultExpiry:moment.duration(1,"hour").asMilliseconds(),data:{},populated:!1},invitation:{defaultExpiry:moment.duration(1,"week").asMilliseconds(),data:{},populated:!1},newApplication:{defaultExpiry:moment.duration(1,"hour").asMilliseconds(),data:{},populated:!1}};this.cacheList=_.cloneDeep(k);var l=function(a){return d.exists(a)?_.isPlainObject(a)?{prepped:JSON.stringify(a),needsParsing:!0}:a:(h.error("prep input undefined or null!"),a)},m=function(a){return d.exists(a)?_.isPlainObject(a)&&d.exists(a.needsParsing)&&d.exists(a.prepped)&&a.needsParsing&&_.isString(a.prepped)?JSON.parse(a.prepped):a:(h.error("parse input undefined or null!"),a)},n=function(a){if(d.exists(a)&&_.isString(a))return d.exists(i.cacheList[a])||(i.cacheList[a]={},i.cacheList[a].defaultExpiry=j.DEFAULT_EXPIRY),!0;throw"touchCache_invalid_cacheName"},o=function(a,b){if(!(d.exists(a)&&_.isString(a)&&d.exists(b)))throw h.error("updatedPopulated - argument(s) invalid"),"updatePopulated_argument_invalid";n(a),i.cacheList[a].populated=b},p=function(a,b){if(!(d.exists(a)&&_.isString(a)&&d.exists(b)))throw h.error("updatedSnapshot - argument(s) invalid"),"updateSnapshot_argument_invalid";n(a),i.cacheList[a].snapshot=b},q=function(a,b){if(!(d.exists(a)&&d.exists(b)&&_.isString(a)))throw h.error("populate: invalid argument(s) ["+a+"/"+b+"]"),"populate_argument_invalid";o(a,!0),p(a,b)},r=function(a){if(d.exists(a)&&_.isString(a))return d.exists(i.cacheList)&&d.exists(i.cacheList[a])&&d.exists(i.cacheList[a].populated)&&i.cacheList[a].populated===!0&&d.exists(i.cacheList[a].snapshot)?!0:!1;throw"cache_service_is_populated_invalidate_cacheName"},s=function(a){if(d.exists(a)&&_.isString(a)&&d.exists(i.cacheList[a]))return o(a,!1),p(a,{}),"invalidated";throw d.exists(a)&&_.isString(a)?(h.error("invalidate: invalid argument(s) ["+a+"]"),"cache_snapshot_does_not_exist"):(h.error("invalidate: invalid argument(s) ["+a+"]"),"invalidate_argument_invalid")},t=function(){i.cacheList=_.cloneDeep(k),i.cacheStatus=_.cloneDeep({loaded:!1}),h.debug("invalidateAll reset cachelist")},u=function(a){if(d.exists(a)){if(d.exists(a.bestBefore)){var b=moment(a.bestBefore),c=moment();return c.isBefore(b)?"not_expired":"expired"}return"expired"}throw"interpretExpiry_missing_snapshot"},v=function(b){var e=a.defer(),f={};return d.exists(b)?_.isString(b)?r(b)?(h.debug("getting "+b+" cache"),c.getItem(b).then(function(a){h.debug("$localForage.getItem successful for "+b);var c;d.exists(a)&&(_.isPlainObject(a)||_.isArray(a))?(c=i.parse(a),d.exists(c)&&!_.isEmpty(c)?(f.getStatus="success",f.cacheData=_.cloneDeep(c),i.populate(b,_.cloneDeep(c))):(f.getStatus="no_data",f.cacheData={},i.invalidate(b)),e.resolve(f)):d.exists(a)&&_.isString(a)?(c=d.exists(a)&&_.isString(a)?JSON.parse(a):void 0,f.getStatus="success",d.exists(c)&&d.exists(c.data)?(f.cacheData=_.cloneDeep(c.data),i.populate(b,_.cloneDeep(c.data))):(f.cacheData=_.cloneDeep(a),i.populate(b,_.cloneDeep(a))),e.resolve(f)):(i.invalidate(b),e.resolve({getStatus:"no_data",cacheData:void 0}))},function(a){e.reject({getStatus:"error",error:a})})):(f.getStatus="error",f.error="cache_get_cacheName_unpopulated",f.message="CacheService.get ERROR: cacheName "+b+" does not exist or is not populated",e.reject(f)):(f.getStatus="error",f.error="cache_get_cacheName_invalid",f.message="CacheService.get ERROR: Need a string to get a cache",e.reject(f)):(f.getStatus="error",f.error="cache_get_cacheName_missing",f.message="CacheService.get ERROR: No cacheName passed",e.reject(f)),e.promise},w=function(a){return d.exists(a)?moment(a).isValid()?!0:!1:(h.error("timeValid - input undefined/null"),!1)},x=function(a,b,c){if(d.exists(b)&&_.isPlainObject(b)){var e=_.cloneDeep(b),f=new Date;h.debug("addExpiry timeNow is "+moment(f).format(g.hms));var k;if(d.exists(c)&&(_.isString(c)||_.isNumber(c)))k=moment(f).add(c,"milliseconds");else if(d.exists(c)?h.error("addExpiry - expiry provided but invalid"):h.debug("addExpiry - expiry undefined, using default expiry"),d.exists(a)&&d.exists(i.cacheList[a])&&d.exists(i.cacheList[a].defaultExpiry)&&w(i.cacheList[a].defaultExpiry)){var l=i.cacheList[a].defaultExpiry;k=moment(f).add(l),h.debug("addExpiry - using cacheName specific default - "+a+" will expire at "+k.format(g.hms))}else k=moment(f).add(j.DEFAULT_EXPIRY,"milliseconds"),h.debug("addExpiry - using global default - "+a+" will expire at "+k.format(g.hms));return e.cachedAt=moment(f).toJSON(),e.bestBefore=k.toJSON(),e}return b},y=function(b,e,f){h.info("\n +cache "+b);var g=a.defer();if(d.exists(b)&&d.exists(e)&&_.isString(b)&&_.isPlainObject(e)){var j=i.addExpiry(b,e,f),k=i.prep(j);c.setItem(b,k).then(function(a){h.info("\n +cache "+b+" success"),i.populate(b,_.cloneDeep(j));var c={setStatus:"success",cacheData:a};c.originalData=_.cloneDeep(j),g.resolve(c)},function(a){h.error("\n +cache "+b+" error"),i.invalidate(b),g.reject({setStatus:"error",error:a||"unknown"})})}else g.reject(d.exists(b)?d.exists(e)?_.isString(b)?_.isPlainObject(e)?{setStatus:"error",error:"set_cache_invalid_arguments"}:_.isObject(e)?{setStatus:"error",error:"set_cache_invalid_newData",message:"new data is not plain object"}:{setStatus:"error",error:"set_cache_invalid_newData",message:"new data is not object"}:{setStatus:"error",error:"set_cache_invalid_cacheName"}:{setStatus:"error",error:"set_cache_missing_newData"}:{setStatus:"error",error:"set_cache_missing_cacheName"});return g.promise},z=function(b){h.info("\n -cache "+b);{var e=a.defer();moment()}if(d.exists(b)&&_.isString(b))try{var f=i.invalidate(b);d.exists(f)&&"invalidated"===f?c.removeItem(b).then(function(){e.resolve({unsetStatus:"success"})},function(a){e.reject({unsetStatus:"error",error:a})}):(d.exists(f)&&h.error(f),e.reject({unsetStatus:"error",error:"unset_invalidated_unsuccessful"}))}catch(g){d.exists(g)?(h.error(g),e.reject({unsetStatus:"error",error:g})):e.reject({unsetStatus:"error",error:"unknown"})}else e.reject(d.exists(b)?{unsetStatus:"error",error:"unset_invalid_cacheName"}:{unsetStatus:"error",error:"unset_missing_cacheName"});return e.promise},A=function(){var b=a.defer();return c.clear().then(function(){i.invalidateAll(),i.cacheStatus={loaded:!1},b.resolve()},function(a){i.cacheStatus={loaded:!1},b.reject(a)}),b.promise},B=function(b){var c=a.defer(),e=(moment(),function(a,c,e,f){return d.exists(a)&&"success"===a?(d.exists(b)&&_.isString(b)&&(d.exists(e)&&"not_expired"===e?i.populate(b,c):i.invalidate(b,c)),{getStatus:a,cacheData:c,hasExpired:e,message:f}):(d.exists(b)&&_.isString(b)&&i.invalidate(b),{getStatus:a,error:c,message:f})});return d.exists(b)&&_.isString(b)?r(b)?i.get(b).then(function(a){if(d.exists(a))if(_.isPlainObject(a)&&d.exists(a.getStatus)&&d.exists(a.cacheData)&&"success"===a.getStatus&&d.exists(a.cacheData.bestBefore)){var b=i.interpretExpiry(a.cacheData);if("expired"===b)c.resolve(e("success",a.cacheData,"expired","cache has expired"));else{if("not_expired"!==b)throw"unrecognised verdict from interpretExpiry";c.resolve(e("success",a.cacheData,"not_expired","cache is still valid"))}}else c.resolve(e("success",a,"expired","get result has no bestBefore key or is not plain object"));else c.resolve(e("success",{},"expired","get result undefined or null"))},function(a){c.reject(e("error",a,null,"hasExpired: cache get error"))}):c.resolve(e("success",{},"expired","cacheName not populated")):c.reject(e("error","hasExpired_invalid_cacheName",null,"hasExpired was passed an invalid cacheName")),c.promise},C=function(b,c,e){var g,j=a.defer(),k=!0,l=function(a){d.exists(a)&&h.error(n(" invalidated due to "+a)),k=!1},m=function(a,b){l(a),d.exists(b)?(h.error(b),j.reject(b)):j.reject(a)},n=function(a){return".retrieve - "+a},o=function(){return d.exists(b)?_.isString(b)?!0:(m("cacheName not a string"),!1):(m("cacheName undefined or null"),!1)},p=function(){return i.hasExpired(b)},q=function(){return c?(g=!0,!0):(g=!1,!1)},r=function(){h.debug(n(" retrieving from cloud"));var c=a.defer(),g=function(a){var c;d.exists(e)&&d.exists(e.expiry)&&(c=e.expiry||void 0),i.set(b,a,c).then(function(){j.resolve({retrieveStatus:"success",cacheData:a})},function(a){j.reject(a)})},k=function(a){c.reject(a)},l=d.exists(e)&&d.exists(e.ccParams)?e.ccParams:void 0;return d.exists(e)&&d.exists(e.ccName)&&e.ccName?(h.debug("using custom ccName"),f.run(e.ccName,l).then(g,k)):(h.debug("running cloud code function matching cacheName ("+b+")"),f.run(b,l).then(g,k)),c.promise},s={cloud:function(){r().then(function(a){h.debug("retrieved from cloud"),h.table(a),j.resolve({retrieveStatus:"success",cacheData:a})},function(a){h.error("failed to retrieve from cloud"),h.error(a),j.reject(a)})}};if(o()&&k)if(q(),g)h.debug(n(" forceRequest ON - retrieving "+b+" from cloud")),s.cloud();else{var t=i.isPopulated(b);t?p().then(function(a){d.exists(a)&&d.exists(a.getStatus)&&d.exists(a.hasExpired)&&d.exists(a.cacheData)&&_.isPlainObject(a.cacheData)&&"not_expired"===a.hasExpired&&"success"===a.getStatus?j.resolve({retrieveStatus:"success",cacheData:_.cloneDeep(a.cacheData)}):d.exists(a)?d.exists(a.getStatus)&&_.isString(a.getStatus)?d.exists(a.hasExpired)?d.exists(a.cacheData)&&_.isPlainObject(a.cacheData)?(h.debug(n(" cacheData unexpired/unavailable - retrieving "+b+" from cloud")),s.cloud()):(h.debug(n(" missing cacheData - retrieving "+b+" from cloud")),s.cloud()):(h.debug(n(" missing hasExpired - retrieving "+b+" from cloud")),s.cloud()):(h.debug(n(" missing getStatus - retrieving "+b+" from cloud")),s.cloud()):(h.debug(n(" cacheData unavailable - retrieving "+b+" from cloud")),s.cloud())},function(a){j.reject(a)}):(h.debug(n(" cacheData unpopulated - retrieving "+b+" from cloud")),s.cloud())}return j.promise},D=function(){var b=a.defer(),c=function(){var a=0;return _.forEach(i.cacheList,function(b){b.populated&&a++}),a};if(i.cacheStatus.loaded)b.resolve({loadedCaches:c(),cacheListState:_.cloneDeep(i.cacheList)});else{var d=0,e=function(){var b=[],c=function(b){var c=a.defer();return i.hasExpired(b).then(function(a){h.info("loadAll loaded "+b),d++,c.resolve(a)},function(){c.resolve()}),c.promise};return _.forEach(i.cacheList,function(a,d){h.debug("loadAll now trying to load "+d),b.push(c(d))}),a.all(b)};e().then(function(){i.cacheStatus.loaded=!0,h.debug("loadAll loaded "+d+" items from storage"),b.resolve({loadedCaches:d,cacheListState:_.cloneDeep(i.cacheList)})},function(a){h.error("loadAll failed to load: "+a),b.reject(a)})}return b.promise};this.prep=l,this.addExpiry=x,this.parse=m,this.populate=q,this.invalidate=s,this.invalidateAll=t,this.touchCache=n,this.isPopulated=r,this.get=v,this.interpretExpiry=u,this.hasExpired=B,this.retrieve=C,this.loadAll=D,this.set=y,this.unset=z,this.clearAll=A,this.clear=this.clearAll}]),angular.module("cloakroomApp").config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1,a.includeBar=!0}]),angular.module("cloakroomApp").config(["$localForageProvider","CLOAKROOM_IN_DEVELOPMENT",function(a,b){a.config({name:"cloakroomApp",storeName:"cloakroom",description:"Cloakroom's local cache of your data :)",oldPrefix:!1}),b&&a.setNotify(!0,!0)}]),angular.module("cloakroomApp").config(["snapRemoteProvider","CLOAKROOM_IN_DEVELOPMENT","FORCE_ENABLE_SNAP_DRAWERS",function(a,b,c){b||c?a.globalOptions.disable="none":a.globalOptions={disable:"right"}}]),angular.module("cloakroomApp").controller("DevCtrl",["$log","$scope","$rootScope","UserService","ParseUser","MemberLinkService","CLOAKROOM_IN_DEVELOPMENT",function(a,b,c,d,e){var f=this;f.controls={photo:{show:!1}},b.links=c.linkCache,c.$watch("linkCache",function(){b.links=c.linkCache});var g=function(){e.current.isLogged&&!_.isUndefined(d.currentUser.hostThumbnail)&&void 0!==d.currentUser.hostThumbnail.base64?(a.debug("DEV: User Logged in, getting Thumbnail"),f.controls.photo.url=e.getThumbnail(),f.controls.photo.show=!0):!e.current.isLogged&&d.currentUser.isLogged&&d.currentUser.photoUrl?(a.debug("DEV: User Logged in, getting photoUrl"),f.controls.photo.url=d.currentUser.photoUrl,f.controls.photo.show=!0):(a.debug("DEV: Disabling photo"),f.controls.photo.show=!1,f.controls.photo.url=null)};c.$on("$stateChangeSuccess",function(){e.current.isLogged&&d.currentUser.isLogged&&(b.links=c.linkCache,g()),d.currentUser.isLogged&&(c.currentUser=d.currentUser)})}]),angular.module("cloakroomApp").directive("developerPanel",function(){return{templateUrl:"views/developer-panel.html",restrict:"E",controller:"DevCtrl",controllerAs:"Dev"}}),angular.module("cloakroomApp").directive("pwCheck",[function(){return{require:"ngModel",link:function(a,b,c,d){var e="#"+c.pwCheck;b.add(e).on("keyup",function(){a.$apply(function(){var a=b.val()===$(e).val();d.$setValidity("pwmatch",a)})})}}}]),angular.module("cloakroomApp").controller("CloakroomTestCtrl",["CLOAKROOM_IN_DEVELOPMENT","$injector","$q","$rootScope","$log","$localForage","CacheService","GoTo","UserService","ModalInterface","$state","ErrorInterface","crLog",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=this;n.outputObject={},n.checkObject={},n.text={output:"",check:""};n.controls={showPanel:!0,UIsandbox:!1,iPhone:!0},n.switchPanel=function(){n.controls.UIsandbox=!n.controls.UIsandbox,n.controls.showPanel=!n.controls.showPanel,e.debug("Test: Switching Panel")};var o={str:"this is a cached string",arr:["this","is","a","cached","array"],obj:{thisIs:"a",cached:{a:"test",b:"test",c:"test",d:"test",e:"test"},obj:{please:"work",user:i.currentUser}}};
n.setupTest=function(){f.setItem("test cache",JSON.stringify(o.obj)).then(function(a){n.outputObject=a,n.text.output="Success"},function(a){n.outputObject=a,n.text.output="Error"})},n.runTest=function(){f.getItem("test cache").then(function(a){n.checkObject=JSON.parse(a),e.table(JSON.parse(a)),n.text.check="Success"},function(a){n.checkObject=a,n.text.check="Error"})},n.checkTest=function(){};var p=m.create("DEV",a,"#81a3d0");if(a){p.info("setting up localforage watchers");var q=!0;d.$on("LocalForageModule.setItem",function(a,b){var c="localforage setting "+b.key;q&&(c=c+" using "+b.driver),p.info(c)}),d.$on("LocalForageModule.removeItem",function(a,b){var c="localforage removing "+b.key;q&&(c=c+" using "+b.driver),p.info(c)})}}]),angular.module("cloakroomApp").directive("cloakroomTest",function(){return{templateUrl:"/views/test/test.html",restrict:"E",controller:"CloakroomTestCtrl",controllerAs:"test"}}),angular.module("cloakroomApp").config(["$logProvider","CLOAKROOM_IN_DEVELOPMENT",function(a,b){a.debugEnabled(b?!0:!1)}]),angular.module("cloakroomApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/login")}]),angular.module("cloakroomApp").config(["$stateProvider","$locationProvider",function(a,b){b.html5Mode(!0)}]),angular.module("cloakroomApp").filter("ukMobileNumber",function(){return function(a){if(a&&14===a.length){var b=a.substring(0,4);if("0044"===b)return"0"+a.substring(4)}else if(a&&"+44"===a.substring(0,3))return"0"+a.substring(3);return a}}),angular.module("cloakroomApp").filter("base64Image",function(){return function(a){return"data:image/jpeg;base64,"+a}}),angular.module("cloakroomApp").directive("photoPlaceholder",function(){return{template:'<div id="profile-dp"><div class="placeholder"><i class="cr-i-placeholder-m" ng-if="!female"></i><i class="cr-i-placeholder-f" ng-if="female"></i></div><div ng-transclude></div><div/>',restrict:"E",transclude:!0,scope:{female:"=female"}}}),angular.module("cloakroomApp").directive("cloakroomLogo",function(){return{template:'<header class="cloakroom-logo logo-large"></header>',restrict:"E"}}),angular.module("cloakroomApp").directive("cloakroomHeader",["UserService","$log","$state","snapRemote","memberNotification",function(a,b,c,d,e){return{templateUrl:"/views/partials/cloakroom-header.html",restrict:"E",scope:{},controller:"HeaderCtrl",link:function(f){f.showMenuButton=!1,f.goHome=function(){c.go(a.currentUser.isLogged?"home":"login")},f.menuOpen=!1,b.debug("menu is not open"),d.getSnapper("main").then(function(a){a.on("open",function(){f.menuOpen=!0}),a.on("close",function(){f.menuOpen=!1})});var g=function(){d.getSnapper("main").then(function(a){"left"===a.state().state||f.menuOpen===!0?(a.close(),f.hideNotifications=!1,e.hide(),_.debounce(function(){e.updateAll().then(function(){b.debug("updated member notifications on menu close")},function(){b.error("failed to update member notifications on menu close")})},1e3,{leading:!0})()):"closed"===a.state().state?(a.open("left"),f.hideNotifications=!0):b.error("cloakroomHeader.toggleMenu - snapper status is "+a.status().status)},function(a){b.error(a)})};f.$on("$stateChangeStart",function(){f.hideNotifications=!0}),f.$on("$stateChangeError",function(){f.hideNotifications=!1,f.toggleMenu=g}),f.$on("$stateChangeSuccess",function(b,c){var d=["event.detail","event.apply","event.confirmation","membership.alias","membership.mobile","home"];f.showingHomeButton=!a.currentUser.isLogged&&_(d).contains(c.name)?!1:"home"===c.name?!1:!0,f.showMenuButton=a.currentUser.isLogged?!0:!1,f.hideNotifications=!1,f.toggleMenu=g})}}}]),angular.module("cloakroomApp").directive("formDivider",function(){return{template:'<div id="or-divider"><hr></div>',restrict:"E"}}),angular.module("cloakroomApp").directive("fbButton",function(){return{template:'<a id="login-facebook"><i class="cr-i-fb"></i><div ng-transclude></div></a>',restrict:"E",transclude:!0}}),angular.module("cloakroomApp").directive("viewLoading",function(){return{template:'<div id="loading-wrapper"><div class="loader">Loading...</div></div>'}}),angular.module("cloakroomApp").directive("profilePhoto",["$filter","$log",function(a,b){return{templateUrl:"/views/partials/profile-photo.html",transclude:!0,scope:{image:"@image",member:"=member",raw:"@raw",anchored:"@anchored",clickLink:"@clickLink"},restrict:"E",link:function(a){_.isUndefined(a.member)||_.isNull(a.member)?b.debug("Profile Photo Member undefined"):(a.firstName=a.member.firstName,a.lastName=a.member.lastName)}}}]),angular.module("cloakroomApp").directive("weChangeAtNight",function(){return{template:'<div class="weChangeAtNight"></div>',restrict:"E"}}),angular.module("cloakroomApp").directive("venueName",function(){return{template:'<span class="venue-name colored"><i class="cr-i-locationpin"></i>{{name}}</span>',restrict:"E",scope:{venue:"="},link:function(a){a.name=_.isUndefined(a.venue)||_.isNull(a.venue)?"Invalid Venue":_.isUndefined(a.venue.attributes)||_.isNull(a.venue.attributes)?a.venue.venueName:a.venue.attributes.venueName}}}),angular.module("cloakroomApp").directive("miniLoadingBar",function(){return{template:'<div class="mini-loading-bar"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>',restrict:"E"}}),angular.module("cloakroomApp").directive("liveTimeDifference",["$timeout","$log",function(a,b){var c=function(a){if(!a)return"who knows when?";var c=moment(),d=moment(a),e=moment(c).subtract("6","hours"),f=moment(c).add("10","minutes");return d.isBefore(c)&&d.isBefore(e)?c.preciseDiff(d)+" ago.":d.isBefore(c)&&d.isAfter(e)?"Right Now!":d.isAfter(e)&&d.isAfter(c)&&d.isBefore(f)?"About to Start!":(d.isAfter(c)||b.error("liveTimeDifference is performing future logic on an eventDate that is in the past :/"),"in "+c.preciseDiff(d)+".")},d=function(b,e){e.html(c(b.actualTime)),a(function(){d(b,e)},6e4)};return{scope:{actualTime:"=liveTimeDifference"},restrict:"A",link:function(a,b){d(a,b)}}}]),angular.module("cloakroomApp").directive("shortTimeDifference",["$timeout","$log",function(a,b){var c=function(a){if(!a)return"?????";var c=moment(),d=moment(a),e=moment(c).subtract("6","hours"),f=moment(c).add("10","minutes");return d.isBefore(c)&&d.isBefore(e)?"Finished":d.isBefore(c)&&d.isAfter(e)?"Now!":d.isAfter(e)&&d.isAfter(c)&&d.isBefore(f)?"Starting!":(d.isAfter(c)||b.error("liveTimeDifference is performing future logic on an eventDate that is in the past :/"),"in "+c.shortDiff(d))},d=function(b,e){e.html(c(b.actualTime)),a(function(){d(b,e)},6e4)};return{scope:{actualTime:"=shortTimeDifference"},restrict:"A",link:function(a,b){d(a,b)}}}]);var ALIAS_REGEXP=/^[A-Za-z]+$/;angular.module("cloakroomApp").directive("cloakroomAlias",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(a){return ALIAS_REGEXP.test(a)?(d.$setValidity("cloakroomAlias",!0),a):void d.$setValidity("cloakroomAlias",!1)})}}}),angular.module("cloakroomApp").directive("preciseTimeDifference",["$timeout","$log",function(a,b){var c=function(a){if(!a)return"who knows when?";'"'===a.substr(0,1)&&(a=a.replace(/"/g,""));var c=moment(),d=moment(a);if(!d.isValid()){var e=moment(a,moment.ISO_8601);e.isValid()&&(d=e)}moment(c).subtract("6","hours"),moment(c).add("10","minutes");return d.isBefore(moment(c).subtract(1,"minute"))?c.preciseDiff(d)+" ago.":d.isBefore(moment(c))&&d.isAfter(moment(c).subtract("minutes",1))?"Just now.":(d.isAfter(c)||b.error("preciseTimeDifference is performing future logic on an eventDate that is in the past :/"),"in "+c.preciseDiff(d)+".")},d=function(b,e){e.html(c(b.timeRef)),a(function(){d(b,e)},6e4)};return{restrict:"A",scope:{timeRef:"@preciseTimeDifference"},link:function(a,b,c){d(a,b,c)}}}]),angular.module("cloakroomApp").directive("notificationItem",function(){return{template:'<div class="row notification-item"><div ng-transclude></div></div>',compile:function(){return{pre:function(){},post:function(){}}},transclude:!0,restrict:"EA"}});var THIS_IN_DEVELOPMENT=!1;angular.module("cloakroomApp").directive("eventWeekday",function(){return{template:"<span>{{directiveOutput}}</span>",restrict:"EA",scope:{date:"@",caps:"@",now:"@"},link:function(a,b,c){var d;if(_.isUndefined(a.date)||_.isNull(a.date))d="Someday";else{var e,f,g=a.date,h=moment(g),i="ddd DD MMMM YY HH:mm",j=0;_.isUndefined(a.now)||_.isNull(a.now)?f=moment():(f=moment(a.now),THIS_IN_DEVELOPMENT&&console.log("event-weekday: using reference "+f.format(i)));var k=function(a){var b=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],c=_.findIndex(b,function(b){return b===a});return c},l=f;THIS_IN_DEVELOPMENT&&console.log("eventWeekday: parsing date based on time reference "+l.format(i)),e=_.isUndefined(c.caps)||_.isNull(c.caps)||"true"!==c.caps?!1:!0,j=h.diff(l,"hours",!0);var m=22;if(0>j)if(j>-6)d="happening now";else{var n=j/24,o=n+k(l.format("dddd"));d=j>-27?"yesterday":-10>o?"on the "+h.format("Do MMMM"):0>o?"last "+h.format("dddd"):"on "+h.format("dddd")}else if(j>0&&m>j)d="tonight";else if(j>m&&24+m>j)d="tomorrow";else{var p=j/24,q=p-k(h.format("dddd")),r=k("Wednesday")+1;d=r>=q?"this "+h.format("dddd"):7+r>=q?"next "+h.format("dddd"):"on the "+h.format("Do MMMM")}e&&(d=d.substr(0,1).toUpperCase()+d.substr(1))}b.text(d)}}}),angular.module("cloakroomApp").directive("weekDay",function(){return{template:"<span></span>",restrict:"E",scope:{date:"="},link:function(a,b){b.text(_.isUndefined(a.date)||_.isNull(a.date)?"Inv":moment(a.date).format("ddd"))}}}),angular.module("cloakroomApp").directive("mobileNumberInput",function(){return{template:"",restrict:"A",link:function(a,b){$(b.val()).change(function(){var a=b.val(),c=a.replace(/[A-Za-z]|\.|#|!|"|£|\$|%|\^|&|\*|\(|\)|\?|\~|\@|\'|\{|\}|\[|\]|\-/,"");b.val(c)})}}}),angular.module("cloakroomApp").directive("nameInput",["$log",function(a){return{require:"ngModel",restrict:"A",link:function(b,c,d,e){var f=!1,g=function(b){if(_.isUndefined(b))return b;var g=b.charAt(0).toUpperCase()+b.substring(1);return g===b||f||(e.$setViewValue(g),e.$render(),c.focus(),c[0].setSelectionRange(1,1),"once"===d.nameInput&&(f=!0,a.debug("nameInput: capitalize no longer available due to element attribute."))),g};e.$parsers.push(g),g(b[d.ngModel])}}}]),angular.module("cloakroomApp").service("MobVerification",["$q","$log","ParseUser","UserService","cfpLoadingBar","CLOAKROOM_IN_DEVELOPMENT",function(a,b,c,d,e,f){var g=this;g.check=function(g,h,i){b.debug("MobVerification: sending check request with id and secret "+g+","+h);var j=a.defer();_.isUndefined(g)||_.isNull(g)?b.error("no associated invitation id"):b.debug("Found associated invitation's id");var k={secret:h,invitation:g};return f&&b.table(k),j.notify({stage:1}),e.start(),Parse.Cloud.run("checkMobileSecret",k).then(function(a){e.set(40),j.notify({data:a,stage:2}),b.debug("checkMobileSecret returned"+a),d.currentUser.isLogged&&Parse.User.current()&&!_.isUndefined(i)&&!_.isNull(i)&&i===!0?(e.set(60),b.debug("attempting to run verification procedure remotely"),Parse.Cloud.run("verifyMobile",{secret:h}).then(function(a){e.set(80),b.debug("verification unlocked on server, now getting remote updates"),j.notify({data:a,stage:3}),d.currentUser.verifiedMobileNumber=!0,e.complete(),c.refresh().then(function(){b.debug("parse user is refreshed"),j.resolve(a)},function(a){b.error("Parse User refresh error"),b.error(a),j.resolve(!1)})},function(){b.error("Parse verifyMobile error"),e.complete(),j.resolve(a)})):(b.debug("MobVerification.check - only checking, not trying to unlock on server"),e.complete(),j.resolve(a))},function(a){e.complete(),j.resolve(!1),b.error(a)}),j.promise},g.auto=function(c){var e=a.defer();return d.currentUser.isLogged?d.currentUser.verifiedMobileNumber?(b.error("User has already been verified!"),e.resolve(!0)):Parse.Cloud.run("verifyMobile",{secret:c}).then(function(a){e.resolve(!0),b.debug(a)},function(a){b.error(a),e.resolve(!1)}):e.reject("Log in to use MobVerification.auto"),e.promise},g.requestText=function(){var c=a.defer();return!d.currentUser.isLogged||d.currentUser.verifiedMobileNumber||_.isUndefined(d.currentUser.associatedInvitation.id)||_.isNull(d.currentUser.associatedInvitation.id)?c.reject("Already verified, associated invitation not defined, or user not logged in"):(e.start(),Parse.Cloud.run("sendInviteCode",{invitationId:d.currentUser.associatedInvitation.id,mobileNumber:d.currentUser.mobileNumber}).then(function(){e.complete(),b.debug("invite code sent"),c.resolve()},function(a){e.complete(),b.error("invite code send ERROR "+JSON.stringify(a)),c.reject()})),c.promise}}]),angular.module("cloakroomApp").controller("BodyCtrl",["$rootScope","$interval","NightOrDay","CLOAKROOM_IN_DEVELOPMENT","FORCE_ENABLE_SNAP_DRAWERS","CLOAKROOM_DESIGN_MODE",function(a,b,c,d,e,f){this.developmentMode=d,this.designMode=f,this.snapOptions={content:{maxPosition:200,minDragDistance:40,minPosition:-200}},d===!1&&b(c.calculateNightOrDay,3e5),this.controls=c.controls,this.toggleDayNight=c.toggleDayNight,this.calcND=c.calculateNightOrDay,this.showTestPanel=!1,this.toggleTestPanel=function(){this.showTestPanel=!this.showTestPanel},this.forceDevDrawer=e?e:!1,this.forceTestPanel=e?e:!1}]),angular.module("cloakroomApp").service("NightOrDay",["$log",function(a){var b=this;return b.controls={isDay:!1},this.setDay=function(){this.controls.isDay=!0,a.info("Forcing isDay to true")},this.setNight=function(){this.controls.isDay=!1,a.info("Forcing isDay to false")},this.calculateNightOrDay=function(){var c=new Date,d=51.5,e=-.1,f=SunCalc.getTimes(new Date(c.getFullYear(),c.getMonth(),c.getDate(),12,0,0,0,0),d,e),g=f.sunset,h=f.sunrise,i=function(){a.debug("suncalc isDay: "+b.controls.isDay)},j=function(b){var d,e=function(b,c){a.info("Time until "+b+": "+c)};switch(b){case"sunrise":d=moment(h).preciseDiff(c),e(b,d);break;case"sunset":d=moment(g).preciseDiff(c),e(b,d);break;default:a.error("NightOrDay logUntil passed faulty argument")}};g>=c&&c>=h?(b.controls.isDay=!0,i(),j("sunset")):(b.controls.isDay=!1,i(),j("sunrise"))},this.toggleDayNight=function(){b.controls.isDay=!b.controls.isDay,a.debug("isDay is now "+b.controls.isDay)},this}]),angular.module("cloakroomApp").factory("ClubCSSClasses",function(){return{getClassForClub:function(a){switch(a){case"amika":return"amika";case"boujis":return"boujis";case"Cafe de Paris":return"cafedeparis";case"Cargo":return"cargo";case"Cirque le Soir":return"cirquelesoir";case"Cuckoo":return"cuckoo";case"Drury Club":return"druryclub";case"Mahiki":return"mahiki";case"Maddox":return"maddox";case"No. 41":return"no41";case"Nozomi":return"nozomi";case"Raffles":return"raffles";case"Rise 46":return"rise46";case"Shaka Zulu":return"shakazulu";case"The Mayfair Club":return"themayfairclub";case"Whisky Mist":return"whiskymist";default:return"noclub"}}}}),angular.module("cloakroomApp").run(["NightOrDay","CLOAKROOM_IN_DEVELOPMENT",function(a,b){b?a.setDay():a.calculateNightOrDay()}]),angular.module("cloakroomApp").run(["ParseSDK","$rootScope","$state","$log","$stateParams","cfpLoadingBar",function(a,b,c,d,e,f){b.$state=c,b.$stateParams=e,b.isViewLoading=!0,b.setLoading=function(){b.isViewLoading=!0},b.unsetLoading=function(){b.isViewLoading=!1},b.$on("$stateChangeStart",function(){b.setLoading()}),b.$on("$stateChangeSuccess",function(){b.unsetLoading()}),b.$on("$stateChangeError",function(a,c,e,g,h,i){_.isUndefined(i)||(d.error(i),b.unsetLoading(),f.complete())})}]),angular.module("cloakroomApp").directive("formError",function(){return{template:'<span class="form-error-text"><span ng-transclude class="help-block"></span></span>',restrict:"E",transclude:!0}}),angular.module("cloakroomApp").service("ErrorInterface",["$log","ModalInterface",function(a,b){this.popup=function(a,c,d){var e={softCancel:!1,text:c,title:a,yesText:"OK",size:"sm",noText:"No",showNoButton:!1};return _.isUndefined(d)||_.isNull(d)||d===!1?void b.yesNo(e):b.yesNo(e)}}]),angular.module("cloakroomApp").controller("ErrorModalCtrl",["$scope","close","title","text","extraLink",function(a,b,c,d,e){a.errorTitle=c,a.errorText=d,a.extraLink=e,a.close=function(){b()}}]),angular.module("cloakroomApp").service("FacebookAuthentication",["$q","$log","$rootScope","$state","$stateParams","ParseSDK","FacebookAngularPatch","ParseUser","UserService","CLOAKROOM_IN_DEVELOPMENT","FORCE_ENABLE_SNAP_DRAWERS","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=this;this.controls={authData:{},response:{}};var n=function(a){(j||k)&&b.table(a)};Parse.User.current()&&(m.controls.authData=Parse.User.current().get("authData")),this.checkFacebookId=function(c){var d=a.defer();return Parse.Cloud.run("checkFacebookId",{id:c}).then(function(a){d.resolve(a)},function(a){b.error(a),d.reject(a)}),d.promise},this.getAuthResponse=function(){var a=FB.getAuthResponse();return n(a),a},this.status={ongoing:!1};var o=function(a){return _.isUndefined(a)||_.isNull(a)?void b.error("no deferred object to reject"):a.reject({error:"timeout",message:"Facebook's Login window seems unavailable (blocked popups?). Please try logging in using your Alias and Password instead."})},p={set:function(a){m.status.ongoing?b.debug("FBA: timeout already set"):(b.debug("FacebookAuthentication: setting up timeout"),m.status.timeoutRef=l(function(){return o(a)},6e4),m.status.ongoing=!0)},unset:function(){m.status.ongoing?(b.debug("FacebookAuthentication: unsetting timeout"),_.isUndefined(m.status.timeoutRef)||_.isNull(m.status.timeoutRef)?(b.error("FBA: No timeout to cancel!"),m.status.ongoing=!1):(l.cancel(m.status.timeoutRef),m.status.ongoing=!1,b.debug("timeout cancelled"))):_.isUndefined(m.status.timeoutRef)||_.isNull(m.status.timeoutRef)?b.error("FBA: timeout not ongoing"):(l.cancel(m.status.timeoutRef),b.debug("manually cancelled timeout even though ongoing = false"))}};this.plainLogin=function(){b.debug("Logging In of Facebook using their SDK (No Parse)");var c=a.defer(),d=m.getAuthResponse();return _.isUndefined(d)||_.isNull(d)?(p.set(c),FB.login(function(a){b.debug("FBA.plainLogin - FB.login successful"),p.unset(),n(a),c.resolve(a)},{return_scopes:!0})):c.resolve({authResponse:d}),c.promise},this.fbLogin=function(){var c=a.defer(),d=0;return this.plainLogin().then(function(a){return d=1,_.isUndefined(a.authResponse)||_.isNull(a.authResponse)?void c.reject(a):(c.notify(d),m.checkFacebookId(a.authResponse.userID))}).then(function(a){d=2,c.notify(d),_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.data)||_.isNull(a.data)||a.data!==!0?(c.reject({status:"error",error:"not_linked"}),b.error(a.message)):(d=3,c.notify(d),Parse.FacebookUtils.logIn("public_profile, user_photos",{success:function(a){b.debug("logged in via facebook"),m.controls.authData=a.get("authData"),c.resolve(a)},error:function(a){b.error(a),c.reject(a),m.controls.authData=a}}))},function(a){b.error(a),c.reject(a)}),c.promise},this.getLoginStatus=function(){var c=a.defer();return FB.getLoginStatus(function(a){if(b.debug("Calling FB.getLoginStatus"),n(a),"connected"===a.status){{a.authResponse.userID,a.authResponse.accessToken}c.resolve(a)}else c.reject("not_authorized"===a.status?"not_authorized":a)}),c.promise},this.plainLogout=function(){b.debug("Logging Out of Facebook using their SDK");var c=a.defer();return FB.logout(function(a){c.resolve(a)}),c.promise},this.fbConnect=function(){b.debug("Connecting user to facebook account");var c=a.defer();return Parse.FacebookUtils.isLinked(Parse.User.current())?c.reject("already_linked"):Parse.FacebookUtils.link(Parse.User.current(),null,{success:function(){b.debug("updating fbId");var a=m.getAuthResponse();_.isUndefined(a)||_.isNull(a)?this.getLoginStatus().then(function(d){a=d.authResponse,Parse.User.current().save().then(function(a){c.resolve(a)},function(a,d){c.reject(d),b.error(d)})},function(a){c.reject(a)}):(Parse.User.current().set("fbId",a.userID),Parse.User.current().save().then(function(a){c.resolve(a)},function(a,d){c.reject(d),b.error(d)}))},error:function(a,b){c.reject(b)}}),c.promise},this.fbDisconnect=function(){b.debug("Disconnecting user from facebook");var c=a.defer();return Parse.FacebookUtils.unlink(Parse.User.current(),{success:function(a){c.resolve({status:"success",data:a})},error:function(a,d){c.reject(d),b.error(d)}}),c.promise},this.loginAndGetDetails=function(){var c=a.defer(),d=0,e={firstName:"",lastName:""};return this.plainLogin().then(function(){return d=1,c.notify(d),FB.apiAngular("/me")},function(a){c.reject(a),b.error(a)}).then(function(a){d=2,c.notify(d),e.firstName=a.first_name,e.lastName=a.last_name,_.isUndefined(a.gender)||_.isNull(a.gender)?console.debug("Can't set user gender using facebook"):e.isFemale="female"===a.gender?!0:!1,c.resolve(e),n(e)},function(a){c.reject(a)}),c.promise}}]),angular.module("cloakroomApp").service("ParseUser",["$q","$log","$filter","UserService","ApplicationService","MemberLinkService","memberNotification","cfpLoadingBar","serviceHelpers","StatusService",function(a,b,c,d,e,f,g,h,i,j){var k=this,l=!1,m=function(a){return i.developerLog("ParseUser",a,!l)};k.current={isLogged:!1},k.userServiceInitialised=!1,this.initUserService=function(c){var e={},f=a.defer(),h=!_.isUndefined(c)&&!_.isNull(c),i=h&&!_.isUndefined(c.force)&&!_.isNull(c.force),l=i?c.force:!1;return Parse.User.current()?(e=Parse.User.current().attributes,e.isLogged=!0,e.id=Parse.User.current().id,_.isUndefined(e.photoUrl)||_.isNull(e.photoUrl)?j.update("photo",!1):j.update("photo",!0)):(e.isLogged=!1,b.error("initUserService was called but no current parse user")),Parse.User.current()&&!k.userServiceInitialised?(d.setUser(e),k.userServiceInitialised=!0,g.getNotifications().then(function(){f.resolve("initialised")},function(a){f.reject(a)})):Parse.User.current()?k.userServiceInitialised&&d.currentUser.isLogged&&!l?(b.error("UserService already initialised, skipping"),g.getNotifications().then(function(){f.resolve("initialised")},function(a){f.reject(a)})):(d.setUser(e),k.userServiceInitialised=!0,g.getNotifications().then(function(){f.resolve("initialised")},function(a){f.reject(a)}),f.resolve("user refreshed and notifications retrieved")):(b.error("ParseUser.initUserService: No Parse User"),d.resetUser(),f.reject("no parse user")),f.promise},this.refresh=function(){var c=a.defer();return Parse.User.current().fetch().then(function(){return k.setParseUser({force:!0})},function(a){b.error(a),c.reject(a),b.error("Unable to fetch current parse user")}).then(function(a){c.resolve(a),b.debug("MasterCtrl: successfully refreshed current parse user")},function(a){c.reject(a),b.error(a),b.error("MasterCtrl: failed to refresh current parse user")}),c.promise},this.logout=function(){var b=a.defer();return k.userServiceInitialised=!1,d.resetUser(),Parse.User.logOut(),b.resolve(),b.promise},this.setParseUser=function(c){var d=a.defer(),e=Parse.User.current();return e&&Parse.User.current()?(e.isLogged=!0,k.current=e,k.initUserService(c).then(function(a){d.resolve(a)},function(a){d.reject(a)})):(b.error("No parse user to set!"),d.reject("no buffer")),d.promise},Parse&&Parse.User&&Parse.User.current()&&(b.debug("ParseUser: setting parse user on initialisation"),this.setParseUser()),this.deletePhoto=function(){m("Deleting photo!");var c=a.defer();if(Parse.User.current()){h.start();var e=Parse.User.current();e.set("photoFileInfo",void 0),e.set("photoUrl",void 0),e.save().then(function(a){m("Photo deleted!"),d.setUser(a),c.resolve(a),h.complete()},function(a){b.error(a),c.reject(a)})}else c.reject("Not logged in");return c.promise},this.updatePhoto=function(c){var e=a.defer();if(_.isUndefined(c)||_.isNull(c))e.reject({error:"Missing fileInfo",internal:!0});else{h.start();var f=Parse.User.current();f.set("photoFileInfo",c),f.set("photoUrl",c.cdnUrl),f.save().then(function(a){var b=a.attributes;b.id=a.id,b.isLogged=!0,d.setUser(b),e.resolve(a),h.complete()},function(a,c){_.isUndefined(c)||_.isNull(c)?(b.error(a),h.complete(),e.reject(a)):(b.error(c),h.complete(),e.reject(c))})}return e.promise},this.updateUser=function(c){var e=a.defer(),f=["firstName","lastName","mobileNumber","alias","username","email","password"];if(_.isUndefined(c)||_.isNull(c)||_.isEmpty(c))e.reject("Missing updateObject");else{h.start();var g=Parse.User.current();_.forOwn(c,function(a,c){var d=!0;if(_.contains(f,c)||(b.error("updateUser: editting user "+c+" is not allowed"),d=!1),d&&a.modified)if(b.debug("updateUser: field "+c+" is modified"),_.isUndefined(a.value)||_.isNull(a.value))b.error("updateUser: modified field "+c+" has an undefined or null value");else{var e=a.value;"mobileNumber"===c&&(e=i.convertMobile(e)),g.set(c,e),b.debug("updateUser: setting "+c+" to "+a.value)}else b.debug("updateUser: field "+c+" is not modified")}),g.save().then(function(a){var b=a.attributes;b.id=a.id,b.isLogged=!0,d.setUser(b),e.resolve(a),h.complete()},function(a,c){_.isUndefined(c)||_.isNull(c)?(b.error(a),h.complete(),e.reject(a)):(b.error(c),h.complete(),e.reject(c))})}return e.promise}}]),angular.module("cloakroomApp").controller("ApplicationController",["$rootScope","$scope","$state","$stateParams",function(a,b,c,d){b.applicationCtrl={current:null},b.applicationCtrl.current=b.masterApplicationCtrl.collection.find(function(a){return a.id===d.monsterId}),b.transitionTo=function(a){c.transitionTo(a)},b.isActiveState=function(a){return a===c.current.name?"light-back":void 0}}]),angular.module("cloakroomApp").directive("editApplicationForm",["$location",function(a){var b=function(a,b,c){a.append('<div id="'+b+'" class="important-white-back opacity-9 loading absolute top" style="width:100%; height:100%;"><div class="v-outer-container" style="height: 100%"><div class="v-inner-container"><div class="v-aligned-content big-top-margin"><span class="muted">'+c+"</span></div></div></div></div>")};return{restrict:"A",scope:{applicationToSave:"="},transclude:!0,templateUrl:"views/partials/editApplicationForm.html",link:function(c,d){c.editedApplication={name:null,reason:null},c.$watch("applicationToSave.attributes.name",function(a){c.editedApplication.name=a}),c.$watch("applicationToSave.attributes.reason",function(a){console.log(a),c.editedApplication.reason=a}),c.saveApplication=function(){var e=$("#loadingContainer");b(e,"savingForm","Saving"),d.find("button").attr("disabled","disabled"),c.applicationToSave.setName(c.editedApplication.name),c.applicationToSave.setReason(c.editedApplication.reason),c.applicationToSave.save().then(function(b){$("#savingForm").remove(),a.path("/crud/"+b.id)},function(a){alert("Error saving to Parse, check the console and network tab"),console.log(a)})}}}}]),angular.module("cloakroomApp").controller("LoginCtrl",["$location","$scope","$rootScope","$timeout","$state","$stateParams","$log","TitleService","AuthenticationService","UserService","FacebookAuthentication","ParseUser","ErrorInterface","GoTo","ApplicationService","cfpLoadingBar",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r=function(){var a,b;try{return a=new Date,localStorage.setItem(a,a.toString()),b=localStorage.getItem(a)===a.toString(),localStorage.removeItem(a),b}catch(c){}},s=r(),t=function(){return m.popup("Private Browsing Error","Unfortunately, due to technical limitations iOS devices in private browsing mode enabled are unable to login.<br><br>Please <strong>disable private browsing mode</strong> and <strong>refresh</strong> to login.")};_.isUndefined(s)||_.isNull(s)||s===!1?(q=!1,t()):(g.debug("User is not private browsing!"),q=!0);var u=this;h.setTitle("Login"),u.vm={loginButton:"Log In",showFeedback:{aliasOrMobile:!1,password:!1},fbStage:-1},u.badFields={loginAlias:!1,password:!1};var v=function(){_.isUndefined(u.credentials.aliasOrMobile)||_.isNull(u.credentials.aliasOrMobile)?(u.badFields.aliasOrMobile=!0,u.vm.showFeedback.loginAlias=!0,u.vm.showFeedback.password=!0,u.vm.loginButton="Missing Credential"):u.badFields.aliasOrMobile=!1,_.isUndefined(u.credentials.password)||_.isNull(u.credentials.password)?(u.badFields.password=!0,u.vm.showFeedback.password=!0,u.vm.loginButton=u.badFields.aliasOrMobile?"Please Complete Form":"Missing Password"):(u.badFields.password=!1,u.vm.loginButton=u.badFields.aliasOrMobile?"Bad Credential":"Log In")};b.submitted=!1,b.change=_.debounce(function(){v(),d(v,100)},200);var w=function(){_.isUndefined(f.goBackToEvent)||_.isNull(f.goBackToEvent)?(p.complete(),u.vm.loginButton="Proceeding to Home",g.debug("LoginCtrl: proceeding to home"),e.go("home")):(g.debug("LoginCtrl: goBackToEvent detected - redirecting to event "+f.goBackToEvent),u.vm.loginButton="Taking You Back",p.complete(),a.path("/event/"+f.goBackToEvent+"/confirmation"))};this.goToMembership=function(){a.path("/membership/")},u.credentials={},this.loginSuccess=!1,this.badFields={aliasOrMobile:!1,password:!1},this.errors={aliasOrMobile:{"short":!1,"long":!1,missing:!1,mixed:!1},password:{"short":!1,"long":!1,missing:!1}};var x=function(){c.facebookControls=k.controls,u.vm.loginButton="Initialising Services",l.initUserService().then(function(a){u.loginSuccess=!0,g.debug("LoginCtrl: successfully ran ParseUser.initUserService - resolved with "+a),u.vm.loginButton="Checking for Updates",o.checkInProgress().then(function(a){g.debug("LoginCtrl: successfully checked for in progress application - resolved with "+a),u.vm.loginButton="Continuing to Next Page",w()},function(a){u.vm.loginButton="Please Try Again",g.error(a),m.popup("Oh No!","Sorry, something went wrong when trying to log you in. Please try again.")})},function(a){u.vm.loginButton="Please Try Again",g.error(a),m.popup("Oh No!","Sorry, something went wrong when trying to log you in. Please try again.")})},y=function(a,d){g.debug("LOADING START: login"),p.start(),u.vm.loginButton="Checking Your Details",i.parseLogin(a,d).then(function(){u.vm.loginButton="Details Verified.",b.submitted=!1,j.currentUser.hasLinkedFacebook?k.fbConnect().then(function(){g.debug("LOADING FINISH: login"),p.complete(),c.facebookControls=k.controls,x()},function(a){g.debug("LOADING FINISH: login"),p.complete(),g.error(a),m.popup("Oh No!","Sorry, something went wrong when trying to log you in. Please try again.")}):(g.debug("LOADING FINISH: login"),p.complete(),x())},function(a){101===a.code?m.popup("Oops!","You've entered an incorrect combination. Try again."):(g.error(a),m.popup("Oh No!","Sorry, something went wrong when trying to log you in. Please try again."))})};this.login=function(a,c){if(b.submitted=!0,q)if(void 0===u.credentials.aliasOrMobile||void 0===u.credentials.password)v();else{var d=_.debounce(y(a,c),1e3,{leading:!0});d()}else t()},this.withFacebook=function(){p.start(),u.vm.fbStage=0,k.fbLogin().then(function(){g.debug("LoginCtrl: FB Login Success"),c.facebookControls=k.controls,l.setParseUser().then(function(a){g.debug("LoginCtrl: Set Parse User Success - resolved with "+a),x()},function(a){g.error("LoginCtrl:Failed to set Parse User - "+a),g.error(a),m.popup("Oh No!","Sorry, something went wrong when trying to log you in. Please try again.")})},function(a){u.vm.fbStage=-1,p.complete(),g.error("FacebookCtrl: Failed to Connect to Facebook via FacebookAuthentication.fbConnect"),g.error(a),_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.error)||_.isNull(a.error)?(m.popup("Oh No!","Sorry, something went wrong when trying to log you in. Please try again."),g.error(a)):"not_linked"===a.error?(m.popup("Sorry!","That Facebook Account does not seem to be linked to a Cloakroom member.<br>Please log in using your password and link your facebook account in 'Account Settings.'.<p>If you were invited, please click 'invited?' below the form.</p>"),g.error(a)):"timeout"!==a.error||_.isUndefined(a.message)||_.isNull(a.message)?(m.popup("Error",a),g.error(a)):_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.message)||_.isNull(a.message)?m.popup("Oh No!","Sorry, something went wrong when trying to log you in. Please try again."):m.popup("Facebook Error",a.message)},function(a){u.vm.fbStage=a,p.complete(),g.debug("loginCtrl: recieved update from fbLogin - (stage?)"+a)})},Parse.User.current()&&!j.currentUser.isLogged?(g.error("LoginCtrl: Detected a Parse User but UserService is not currently logged in."),u.vm.loginButton="Logging you in...",l.initUserService().then(function(a){g.debug("LoginCtrl: ran ParseUser.initUserService - resolved with "+a),j.currentUser.isLogged?(u.vm.loginButton="Log In Successful",w()):(m.popup("Sorry","Something went wrong when automatically logging you in. Please log in manually."),u.vm.loginButton="Please Log In",g.error("UserService.currentUser.isLogged is still false"))
},function(a){g.error(a),m.popup("Oh No!","Sorry, something went wrong when trying to log you in. Please try again.")})):Parse.User.current()&&j.currentUser.isLogged&&(u.vm.loginButton="Continuing to Home",w())}]),angular.module("cloakroomApp").controller("MemberHomeCtrl",["$log","$rootScope","$location","$scope","$q","GoTo","UserService","MemberLinkService","ApplicationService","TitleService","StatusService","ParseUser","memberApplications","ClubCSSClasses","memberLinks","linkedEvents","eventSuggestions","searchMembers","ErrorInterface","recentActivities","recentActivitiesService","MemberPhotoService","crLog",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=this;x.status=k.user,j.setTitle("Home"),b.linkCache=o,d.generatePhotoUrl=v.generateUrl;var y=w.create("memberHome",!1,"orange");x.vm={controls:{viewGuestlist:function(a){f.event(a)},show:{linkedGuestlists:!1}},linkedItems:[]},_.isUndefined(t)||_.isNull(t)||(x.vm.recentActivities=u.data),x.search={dropdownOpen:!0,deletable:!1,searchTerm:"",change:function(a){x.search.deletable=_.isUndefined(a)||_.isNull(a)?!1:a.length>0?!0:!1},searching:function(b){return r.find(b).then(function(a){return a.results},function(b){return a.error(b),[]},function(a){return a.results})},go:function(a){_.isUndefined(a.username)||_.isNull(a.username)?s.popup("Sorry","Something is wrong with that member's profile.<br>Try searching for them again.<br><br>If the problem continues then please contact us so we can fix the problem."):f.profile(a.username,!0)},found:{exists:!1,id:"",alias:"",username:"",firstName:"",photoUrl:"",photoFileObject:{}}},this.vm.applications=m;var z=o,A=_.isUndefined(p)||_.isNull(p)||_.isUndefined(p.data)||_.isNull(p.data)?void 0:p.data;this.suggestions={data:[]};var B,C=function(a,b){var c=moment(a).format("YYYYMMDD");return y.info(b.id+" date as number: "+c),c},D=function(){if(!_.isUndefined(b.randomEventSuggestions)&&!_.isNull(b.randomEventSuggestions)&&b.randomEventSuggestions.guestlists.length>0){var a;a=_.map(b.randomEventSuggestions.guestlists,function(a){var b=a;return b.attributes.dateOfEvent=moment(b.attributes.dateOfEvent).toJSON(),{type:"suggestion",list:b}}),x.suggestions.data=a}else x.suggestions.data=[]};B=_.isEmpty(z)?A:z.concat(A);var E=function(){x.suggestions.data.length>0&&(B=_.union(B,x.suggestions.data))};D(),E(),b.$watch(b.randomEventSuggestions,function(){D(),E()}),_.isUndefined(B)||_.isNull(B)||_.isEmpty(B)||(B=_.sortBy(B,function(a){return _.isUndefined(a.list)||_.isNull(a.list)?void 0:C(a.list.attributes.dateOfEvent,a.list)})),x.vm.linkedItems=B,_.each(x.vm.applications,function(a){var b=i.getStatus(a);y.info("MHCtrl: app "+a.id+" status: "+b),a.status=b}),x.vm.controls.applicationCount=x.vm.applications?x.vm.applications.length:0,d.$watch(function(){return x.vm.applications},function(){x.vm.controls.applicationCount=x.vm.applications?x.vm.applications.length:0}),g.currentUser.isLogged?(y.info("Home: User logged in! Setting user view model"),x.vm.user=g.currentUser):a.error("Home: User NOT logged in! not setting user view model"),this.interpretStatus=function(b){switch(b.status){case void 0:a.error("MHCtrl: interpretStatus - status is undefined");break;case"invalid":a.error("MHCtrl: interpretStatus - application is invalid!");break;case"rejected":return"Not Accepted";case"modified":return"RSVP Changed";case"accepted":return"On the List";case"complete":return"Enjoy Your Night!";case"applied":return"Waiting for Response"}},z.length>0&&(x.vm.controls.show.linkedGuestlists=!0),x.vm.photoExists=_.isUndefined(x.vm.user.photoUrl)||_.isNull(x.vm.user.photoUrl)?!1:!0,this.getClassForClub=n.getClassForClub,d.goToGuestlist=function(a){c.path("/event/"+a+"/")},d.changeOwnPhoto=v.changeOwnPhoto}]),angular.module("cloakroomApp").controller("MembershipCtrl",["$log","$rootScope","$scope","$state","$stateParams","$timeout","TitleService","invitedBy","CLOAKROOM_IN_DEVELOPMENT","invitation","ErrorInterface","MemberService","FacebookAuthentication","AuthenticationService","SignupService","ParseUser","inProgress","checkSecret",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){g.setTitle("New Member");var s=function(){var a,b;try{return a=new Date,localStorage.setItem(a,a.toString()),b=localStorage.getItem(a)===a.toString(),localStorage.removeItem(a),b}catch(c){}},t=s();this.canLogin=!0;var u=function(){return k.popup("Private Browsing Error","Unfortunately, due to technical limitations iOS devices in private browsing mode enabled are unable to sign up.<br><br>Please <strong>disable private browsing mode</strong> and <strong>refresh</strong> to login.")};_.isUndefined(t)||_.isNull(t)||t===!1?(this.canLogin=!1,u()):(a.debug("User is not private browsing!"),this.canLogin=!0);var v=this,w=!1;this.controls={invitedByPrefilled:!1,title:"How would you like to continue?",genderClicked:!1,showTitle:!0,facebookChosen:!1,askingInvite:!1,mobileVerified:!1,buttonAction:{},error:{firstname:!1,lastname:!1,invitedBy:!1},displaySignup:!0,invitation:{availalable:!1,taken:!1,processing:!1,processed:!1,error:!1},showForm:!1,hideButtons:!1,submitted:!1,method:"cr",selectCloakroomNotFacebook:function(){a.debug("showing form"),v.controls.hideButtons=!0,v.controls.showTitle=!0,v.controls.title="New Member Account",v.controls.showForm=!0},selectFacebookNotCloakroom:function(){var a=function(){m.loginAndGetDetails().then(function(a){k.popup("Facebook Linked","Linking your Facebook Account was successful."),v.newMember.firstName=a.firstName,v.newMember.lastName=a.lastName,v.newMember.isFemale=a.isFemale,v.controls.genderClicked=!0,v.controls.facebookForm()},function(a){k.popup("Error",a)})};k.popup("Getting Facebook Details","We are now getting your Facebook details. You may be required to log in to Facebook to continue.",!0).then(function(){a()},function(){a()})},facebookForm:function(){v.controls.hideButtons=!0,v.controls.showTitle=!0,v.controls.title="Create Account",v.controls.showForm=!0},askForInvite:function(b){switch(b){case"cr":v.controls.method="cr";break;case"fb":v.controls.method="fb";break;default:a.error("invalid invite ask!")}v.controls.hideButtons=!0,v.controls.askingInvite=!0,v.controls.showTitle=!1,v.controls.title="Invitation Required"},askInvitedBy:!0,checkDisabled:!1,checkInvitation:function(b,c){var d=function(){v.controls.checkDisabled=!0,o.checkInvitation(b,c).then(function(a){v.controls.checkDisabled=!1,"none"!==a.status?(v.controls.askingInvite=!1,"taken"!==a.status?(j=a.data,"cr"===v.controls.method?(w=!0,A(),v.controls.selectCloakroomNotFacebook()):"fb"===v.controls.method&&(A(),v.controls.selectFacebookNotCloakroom())):(v.controls.invitation={},v.controls.invitation.taken=!0,v.controls.displaySignup=!1)):(v.controls.checkDisabled=!1,k.popup("Sorry","We could not find your invitation!"))},function(b){k.popup("Sorry","There was an error searching for your invitation: "+JSON.parse(b.message).error),v.controls.checkDisabled=!1,a.error(b)})};_.isUndefined(b)?k.popup("Oops!","You haven't included the alias of who you were invited by."):_.isUndefined(c)?k.popup("Oops!","You haven't included your mobile number."):(c=c.replace(/[\-\s\(\)]+/g,""),b.length<3||!/^[A-Za-z]+$/.test(b)?k.popup("Alias Error","That does not seem to be a valid alias"):c.length<11||!/^\s*(?:\+?(\d{1,3}))?[-. (]*(\d{3})[-. )]*(\d{3})[-. ]*(\d{4})(?: *x(\d+))?\s*$/g.test(c)?k.popup("Mobile Number","Please check that you filled in your number correctly"):d())}},this.newMember={},this.invitation={},this.invitation=j,this.invitedBy=h;var x=function(a){v.newMember.invitedBy=a,v.controls.invitedByPrefilled=!0},y=function(){v.controls.error.firstname=!0,v.controls.error.lastname=!0,v.controls.error.password=!0,v.controls.error.confirmPassword=!0,v.controls.error.mobileNumber=!0,v.controls.error.isFemale=!0,j||(v.controls.error.invitedBy=!0)};c.clickGender=function(){v.controls.genderClicked||(v.controls.genderClicked=!0,a.debug("User clicked a gender!"))};var z=function(){if(y(),v.controls.genderClicked)if(!v.newMember.mobileNumber||v.newMember.mobileNumber.toString().length<10||"mobile"!==n.isAliasOrMobile(v.newMember.mobileNumber))k.popup("Hey....","That does not seem to be a valid mobile number :(");else if(!v.newMember.invitedBy||v.newMember.invitedBy.length<3)k.popup("Sorry...","You need to be invited to become a cloakroom member");else if(!v.newMember.password||!v.newMember.confirmPassword||v.newMember.confirmPassword.length<4||v.newMember.password<5)k.popup("Password","Missing password and matching confirmation.");else if(!v.newMember.email||v.newMember.email.length<5)k.popup("Email Address","Please enter your email address.");else{a.debug("MembershipCtrl: Form seems valid");var b=function(){var b={associatedInvitation:v.invitation,confirmPassword:null,password:v.newMember.password,firstName:v.newMember.firstName,lastName:v.newMember.lastName,isFemale:v.newMember.isFemale,mobileNumber:v.newMember.mobileNumber,invitedBy:v.newMember.invitedBy,email:v.newMember.email,verifiedMobileNumber:v.newMember.verifiedMobileNumber};i&&a.table(b),o.newMember=b,o.setStatus("alias",b).then(function(){d.go("alias")},function(b){a.error(b)})};j&&"available"===j.status?b():l.getAliasOrMobile(v.newMember.invitedBy,{photos:!1,host:!1},!0).then(function(a){_.isUndefined(a)?k.popup("Sorry","Please check that you have filled 'invited by' correctly."):b()},function(b){var c=b.message?" "+b.message:" Please try again later.";k.popup("Oh no!","We could not verify your invitation."+c),a.error(b)})}else k.popup("Oops!","Please pick a gender to continue.")};c.createMembership=_.debounce(z,500,{leading:!0}),c.hideErrors=function(a){v.controls.error[a]=!1},_.isUndefined(v.invitedBy)||_.isNull(v.invitedBy)||x(v.invitedBy);var A=function(){if(h&&(v.controls.askInvitedBy=!1,v.controls.showTitle=!0),!_.isUndefined(r)&&!_.isNull(r))if(a.debug("membership.js: checkSecret is defined"),_.isUndefined(r.data)||_.isNull(r.data))a.debug("checkSecret.data is undefined");else{a.debug("membership.js: checkSecret.data is "+r.data);var b=r.data;v.controls.mobileVerified=b,v.newMember.verifiedMobileNumber=b}if(_.isUndefined(j)||_.isNull(j))a.error("no invitation detected"),v.controls.buttonAction.fb=v.controls.askForInvite,v.controls.buttonAction.cr=v.controls.askForInvite;else if(v.controls.buttonAction={cr:v.controls.selectCloakroomNotFacebook,fb:v.controls.selectFacebookNotCloakroom},"taken"===j.status)v.controls.invitation={},v.controls.invitation.taken=!0,v.controls.displaySignup=!1;else if("error"===j.status)a.error("MembershipController Unable to get Invitation Status"),v.controls.invitation={},v.controls.invitation.error=!0,v.controls.displaySignup=!1,a.error(j.error.code&&j.error.message?"code: "+j.error.code+" , msg: "+j.error.message:"Could not identify error");else{if(v.controls.invitation={},v.controls.invitation.available=!0,v.controls.displaySignup=!0,v.invitation=w?j:_.isUndefined(j.data)||_.isNull(j.data)?j:j.data,v.newMember={mobileNumber:v.invitation.attributes.mobileNumber},_.isUndefined(v.invitation.attributes.name)||_.isNull(v.invitation.attributes.name)?_.isUndefined(v.invitation.attributes.firstName)?a.error("cannot auto fill in first name"):v.newMember.firstName=v.invitation.attributes.firstName:v.newMember.firstName=_.isUndefined(v.invitation.attributes.firstName)?v.invitation.attributes.name:v.invitation.attributes.firstName,_.isUndefined(v.invitation.attributes.lastName)?a.error("cannot auto fill in last name"):v.newMember.lastName=v.invitation.attributes.lastName,!(_.isUndefined(r)||_.isNull(r)||_.isUndefined(r.data)||_.isNull(r.data))){var c=r.data;v.controls.mobileVerified=c,v.newMember.verifiedMobileNumber=c,r.data===!1&&a.error("Invitation recieved by signup controller but mobile secret is wrong")}x(v.invitation.attributes.senderAlias)}};A(),_.isUndefined(q)||(v.signup=q.data,"unset"===q.status?a.debug("MembershipCtrl: no signup in progress - continuing as normal"):"alias"===q.data.status?o.invitation&&v.signup.associatedInvitation?o.invitation.id!==e.inv||o.invitation.id!==v.signup.associatedInvitation.id&&o.invitation.id!==v.signup.associatedInvitation.objectId?a.error("$stateParams.inv !== SignupService.invitation.id so not redirecting"):(a.error("cached user is at picking alias stage of _this_ invite (2) - redirecting"),d.go("alias")):a.error("user was midway through another signup, but we were passed a new invitation code. Continuing as normal."):"ready"===v.signup.status||"created"===v.signup.status?(a.error("cached user is at a later signup stage - redirecting"),d.go("alias")):"complete"===v.signup.status&&(a.error("cached user is at signup stage (5) - redirecting"),o.setStatus("complete").then(function(){d.go("home")},function(b){a.error(b)})))}]),angular.module("cloakroomApp").controller("ChooseAliasCtrl",["$q","$log","$rootScope","$location","$scope","$state","$stateParams","$timeout","cr","cfpLoadingBar","SignupService","ModalInterface","ErrorInterface","TitleService","ParseUser","inProgress",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;n.setTitle("Choose Your Alias"),e.newMember=k.newMember,e.status={isAvailable:!1,signingUp:!1,showAvailability:!1,hideAvailability:function(){e.status.showAvailability=!1,e.alias&&e.alias.length>3&&/^[a-zA-Z]+$/.test(e.alias)?q.button.message="Checking...":(q.button.message="Pick Alias to Continue",q.status.isAvailable=!1)}},q.button={message:"Pick Alias to Continue"},q.status=e.status,e.$watch("alias",_.debounce(function(a){a&&a.length>3&&/^[a-zA-Z]+$/.test(a)?k.checkAlias(a).then(function(a){a>0?(q.button.message="Alias Unavailable",e.status.isAvailable=!1):(q.button.message="Become a Member",e.status.isAvailable=!0),e.showAvailability=!0}):(q.button.message="Pick Alias to Continue",e.status.isAvailable=!1,e.showAvailability=!1)},400));var r=function(){if(i.exists(k.newMember.associatedInvitation)){var a;i.exists(k.newMember.associatedInvitation.id)?a=k.newMember.associatedInvitation.id:i.exists(k.newMember.associatedInvitation.objectId)&&(a=k.newMember.associatedInvitation.objectId),e.status.signingUp=!0,i.exists(a)?k.processSignup(a).then(function(){k.setStatus("complete",k.newMember).then(function(){e.status.signingUp=!1,b.debug("Successfully set status of signup to complete after processing signup"),o.setParseUser().then(function(){b.debug("Successfully set Parse User"),f.go("home")},function(a){console.error("Failed to set Parse User: "+a),f.go("login")})},function(a){b.error(a)})},function(a){e.status.signingUp=!1,m.popup("Error",JSON.stringify(a)),b.debug(a),f.go("login")}):b.error("no id provided")}else b.error("ChooseAliasCtrl: no associated invitation."),f.go("home"),e.status.signingUp=!0},s=function(){e.status.signingUp=!0,k.createMember(p.data,!0).then(function(){b.debug("Signup Success!"),q.button.message="Welcome!",r()},function(a){b.error(a),e.status.signingUp=!1,q.button.message="Error!",d.path("/membership/")})};p?"alias"===p.status?b.debug("ChooseAliasCtrl: signup in progress at correct stage."):"ready"===p.status?p.data.alias?s():b.error("no alias!"):"created"===p.status?r():(b.error("ChooseAliasCtrl: signup in progress detected but status is not alias!"),f.go("membership.new")):(b.error("ChooseAliasCtrl: no signup in progress - returning to new membership root - status: "+p.status),f.go("membership.new"));var t=function(){if(k.newMember.alias=e.alias,e.status.isAvailable){var a={softCancel:!1,text:"Do you want to be known as <strong>"+e.alias+"</strong>?",title:"Confirm Choice",yesText:"Yes!",size:"sm",noText:"No...",extraLink:{show:!1},showNoButton:!0};l.yesNo(a).then(function(a){a===!0?(e.status.signingUp=!0,k.setStatus("ready",k.newMember).then(function(){s(),e.status.signingUp=!0},function(a){e.status.signingUp=!1,b.error("ChooseAliasCtrl: failed to set signup status."),b.error(a)})):e.status.signingUp=!1},function(){e.status.signingUp=!1,b.error("User wants to pick another alias")})}else _.isUndefined(e.alias)||_.isNull(e.alias)?m.popup("Oops!","Please choose an alias. Aliases must be at least 5-16 characters long, and must contain alphabetical characters only (no numbers or symbols)."):m.popup("Aww...","That <strong>alias is not available</strong>. Please pick another!")};e.createMember=function(){e.status.isAvailable?t():h(t,400)}}]),angular.module("cloakroomApp").controller("GuestlistCtrl",["cr","crLog","$location","$state","$scope","$q","$rootScope","$compile","TitleService","UserService","CLOAKROOM_IN_DEVELOPMENT","GuestlistService","StatusService","$stateParams","ApplicationService","ModalInterface","guestlistFound","GoTo","ErrorInterface","cfpLoadingBar","lazyMaps","MemberPhotoService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=this,x=b.create("GuestlistCtrl",!1,"black");a.exists(q)&&q!==!1?w.event=q:q=!1,this.isMemberClicked=!1,e.generatePhotoUrl=v.generateUrl,e.mapDefaults={maxZoom:22,minZoom:10,doubleClickZoom:!0,scrollWheelZoom:!0,attributionControl:!0,tileLayer:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-hybrid/{z}/{x}/{y}.png",tileLayerOptions:{options:'<a href="http://stamen.com">Stamen Design</a> | <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> | <a href="http://openstreetmap.org">OpenStreetMap</a> | <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>'},icon:{type:"div",iconSize:[50,50],html:'<i class="cr-i-locationpin"></i>',popupAnchor:[0,0]},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:10}},e.bounds={london:{northEast:{lat:51.51280224425956,lng:-.11681556701660155},southWest:{lat:51.50211782162702,lng:-.14428138732910156}}},e.clickIsMember=function(){x.debug("user has answered first question!"),w.isMemberClicked=!0,w.controls.submitApplication=w.userApplication.isMember===!1?z:E},e.goTo=r,e.userIsLoggedIn=j.currentUser.isLogged;var y=function(){d.go("^.apply",{eventId:n.eventId})};w.nonMemberStepTwo=!1,w.showErrorFeedback=!1;var z=function(){w.applyButtonText="Apply to Attend",w.nonMemberStepTwo=!0,w.controls.go.submitApplication=A},A=function(){w.showErrorFeedback=!0,_.isUndefined(w.userApplication.nonMemberNumber)||_.isNull(w.userApplication.nonMemberNumber)||_.isUndefined(w.userApplication.nonMemberName)||_.isNull(w.userApplication.nonMemberName)?x.error("Missing nonMemberNumber or nonMemberName"):E()},B=function(){d.go("^.detail",{eventId:n.eventId})},C=function(){r.profile(w.event.attributes.memberHost)};w.applyButtonText="Apply",w.cancelButtonText="Not Going";var D=function(){o.deleteApplication(w.userApplication.id,w.event.attributes.guestlistName).then(function(a){x.debug(a),_.isUndefined(a)||_.isNull(a)||_.isEmpty(a.status)||"success"!==a.status||d.go("home")},function(a){x.error(a)})},E=function(){var a=function(){w.controls.applying=!1,w.applyButtonText="Sent!",d.go("event.confirmation",{eventId:n.eventId})},b=function(){o.getMemberApplications().then(function(){x.debug("Successfully refreshed cache"),J(),a()},function(){s.popup("Aww...","we failed to update your applicationCache.")})};w.controls.applying||(w.controls.applying=!0,w.applyButtonText="Sending...",w.controls.existingApplication.exists?o.updateApplication(w.userApplication.id,w.userApplication).then(function(a){w.controls.applying=!1,w.applyButtonText="Updated!",x.debug("GuestlistCtrl: Update Application Success - %j",a),b()},function(a){w.controls.applying=!1,w.applyButtonText="Failed",b(),x.error("error: failed to call ApplicationService.updateApplication: %j",a)}):j.currentUser.isLogged||w.isMemberClicked?o.createApplication(w.userApplication).then(function(b){j.currentUser.isLogged?o.getMemberApplications().then(function(){e.applying=!1,J(),a()},function(a){e.applying=!1,s.popup("Error",a),J()}):w.userApplication.isMember?r.boomerangEventLogin(w.event.id,b.id):a()},function(a){x.error(a)}):(w.applyButtonText="Try Again",w.controls.applying=!1,x.error("user hasn't clicked whether or not they are a cloakroom member"),s.popup("Oops...","You forgot to answer the first question!")))};w.controls={guestlistFound:!1,applying:!1,longVenueName:!1,existingApplication:{exists:!1,onList:!1,altered:!1,id:null},applyButton:{onList:!1,applied:!1},go:{backToEvent:B,toHostProfile:C,apply:y,submitApplication:E,cancelApplication:D},verified:!0},q===!1&&(w.controls.guestlistFound=!1,x.error("Could not find guestlist "+n.eventId)),e.map={zoom:15,options:{disableDefaultUI:!0,zoomControl:!0},markers:{}};var F=u;if(a.exists(F)?k&&(x.debug("maps is defined"),x.table(F)):x.error("lazyMaps undefined in controller"),a.exists(w.event)&&a.exists(w.event.attributes)){var G=w.event.attributes.venue.attributes.venueName;_.isUndefined(G)||_.isNull(G)||(w.controls.longVenueName=G.length>=10?!0:!1)}var H=function(a){if(w.controls.existingApplication.exists&&!_.isUndefined(a))return x.debug("buildUserApplication: using existing application"),w.userApplication=o.applicationCache[a].attributes,w.userApplication.id=o.applicationCache[a].id,w.applyButtonText="Update",!0;if(_.isUndefined(a)&&!w.controls.existingApplication.exists){x.debug("buildUserApplication: instantiating new application");var b=(new Date,j.currentUser.isLogged?!0:!1);return w.userApplication={femalePlusOne:0,malePlusOne:0,guestlist:{id:w.event.id}},b?(w.userApplication.isMember=!0,w.userApplication.member=Parse.User.current()):e.$watch(function(){return w.userApplication.isMember},function(){w.userApplication.isMember?(x.debug("GlCtrl: Switching button action to submitApplication"),w.controls.go.submitApplication=E,w.applyButtonText="Apply"):(x.debug("GlCtrl: Switching button action to nonMemberPrompt"),w.controls.go.submitApplication=z,w.applyButtonText="Continue")}),!0}return _.isUndefined(a)?void 0:(x.debug("buildUserApplication was passed an index but existing application does not exist!?"),!1)},I=function(a){w.controls.existingApplication.onList=o.applicationCache[a].attributes.onList,w.controls.existingApplication.altered=o.applicationCache[a].attributes.altered,w.controls.existingApplication.id=o.applicationCache[a].id,w.controls.existingApplication.exists=!0,H(a)},J=function(){if(j.currentUser.isLogged&&o.applicationCache.length>0&&w.controls.guestlistFound)for(var a=0,b=!0;!w.controls.existingApplication.exists&&b;)o.applicationCache&&o.applicationCache[a]&&o.applicationCache[a].attributes&&o.applicationCache[a].attributes.guestlist&&o.applicationCache[a].attributes.guestlist.id===w.event.id&&(x.debug("found matching user application"),o.applicationCache[a].attributes.guestlist.attributes.memberHost?(x.debug("found application's member host... setting existing application "+o.applicationCache[a].id),w.controls.existingApplication.exists=!0,I(a)):x.error("Application cache missing memberHost property"),b=!1),a!==o.applicationCache.length-1?a++:(w.controls.existingApplication.exists||(x.debug("could not find existing user application"),H()),b=!1);else x.debug("GCtrl: Not checking for existing application"),H()},K=function(){if(w.event&&w.event.attributes&&w.event.attributes.memberHost&&w.event.attributes.venue){x.debug("Guestlist Found"),e.map.center={lat:q.attributes.venue.attributes.venueLocation.latitude,lng:q.attributes.venue.attributes.venueLocation.longitude,zoom:16},e.markers={venue:{lat:q.attributes.venue.attributes.venueLocation.latitude,lng:q.attributes.venue.attributes.venueLocation.longitude,focus:!0,draggable:!1,title:q.attributes.venue.attributes.venueName,icon:{type:"div",iconSize:[32,32],html:'<i class="cr-i-locationpin"></i>',popupAnchor:[0,0]}}},w.controls.guestlistFound=!0,i.setTitle(w.event.attributes.guestlistName+" at "+q.attributes.venue.attributes.venueName);var a=function(a,b){var c=a+","+b,d="https://maps.googleapis.com/maps/api/staticmap?center=",e="&zoom=18&size=200x200&markers=size:mid|color:medium|51.5116458,-0.1424001|";return d+c+e+c},b=a(w.event.attributes.venue.attributes.venueLocation.latitude,w.event.attributes.venue.attributes.venueLocation.longitude);if(i.setImage(b),g.pageImage=b,x.debug("setting pageimage to "+g.pageImage),_.isUndefined(w.event.attributes.dateOfEvent)||_.isNull(w.event.attributes.dateOfEvent))i.setDescription(w.event.attributes.guestlistName);else{var c=moment(w.event.attributes.dateOfEvent).format("dddd Do MMM");i.setDescription(w.event.attributes.guestlistName+" on "+c)}return!0}return i.setTitle("Guestlist not Found"),w.controls.guestlistFound=!1,!1},L=function(){K()?J():x.error("Controller initialisation failed: Guestlist not Found!")},M=function(){var a=window.open("about:blank","_blank");setTimeout(function(){a.location.href="https://maps.google.co.uk/?q="+q.attributes.venue.attributes.venueLocation.latitude+","+q.attributes.venue.attributes.venueLocation.longitude},1001)};e.$on("leafletDirectiveMarker.click",function(){x.debug("SINGLE CLICKED PIN"),M()}),e.$on("leafletDirectiveMap.dblclick",function(){x.debug("DOUBLE CLICKED MAP"),M()}),L()}]),angular.module("cloakroomApp").controller("MemberProfileCtrl",["$log","$location","$rootScope","$scope","$stateParams","$window","TitleService","ClubCSSClasses","UserService","MemberLinkService","GoTo","parseMember","MemberPhotoService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=this,o=function(){k.event(n.member.upcoming)};n.controls={isLinking:!1,showLinkButton:!1,showAddGuestButton:!1,getClassForClub:h.getClassForClub,linking:!1,hostProfile:!0,profileFound:!0,goToUpcomingEvent:o,photoExists:!1},n.currentUser=i.currentUser,d.currentUser=n.currentUser,_.isUndefined(l)||_.isNull(l)?n.controls.profileFound=!1:n.member=l,_.isUndefined(e.byId)||_.isNull(e.byId)||_.isUndefined(l)||_.isNull(l)||_.isUndefined(l.attributes)||_.isNull(l.attributes)||_.isUndefined(l.attributes.username)||_.isNull(l.attributes.username)||(b.path("/member/"+l.attributes.username).replace(),e.id=e.byId,e.byId=void 0,b.search({})),n.member&&n.member.attributes?(d.member=n.member.attributes,g.setTitle(n.member.attributes.alias)):n.controls.profileFound=!1,n.member&&n.member.attributes.isHost&&n.member.upcoming&&(d.upcomingEvent=n.member.upcoming.attributes,d.upcomingEvent.id=n.member.upcoming.id,d.upcomingVenue=n.member.upcoming.attributes.venue.attributes),n.member&&n.member.attributes.isHost&&(d.verifiedVenues=n.member.attributes.verifiedVenues),n.member&&!n.member.attributes.firstName&&(n.controls.profileFound=!1,a.error("Did not find member with $state parameters: "+e),g.setTitle("No Member Found")),n.controls.showLinkButton=n.member&&n.member.attributes.username!==n.currentUser.username&&n.currentUser.isLogged?!0:!1,n.member&&n.member.attributes&&_.isUndefined(n.member.attributes.photoUrl)?(a.debug("No host photo, showing placeholder"),n.controls.photoExists=!1):n.member&&n.member.attributes&&!_.isUndefined(n.member.attributes.photoUrl)&&(a.debug("Host photo detected, displaying as appropriate"),n.controls.photoExists=!0),n.controls.linking=n.member&&j.isLinking(n.member)?!0:!1,n.member&&!n.member.attributes.isHost&&(n.controls.hostProfile=!1),n.controls.showAddGuestButton=n.member&&n.member.attributes.username!==n.currentUser.username&&n.currentUser.isLogged&&n.currentUser.isHost&&n.controls.linking?!0:!1;var p=function(){var b=n.controls.linking;n.controls.linking=!n.controls.linking,b?j.removeLink(n.member).then(function(a){n.controls.linking=!1,n.controls.linking=a.data},function(){n.controls.linking=!0}):j.addLink(n.member).then(function(){n.controls.linking=!0},function(b){n.controls.linking=!0,a.error(b)},function(a){_.isUndefined(a.data)&&_.isNull(a.data)||(n.controls.linking=a.data)})};d.changeOwnPhoto=function(){return m.changeOwnPhoto(n.member)},d.toggleMemberLink=_.debounce(p,2e3,{leading:!0})}]),angular.module("cloakroomApp").controller("MenuCtrl",["$rootScope","$scope","$log","GoTo","UserService","ParseUser","StatusService","memberNotification","ModalInterface","MemberPhotoService","serviceHelpers",function(a,b,c,d,e,f,g,h,i){var j=this,k=function(a){if(_.isUndefined(a)||_.isNull(a)||_.isEmpty(a.data)||_.isEmpty(a.data.attributes))return"An unknown action is required from the user. Something has gone wrong!";switch(a.data.attributes.actionRequired){case"VERIFY_MOBILE":return"For the full experience, please verify your mobile number. Cloakroom keeps your personal information private.";case"SET_PHOTO":return"You have no profile photo set!";case"SET_EMAIL":return"You email address associated with your membership.";default:return"An action is required"}},l=function(a){return a.data.attributes.fromName+" has confirmed your attendance on "+a.data.attributes.guestlistName+". "},m=function(a){if(_.isUndefined(a)||_.isNull(a))return"Nothing to see here! Something went wrong.";switch(a.type){case"ACTION_REQUIRED":return k(a);case"GUESTLIST_ACCEPTED":return l(a);default:return"Something went wrong processing this notification. Sorry!"}},n={VERIFY_MOBILE:"Mobile Unverified",SET_PHOTO:"Missing Profile Photo",SET_EMAIL:"Missing Email Address"},o=function(a,b){switch(a){case"ACTION_REQUIRED":return n[b];case"GUESTLIST_ACCEPTED":return"Guestlist Notification";default:return"Notification"}},p={ACTION_REQUIRED:{VERIFY_MOBILE:function(){return d.verifyMobile()},SET_PHOTO:function(){return d.profilePhotoPicker()},SET_EMAIL:function(){return d.editProfile()}},GUESTLIST_ACCEPTED:{"default":function(a){return d.eventByApplication(a)}}},q={ACTION_REQUIRED:{VERIFY_MOBILE:"<br> Tap/click '<str>details</str>' to <str>verify your mobile</str>.",SET_PHOTO:"<br> To <str>set your profile photo</str>, tap/click 'details'.",SET_EMAIL:"<br><br>In order to receive notifications, you should add an email address. <br> To <str>update your profile</str>, tap/click 'details'."},GUESTLIST_ACCEPTED:"<br><br> To see <str>event details</str>, or <str>edit your RSVP</str>, tap/click '<str>details</str>'."},r=function(a){if(_.isUndefined(a)||_.isNull(a))c.info("notificationDetail: notification undefined!"),c.error(a);else{if("ACTION_REQUIRED"===a.type)return p[a.type][a.data.attributes.actionRequired]();if("GUESTLIST_ACCEPTED"===a.type)return p[a.type].default(a.data.attributes.relatedApplication)}},s=function(a){var b;b="ACTION_REQUIRED"===a.type?q[a.type][a.data.attributes.actionRequired]:q[a.type];var d=m(a)+(b?" "+b:null),e="ACTION_REQUIRED"===a.type?a.data.attributes.actionRequired:"none",f=o(a.type,e),g=a.important?!1:!0,j={softCancel:!0,text:d,title:f,yesText:"Details",size:"sm",noText:"Hide Notification",showNoButton:g};i.yesNo(j).then(function(b){b===!0?(h.setSeen(a,!0),r(a),c.debug("Menu: notification now seen but not dismissed")):(h.dismiss(a),c.debug("Menu: notification seen and dismissed"))},function(){h.setSeen(a,!0),c.debug("Menu: modal closed, notification seen but not acted upon so not dismissed")})};j.controls={photoUrl:!1,photoExists:!1,generateTitle:o(),viewNotification:s,ntfcns:{setSeen:h.setSeen,remove:h.remove,hide:h.hide,view:s}},j.status=g.user,b.user=a.currentUser;var t=!1,u=function(){j.controls.photoExists||(e.currentUser.isLogged?_.isUndefined(e.currentUser.photoUrl)||_.isNull(e.currentUser.photoUrl)?(t=!1,j.controls.photoExists=!1,c.debug("Menu: User has not set photo yet")):(t=!0,j.controls.photoUrl=!0,j.controls.photoExists=!0):(t=!1,c.error("Menu: User not Logged In"),j.controls.photoUrl=!1,j.controls.photoExists=!1))};b.generateTitle=o,b.generateNotificationText=m,t||u(),a.$on("$stateChangeSuccess",function(){u()}),b.GoTo=d,b.notifications=h.ntfcns,b.notificationUpdates=h.notificationUpdates}]),angular.module("cloakroomApp").controller("OptionsViewCtrl",["$scope","TitleService","$log","GoTo","FacebookAuthentication","ErrorInterface","ParseUser",function(a,b,c,d,e,f,g){b.setTitle("Account Settings"),a.goTo=d;var h=e.fbConnect,i=e.fbDisconnect,j=function(){a.fb.processing=!0,h().then(function(){f.popup("Connected!","You have successfully linked your Facebook account to your Cloakroom account!"),a.fb.processing=!1,a.fb.isLinked=!0,a.fb.button=a.fb.isLinked?a.fb.unlink:a.fb.link,g.setParseUser()},function(b){"already_linked"===b?(f.popup("Error","You have already linked your Facebook account!"),a.fb.button=a.fb.isLinked?a.fb.unlink:a.fb.link,a.fb.processing=!1,a.fb.isLinked=!0):(f.popup("Error",b),a.fb.processing=!1,a.fb.isLinked=!1,a.fb.button=a.fb.isLinked?a.fb.unlink:a.fb.link)
})},k=function(){a.fb.processing=!0,i().then(function(){f.popup("Success","You have successfully unlinked your Facebook account from your Cloakroom account."),a.fb.processing=!1,a.fb.isLinked=!1,a.fb.button=a.fb.isLinked?a.fb.unlink:a.fb.link,Parse.User.current().set("fbId",void 0),Parse.User.current().save().then(function(a){c.debug(a),g.setParseUser()},function(a){c.error(a),g.setParseUser()})},function(b){f.popup("Error",b),a.fb.processing=!1,a.fb.isLinked=!0,a.fb.button=a.fb.isLinked?a.fb.unlink:a.fb.link})};a.fb={unlink:k,link:j,isLinked:Parse.FacebookUtils.isLinked(Parse.User.current())?!0:!1,processing:!1},a.fb.button=a.fb.isLinked?a.fb.unlink:a.fb.link}]),angular.module("cloakroomApp").controller("AboutViewCtrl",["$scope","TitleService",function(a,b){b.setTitle("About")}]),angular.module("cloakroomApp").controller("LegalViewCtrl",["$scope","TitleService","$state",function(a,b,c){"legal"===c.current.name&&b.setTitle("Legal"),"privacypolicy"===c.current.name&&b.setTitle("Privacy Policy"),"tandc"===c.current.name&&b.setTitle("Terms and Conditions")}]),angular.module("cloakroomApp").controller("HeaderCtrl",["$scope","memberNotification","snapRemote","$log","StatusService",function(a,b,c,d,e){a.notifications=b.ntfcns,a.status=e.user}]),angular.module("cloakroomApp").controller("ModalFormCtrl",["$scope","$modalInstance","ModalInterface","modalOptions",function(a,b,c,d){var e=c.defaultLink;a.title=d.title?d.title:"Form",a.text=d.text?d.text:"Fill in this form please",a.noText=d.noText?d.noText:"Cancel",a.yesText=d.yesText?d.yesText:"Submit",a.extraLink=d.extraLink?d.extraLink:e,a.firstInput=d.firstInput?d.firstInput:"Question One",a.firstInputPlaceholder=d.firstInputPlaceholder?d.firstInputPlaceholder:"First Placeholder",a.secondInput=d.secondInput?d.secondInput:"Question Two",a.secondInputPlaceholder=d.secondInputPlaceholder?d.secondInputPlaceholder:"Second Placeholder",a.showTwoInputs=d.showTwoInputs?d.showTwoInputs:!1,a.data={},a.ok=function(c){b.close(c===!0?a.data:!1)},a.dismiss=function(a){b.dismiss(a)};var f=function(a,c){return _.isUndefined(d.softCancel)||_.isNull(d.softCancel)||d.softCancel===!0?b.close(c):b.dismiss(c)};a.cancel=_.isUndefined(d.softCancel)||_.isNull(d.softCancel)||d.softCancel===!0?function(a){return f(!0,a)}:function(a){return f(!1,a)}}]),angular.module("cloakroomApp").controller("ModalYesnoCtrl",["$log","GoTo","$scope","$modalInstance","ModalInterface","modalOptions",function(a,b,c,d,e,f){var g=e.defaultLink;c.title=f.title?f.title:"Title",c.text=f.text?f.text:"Lorem ipsum dolor sit amet",c.noText=f.noText?f.noText:"No",c.yesText=f.yesText?f.yesText:"Yes",c.extraLink=f.extraLink?f.extraLink:g,c.showNoButton=f.showNoButton?f.showNoButton:!1,c.dismiss=function(a){d.dismiss(a)},c.goToExtraLink=function(){_.isUndefined(c.extraLink.href)||_.isNull(c.extraLink.href)?a.error("Link href undefined - cannot handle"):(d.dismiss({reason:"link_followed"}),b.path(c.extraLink.href))},c.ok=function(a){d.close(a)};var h=function(a,b){return _.isUndefined(f.softCancel)||_.isNull(f.softCancel)||a===!0?d.close(b):d.dismiss(b)};c.cancel=_.isUndefined(f.softCancel)||_.isNull(f.softCancel)||f.softCancel===!0?function(a){return h(!0,a)}:function(a){return h(!1,a)}}]),angular.module("cloakroomApp").controller("ChooseProfilePhotoCtrl",["$scope","$log","$stateParams","$q","ModalInterface","UserService","TitleService","ParseUser","ErrorInterface","memberNotification","lazyUc",function(a,b,c,d,e,f,g,h,i,j){g.setTitle("Choose Profile Photo");var k=this;k.vm={photo:"images/profiles/square/raibutera.jpg",outputString:"",user:f.currentUser,controls:{testing:!1}};_.isUndefined(k.vm.user.photoUrl)||_.isNull(k.vm.user.photoUrl)?k.vm.photoExists=!1:(k.vm.photoExists=!0,k.vm.photo=k.vm.user.photoUrl),k.openDialog=function(){b.debug("Picking profile pic"),uploadcare.openDialog(null,{crop:"200x200 minimum",imagesOnly:!0}).done(function(b){b.promise().done(function(b){a.$apply(function(){k.vm.photo=b.cdnUrl,k.fileInfo=b,k.vm.photoExists=!0})})})},k.finish=function(){var a=function(){var a={softCancel:!1,text:"Are you happy with your new profile photo?",title:"Please Confirm",yesText:"Yes",noText:"No",extraLink:{href:"privacy-policy",text:"visit this page",show:!1,preMessage:"For more information on our privacy policy, please"},showNoButton:!0,size:"sm"};return e.yesNo(a)},f=function(){var a={softCancel:!1,text:"Your new profile photo was successfully saved.",title:"All done!",yesText:"Okay",noText:"No",extraLink:{href:"privacy-policy",text:"visit this page",show:!1,preMessage:"For more information on our privacy policy, please"},showNoButton:!1,size:"sm"};return e.yesNo(a)},g=function(){var a=d.defer();return h.updatePhoto(k.fileInfo).then(function(b){a.resolve(b)},function(c){a.reject(c),b.error(c)}),a.promise},l=function(){_.isUndefined(c.first)||_.isNull(c.first)||c.first!==!0?f().then(function(){b.debug("modal closed")},function(){b.debug("modal closed")}):b.debug("going back to appropriate stage in signup")};a().then(function(a){_.isUndefined(a)||_.isNull(a)||a!==!0?b.error("Confirmed was called but confirmed was undefined/null or not true"):g().then(function(){b.debug("Saved!"),l(),j.GET_NEW_DATA=!0,j.dismissSetPhoto(),j.getNotifications()},function(a){b.error(a),_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.internal)||_.isNull(a.internal)||!a.internal?i.popup("Error!","There was a problem updating your profile photo. Please try again. If you continue to experience this issue, please try again later."):i.popup("Already Saved!","Your profile photo was already saved.")})},function(){b.debug("User was not happy with choice, letting them pick again")})}}]),angular.module("cloakroomApp").controller("ChangePasswordCtrl",["$scope","TitleService","$q","$log","UserService","ParseUser","serviceHelpers","cfpLoadingBar","ErrorInterface","ModalInterface","GoTo","VALID_PASSWORD_REGEX",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=this;a.VALID_PASSWORD_REGEX=l,b.setTitle("Change Password"),m.vm={buttonText:"Save",fields:{password:{value:"",modified:!1},repeatPassword:{value:"",modified:!1}}},m.controls={error:{password:!1,repeatPassword:!1},somethingModified:!1,formValid:!1};var n=["password","repeatPassword"],o=function(){var a=!0;return _(n).each(function(b){p(b)?(m.controls.error[b]=!1,d.debug(b+" is valid")):(m.controls.error[b]=!0,d.error(b+" is invalid"),d.debug("validateField: field "+b+" invalid"),a=!1)}),a?!0:!1},p=function(a){if(_.isUndefined(a))return!1;var b=!0;if("password"===a){var c=m.vm.fields.password.value,e=function(){var a=!l.test(c);return l.lastIndex=0,a};return(_.isEmpty(c)||c.length<8||c.length>32||e())&&(b=!1),b?!0:(m.vm.buttonText="New Password Invalid",!1)}if("repeatPassword"===a){var f=m.vm.fields.repeatPassword.value;return(_.isEmpty(f)||f.length<8||f.length>32||f!==m.vm.fields.password.value)&&(b=!1,m.vm.buttonText="Passwords Do Not Match"),b?!0:!1}return d.error("field '"+a+"' is unsupported by validateValue"),!1},q=function(){var a={softCancel:!1,text:"Are you sure you want to change your password? This cannot be undone",title:"Please Confirm",yesText:"Yes",noText:"Cancel",extraLink:{href:"http://www.google.com",text:"Google",show:!1,preMessage:"Why don't you google it?"},showNoButton:!0};return j.yesNo(a)},r=function(){var a={password:{modified:m.vm.fields.password.modified,value:m.vm.fields.password.value}};return f.updateUser(a)},s=function(){m.controls.somethingModified=!1,_.each(n,function(a){m.controls.somethingModified=m.controls.somethingModified===!0||m.vm.fields[a].modified===!0}),m.controls.somethingModified&&(m.vm.buttonText="Save Changes")};m.hideErrors=function(){m.vm.buttonText="Save",m.vm.fields.password.modified=!_.isEmpty(m.vm.fields.password.value),m.vm.fields.repeatPassword.modified=m.vm.fields.password.modified&&!_.isEmpty(m.vm.fields.repeatPassword.value),s(),_(n).each(function(a){m.vm.fields[a].value=m.vm.fields[a].value,p(a)?m.controls.error[a]=!1:(m.controls.error[a]=!0,d.debug("hideErrors: field "+a+" invalid"))}),m.controls.formValid=!0,_(n).each(function(a){m.controls.error[a]&&(m.controls.formValid=!1)})},m.saveChanges=function(){s(),o()&&m.controls.somethingModified?q().then(function(){m.vm.buttonText="Saving...",r().then(function(){m.vm.buttonText="Saved!";var a={softCancel:!1,text:"Your password has been changed and your new details have been saved.",title:"Password Changed!",yesText:"Okay, Take Me Back",size:"sm",noText:"No",extraLink:{href:"http://www.google.com",text:"Google",show:!1,preMessage:"Why don't you google it?"},showNoButton:!1};j.yesNo(a).then(function(){k.options()},function(){k.options()})},function(a){d.error(a)})},function(a){d.error(a)}):m.controls.somethingModified?(i.popup("Form Invalid","Please check that both passwords match, contain no spaces, are longer than 8 and shorter than 32 characters, and contain any character A-Z, a-z, 0-9"),d.error("Fields are not valid or nothing modified")):i.popup("Form Incomplete","Please fill in the form completely.")}}]),angular.module("cloakroomApp").controller("ConnectFacebookCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("cloakroomApp").controller("EditProfileCtrl",["TitleService","$q","$log","UserService","ParseUser","serviceHelpers","cfpLoadingBar","ErrorInterface","ModalInterface","GoTo","INT_PHONE_REGEX","STRING_ONLY_REGEX","UK_MOBILE_REGEX","memberNotification","EMAIL_REGEX",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=this;a.setTitle("Edit Profile"),p.vm={buttonText:"Save",fields:{firstName:{value:d.currentUser.firstName,modified:!1},lastName:{value:d.currentUser.lastName,modified:!1},mobileNumber:{value:d.currentUser.mobileNumber,modified:!1},email:{value:d.currentUser.email,modified:!1}}},p.controls={error:{firstName:!1,lastName:!1,mobileNumber:!1,email:!1},somethingModified:!1,formValid:!1};var q=["firstName","lastName","mobileNumber","email"],r=function(){var a=!0;return _(q).each(function(b){s(b)?(p.controls.error[b]=!1,c.debug(b+" is valid")):(p.controls.error[b]=!0,c.error(b+" is invalid"),c.debug("validateField: field "+b+" invalid"),a=!1)}),a?!0:!1},s=function(a){if(_.isUndefined(a))return!1;var b=!0;if("firstName"===a){if(p.vm.fields.firstName.modified){var d=f.prepareValue(p.vm.fields.firstName.value);(_.isEmpty(d)||d.length<2||d.length>11||!l.test(d))&&(b=!1)}if(b)return!0;p.vm.buttonText="First Name Invalid"}else if("email"===a){if(p.vm.fields.firstName.modified){var e=f.prepareValue(p.vm.fields.email.value);(_.isEmpty(e)||!o.test(e))&&(b=!1)}if(b)return!0;p.vm.buttonText="Email Address Invalid"}else if("lastName"===a){if(p.vm.fields.lastName.modified){var g=f.prepareValue(p.vm.fields.lastName.value);(_.isEmpty(g)||g.length<2||g.length>26||!l.test(g))&&(b=!1)}if(b)return!0;p.vm.buttonText="Last Name Invalid"}else{if("mobileNumber"!==a)return c.error("field '"+a+"' is unsupported by validateValue"),!1;if(p.vm.fields.mobileNumber.modified){var h=f.prepareValue(p.vm.fields.mobileNumber.value);_.isEmpty(h)||"+"!==h.substr(0,1)?_.isEmpty(h)||"0"!==h.substr(0,1)||("00"!==h.substr(0,2)&&"07"!==h.substr(0,2)?(c.error("Number starts with 0 but not 07"),b=!1):11!==h.length&&(c.error("07 number wrong length"),b=!1)):"+44"===h.substr(0,3)&&(13!==h.length?b=!1:(c.debug("UK number detected and length correct"),"+447"!==h.substr(0,4)&&(c.error("UK number is not a mobile"),b=!1))),(_.isEmpty(h)||h.length<10||h.length>15||!m.test(h)&&!k.test(h))&&(b=!1)}if(b)return!0;p.vm.buttonText="Invalid Mobile Number"}},t=function(){var a={softCancel:!1,text:"Are you sure you want to change your profile details?",title:"Please Confirm",yesText:"Yes",noText:"Cancel",extraLink:{href:"http://www.google.com",text:"Google",show:!1,preMessage:"Why don't you google it?"},showNoButton:!0};return i.yesNo(a)},u=function(a){return"+44"!==a.substring(0,3)&&"07"===a.substring(0,2)&&(a="+44"+a.substring(1)),a},v=function(){return _.isEmpty(p.vm.fields.mobileNumber.value)||(p.vm.fields.mobileNumber.value=u(p.vm.fields.mobileNumber.value)),e.updateUser(p.vm.fields)},w=function(){p.controls.somethingModified=!1,_.each(q,function(a){p.controls.somethingModified=p.controls.somethingModified===!0||p.vm.fields[a].modified===!0}),p.controls.somethingModified&&(p.vm.buttonText="Save Changes")};p.hideErrors=function(){p.vm.buttonText="Save",p.vm.fields.firstName.modified=p.vm.fields.firstName.value!==d.currentUser.firstName&&!_.isEmpty(p.vm.fields.firstName.value),p.vm.fields.lastName.modified=p.vm.fields.lastName.value!==d.currentUser.lastName&&!_.isEmpty(p.vm.fields.lastName.value),p.vm.fields.email.modified=p.vm.fields.email.value!==d.currentUser.email&&!_.isEmpty(p.vm.fields.email.value),p.vm.fields.mobileNumber.modified=f.convertMobile(p.vm.fields.mobileNumber.value)!==d.currentUser.mobileNumber&&!_.isEmpty(p.vm.fields.mobileNumber.value),w(),_(q).each(function(a){p.vm.fields[a].value=f.prepareValue(p.vm.fields[a].value),s(a)?p.controls.error[a]=!1:(p.controls.error[a]=!0,c.debug("hideErrors: field "+a+" invalid"))}),p.controls.formValid=!0,_(q).each(function(a){p.controls.error[a]&&(p.controls.formValid=!1)})},p.saveChanges=function(){w(),r()&&p.controls.somethingModified?t().then(function(){p.vm.buttonText="Saving...",v().then(function(){p.vm.buttonText="Saved!";var a={softCancel:!1,text:"Your profile was updated and your new details have been saved.",title:"All done!",yesText:"Okay, Take Me Back",size:"sm",noText:"No",extraLink:{href:"http://www.google.com",text:"Google",show:!1,preMessage:"Why don't you google it?"},showNoButton:!1};i.yesNo(a).then(function(){n.GET_NEW_DATA=!0,n.getNotifications(),j.options()},function(){j.options()})},function(a){c.error(a)})},function(a){c.error(a)}):p.controls.somethingModified?c.error("Fields are not valid or nothing modified"):h.popup("No changes!","You have no changes to save.")}}]),angular.module("cloakroomApp").controller("PrivacySettingsCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("cloakroomApp").controller("VerifyMobileCtrl",["$q","$log","$stateParams","$filter","$state","$scope","UserService","GoTo","TitleService","serviceHelpers","ErrorInterface","ModalInterface","cfpLoadingBar","MobVerification","ParseUser","autoVerified",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;i.setTitle("Verify Mobile");var r=["Send SMS to "+d("ukMobileNumber")(g.currentUser.mobileNumber),"Sending...","Sent!"];q.vm={ms:"",alreadyVerified:!1,success:!1,buttonText:r[0]},q.controls={showForm:!0,showButton:!0,buttonPressed:!1,showResult:!1};var s=function(){return k.popup("Oh no","Something went wrong verifying your code.<br><br>Please try again!")},t=function(a){_.isUndefined(a)||_.isNull(a)?(b.error("verifyMobile parseResults: result is not defined"),q.vm.showResult=!1,s()):(q.controls.showForm=!1,q.controls.showButton=!1,q.controls.showResult=!0,q.vm.success=a)},u=function(){return n.check(g.currentUser.associatedInvitation.id,q.vm.ms,!0)},v=function(){q.controls.showResult=!1,q.controls.showForm=!0,q.controls.showButton=!0,q.vm.buttonText=r[0]},w=function(){q.controls.checking?b.error("Still checking!"):(q.controls.checking=!0,u().then(function(a){q.controls.checking=!1,t(a)},function(a){q.controls.checking=!1,b.error(a),s()},function(a){_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.stage)||_.isNull(a.stage)?(b.error("verifyMobileCtrl: checkMS update callback - update or update.stage undefined"),q.controls.checking=!1,s()):a.stage>1?(b.debug("vMCtrl: recieved update with some data containing verification state"),q.controls.checking=!1,_.isUndefined(a.data)||_.isNull(a.data)||t(a.data)):(q.controls.checking=!0,b.debug("vMCtrl: recieved update, but no data attached, still checking"))}))},x=function(){return!_.isUndefined(q.vm.ms)&&!_.isNull(q.vm.ms)&&q.vm.ms.length>1?_.debounce(w,400,{leading:!0})():k.popup("Enter Code","Please enter a valid Verification Code to verify your mobile")},y=function(){return x()},z=function(){var a;g.currentUser.verifiedMobileNumber&&(_.isUndefined(p)||_.isNull(p)||_.isUndefined(p.data)||_.isNull(p.data)?(q.vm.alreadyVerified=!0,q.controls.showForm=!1,q.controls.showButton=!1,a=!0):b.debug("User is verified but this is because of auto verification")),_.isUndefined(c.ms)||_.isNull(c.ms)?a||(q.controls.showForm=!0,q.controls.showButton=!0,q.controls.showResult=!1):(q.vm.ms=c.ms,t(p.data))};z(),q.checkMS=y;var A=n.requestText;q.requestText=_.debounce(function(){b.debug("Controller: Requesting Text"),q.vm.buttonText=r[1],A().then(function(){q.vm.buttonText=r[2],b.debug("Text request successful"),q.controls.buttonPressed=!0},function(a){b.error(a)})},1e3,{leading:!0}),q.tryAgain=v,f.goTo=h}]),angular.module("cloakroomApp").controller("ContactCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("cloakroomApp").controller("LinksCtrl",["$log","$q","$timeout","$rootScope","cfpLoadingBar","ErrorInterface","serviceHelpers","UserService","GoTo","MemberLinkService","StatusService","memberLinks","ModalInterface",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=!0,o=this;o.vm={data:l,modified:!1},o.controls={searching:!1,hideInitial:!1,showMoreButton:!0,fetchingMore:!1},o.status=k.user;var p=function(a){return g.developerLog("LinkCtrl",a,!n)},q=function(a){p("Adding "+a.id)},r=function(b,c,d){p("Removing "+d+" ("+b+")");var e={softCancel:!1,text:"Are you sure you want to unlink "+c+"?<br>Unlinked members who host events will no longer be able to access your contact information.",title:"Unlink "+c+"?",yesText:"Yes",size:"sm",noText:"No",extraLink:{href:"http://www.google.com",text:"Google",show:!1,preMessage:"Why don't you google it?"},showNoButton:!0};m.yesNo(e).then(function(){p("Unlink confirmed");var c=new Parse.User;c.id=b;var d=new Parse.Query("CRMemberActivity");d.equalTo("activity","link"),d.equalTo("from",Parse.User.current()),d.equalTo("to",c),d.find({success:function(c){Parse.Object.destroyAll(c).then(function(){p("Destroy success");var a=_.reject(o.vm.data,function(a){return a.id===b});o.vm.data=a,o.vm.modified=!0;var c=_.reject(o.search.results,function(a){return a.id===b});o.search.results=c},function(b){a.error("destroyAll failed"),a.error(b),f.popup("Sorry","There was an error removing that link. Please try again, or try later if the problem persists.")})},error:function(b){a.error("Query failed"),a.error(b),f.popup("Sorry","There was an error removing that link. Please try again, or try later if the problem persists.")}})},function(){p("Unlink cancelled")})},s=function(){var c,d=b.defer();return _.isUndefined(o.vm.data)||_.isNull(o.vm.data)||_.isEmpty(o.vm.data)?(c=!1,d.reject({hasMore:!1,hasAny:!1})):o.vm.data.length<10||o.vm.data.length%10!==0?(d.reject({hasMore:!1,hasAny:!0}),c=!1):c=!0,c===!0&&(p("Getting the next 10 links after an initial "+o.vm.data.length),j.getLinks(null,{limit:10,skip:o.vm.data.length}).then(function(a){p("Successfully retrieved extra "+a.length+" links"),o.vm.data=o.vm.data.concat(a),d.resolve(a)},function(b){a.error(b),d.reject(b),f.popup("Oh no!","There was a problem retrieving your links.")})),d.promise},t=function(){p("Going to next page"),o.controls.fetchingMore=!0,s().then(function(){o.controls.fetchingMore=!1,p("Fetch successful")},function(b){o.controls.fetchingMore=!1,a.error("fetch failed: "+JSON.stringify(b))})},u=function(){p("Going to previous page")},v=function(){o.search.ongoing=!0,Parse.Cloud.run("searchLinks",{find:o.searchTerm}).then(function(b){var c=_.map(b,function(a){return a.id});Parse.Cloud.run("interpretLinks",{list:c}).then(function(a){o.search.ongoing=!1,o.search.results=a,o.controls.hideInitial=!0},function(b){o.search.ongoing=!1,o.search.results=[],o.controls.hideInitial=!1,a.error(b)})},function(b){o.controls.hideInitial=!1,o.search.ongoing=!1,o.search.results=[],a.error(b)})},w=function(){_.isUndefined(o.searchTerm)||_.isNull(o.searchTerm)||_.isEmpty(o.searchTerm)?(_.isUndefined(o.searchTerm)||_.isNull(o.searchTerm)||_.isEmpty(o.searchTerm)||o.searchTerm.length<3)&&(p("search term undefined"),o.controls.searching=!1,o.search.ongoing=!1,o.controls.hideInitial=!1):o.searchTerm.length>2&&(p("search term defined"),o.controls.searching=!0,o.search.ongoing=!0,_.debounce(v,250),c(_.debounce(v,250),250))};o.search={ongoing:!0,results:[]},o.clearSearch=function(){o.searchTerm=""};var x=function(a){return i.profile(a,!0)};o.actions={addLink:q,unlink:r,nextPage:t,prevPage:u,searching:w,viewProfile:x},o.searchTerm=""}]),angular.module("cloakroomApp").service("GoTo",["$log","$state","$location","UserService","$window","ApplicationService",function(a,b,c,d,e,f){var g=this,h=function(b){c.path(b),a.debug("TRANSITION: attempting to go to location "+b)};g.backPage={path:""},g.clearBack=function(){g.backPage={path:""},a.debug("GoTo: clearing backPage ")},g.storeBack=function(b){a.debug("GoTo: Storing path "+b+" in GoTo.backPage"),g.backPage={path:b}},g.goBackToBackPage=function(){return a.debug("GoTo: Going back to "+g.backPage.path),h(g.backPage.path)},this.boomerangEventLogin=function(c,e){d.currentUser.isLogged?a.error("trying to boomerang login when user is already logged in!"):b.go("login",{goBackToEvent:c,processApplication:e})},this.path=function(a){"/"===a.substr(0,1)?h(a):e.location.href=a},this.event=function(a){return h("/event/"+a.id+"/")},this.profile=function(a,b){return h(_.isUndefined(b)||_.isNull(b)?"/member/"+a.attributes.username:"/member/"+a)},this.profilePhotoPicker=function(){return h("/choose-photo")},this.editProfile=function(){return h("/edit-profile")},this.changePassword=function(){return h("/change-password")},this.addRemoveLinks=function(){return h("/links")},this.privacySettings=function(){return h("/privacy-settings")},this.contactUs=function(){return h("/contact")},this.legal=function(){return h("/legal")},this.home=function(){return h("/home")},this.options=function(){return h("/settings")},this.about=function(){return h("/about")},this.legal=function(){return h("/legal")},this.eventByApplication=function(b){f.getEventId(b).then(function(a){return h("/event/"+a+"/")},function(b){a.error(b)})},this.createMembership=function(){return h("/membership/")},this.verifyMobile=function(){return h("/verify-mobile/")}}]),angular.module("cloakroomApp").config(["$stateProvider","$urlRouterProvider",function(a){a.state("event",{"abstract":!0,template:"<div><div ui-view></div></div>",controller:"GuestlistCtrl as Guestlist",url:"/event/:eventId",resolve:{lazyMaps:["$state","$q","$ocLazyLoad","$log",function(a,b,c,d){var e=b.defer();return c.load([{files:["/vendor/js/leaflet.js"]},{name:"leaflet-directive",files:["/vendor/js/angular-leaflet-directive.min.js"]}]).then(function(a){d.debug("states/event.js: successfully lazily loaded leaflet api"),e.resolve({status:"success",data:a})},function(a){e.resolve({status:"error",data:a}),d.error(a)}),e.promise}],guestlistFound:["$state","$stateParams","$q","GuestlistService",function(a,b,c,d){var e=c.defer();return d.getGuestlistById(b.eventId).then(function(a){e.resolve(a)},function(a){console.error(a),e.resolve()}),e.promise}],cachedApplications:["UserService","ApplicationService",function(a,b){return a.currentUser.isLogged?b.getMemberApplications():!0}]}}).state("event.apply",{templateUrl:"/views/event/apply/apply.html",url:"/apply/"}).state("event.confirmation",{templateUrl:"/views/event/apply/confirmation.html",url:"/apply/confirmation/"}).state("event.detail",{templateUrl:"/views/event/detail.html",url:"/"})}]),angular.module("cloakroomApp").config(["$stateProvider","$urlRouterProvider",function(a){a.state("login",{templateUrl:"/views/login.html",controller:"LoginCtrl as Login",url:"/login?method&goBackToEvent&processApplication"}).state("error",{templateUrl:"/views/error.html",controller:"ErrorViewCtrl as ErrorView",url:"/error?id"}).state("home",{templateUrl:"/views/member/home.html",url:"/home",controller:"MemberHomeCtrl as Home",resolve:{memberApplications:["ApplicationService","$q","$log",function(a,b,c){var d=b.defer();return a.getMemberApplications().then(function(a){d.resolve(a)},function(a){c.error(a),d.resolve()}),d.promise}],recentActivities:["recentActivitiesService","$q",function(a,b){var c=b.defer();return a.get().then(function(){c.resolve(a.data)},function(a){c.resolve({status:"error",error:a})}),c.promise}],memberLinks:["MemberLinkService","$q","$log",function(a,b,c){var d=b.defer();return a.getLinks("guestlists").then(function(a){d.resolve(a)},function(a){c.error(a),d.resolve()}),d.promise}],linkedEvents:["MemberLinkService","$q","$log",function(a,b,c){var d=b.defer();return a.getLinkedEvents().then(function(a){d.resolve(a)},function(a){c.error(a),d.resolve()}),d.promise}],eventSuggestions:["SuggestionsService","$q","$log","CLOAKROOM_IN_DEVELOPMENT",function(a,b,c,d){var e=b.defer();return a.getSuggestions({numberOfEvents:3}).then(function(a){e.resolve(a),d&&(c.debug("state resolve suggestions results:"),c.table(a))},function(a){e.resolve({status:"error",error:a}),c.error(a)}),e.promise}]}})}]),angular.module("cloakroomApp").config(["$stateProvider","$urlRouterProvider",function(a){a.state("profile",{templateUrl:"/views/member/profile.html",controller:"MemberProfileCtrl as Profile",url:"/member/:id?byId",resolve:{parseMember:["MemberService","$state","$stateParams","$q",function(a,b,c,d){var e=d.defer();return _.isUndefined(c.byId)||_.isNull(c.byId)&&!_.isUndefined(c.id)&&!_.isNull(c.id)?(a.getAlias(c.id).then(function(a){e.resolve(a)},function(a){console.error(a),e.resolve()}),e.promise):_.isUndefined(c.byId)||_.isNull(c.byId)||"undefined"===c.byId?d.when():(a.getId(c.byId).then(function(a){e.resolve(a)},function(a){console.error(a),e.resolve()}),e.promise)}],memberLinks:["UserService","MemberLinkService","$q",function(a,b,c){if(a.currentUser.isLogged){var d=c.defer();return b.getLinks().then(function(a){d.resolve(a)},function(){d.resolve()}),d.promise}return c.when()}]}})}]),angular.module("cloakroomApp").config(["$stateProvider","$urlRouterProvider",function(a){a.state("membership",{"abstract":!0,url:"/membership",template:"<div><div ui-view></div></div>"}).state("membership.new",{url:"/?by&inv&ms",templateUrl:"/views/membership/new.html",controller:"MembershipCtrl as Membership",resolve:{invitedBy:["$stateParams",function(a){return!_.isNull(a.by)&&_.isNull(a.inv)?a.by:void 0}],inProgress:["SignupService","$state",function(a){return a.getInProgress()}],invitation:["$stateParams","SignupService","$q",function(a,b,c){if(_.isUndefined(a.inv)||_.isNull(a.inv)){var d=c.defer();return d.resolve(),d.promise}console.log(a.inv);var e=a.inv;return b.getInvitation(e)}],checkSecret:["UserService","MobVerification","$stateParams","$q","$log",function(a,b,c,d,e){var f=d.defer();return _.isUndefined(c.ms)||_.isNull(c.ms)||_.isUndefined(c.inv)||_.isNull(c.inv)?(e.debug("verify mobile was not passed a mobilesecret in state params"),f.resolve(!1)):(e.debug("signup was passed verification code"+c.ms+" and invitation code"+c.inv+" in state params"),a.currentUser.verifiedMobileNumber?(e.debug("No need to run state resolve auto"),f.resolve(!1)):b.check(c.inv,c.ms,!1).then(function(a){_.isUndefined(a)||_.isNull(a)?(e.error("MobVerification check result is undefined"),f.resolve()):f.resolve({data:!0})},function(){f.resolve(!1)})),f.promise}]}}).state("alias",{templateUrl:"/views/membership/new/choose-alias.html",controller:"ChooseAliasCtrl as Alias",url:"/alias",resolve:{inProgress:["SignupService","$state",function(a){return a.getInProgress()}]}})}]),angular.module("cloakroomApp").config(["$stateProvider","$urlRouterProvider",function(a){a.state("options",{templateUrl:"/views/settings.html",controller:"OptionsViewCtrl as Options",url:"/settings",resolve:{}}).state("profilephoto",{templateUrl:"/views/options/profile-photo.html",controller:"ChooseProfilePhotoCtrl as picker",url:"/choose-photo?first",resolve:{lazyUc:["$state","$q","$ocLazyLoad","$log",function(a,b,c,d){var e=b.defer();return c.load([{files:["//ucarecdn.com/widget/1.4.0/uploadcare/uploadcare-1.4.0.min.js"]}]).then(function(a){d.debug("states/options.js: successfully lazily loaded uploadcare api"),e.resolve({status:"success",data:a})},function(a){e.resolve({status:"error",data:a}),d.error(a)}),e.promise}]}})}]),angular.module("cloakroomApp").config(["$stateProvider","$urlRouterProvider",function(a){a.state("about",{templateUrl:"/views/about.html",controller:"AboutViewCtrl as About",url:"/about",resolve:{fakeResolution:["$q",function(a){var b=a.defer();return b.resolve(),b.promise}]}}).state("legal",{templateUrl:"/views/legal.html",controller:"LegalViewCtrl as Legal",url:"/legal",resolve:{fakeResolution:["$q",function(a){var b=a.defer();return b.resolve(),b.promise}]}}).state("tandc",{templateUrl:"/views/tandc.html",controller:"LegalViewCtrl as Legal",url:"/terms-and-conditions",resolve:{fakeResolution:["$q",function(a){var b=a.defer();return b.resolve(),b.promise}]}}).state("privacypolicy",{templateUrl:"/views/privacy-policy.html",controller:"LegalViewCtrl as Legal",url:"/privacy-policy",resolve:{fakeResolution:["$q",function(a){var b=a.defer();return b.resolve(),b.promise}]}}).state("contact",{templateUrl:"/views/contact.html",controller:"ContactCtrl as contact",url:"/get-in-touch",resolve:{fakeResolution:["$q",function(a){var b=a.defer();return b.resolve(),b.promise}]}})}]),angular.module("cloakroomApp").config(["$stateProvider","$urlRouterProvider",function(a){a.state("links",{templateUrl:"/views/member/my-links.html",controller:"LinksCtrl as links",url:"/my-links",resolve:{memberLinks:["UserService","MemberLinkService",function(a,b){return a.currentUser.isLogged?b.getLinks(null,{limit:10,skip:0}):void 0}]}}).state("privacysettings",{templateUrl:"/views/member/privacy-settings.html",controller:"PrivacySettingsCtrl as privacy",url:"/privacy-settings",resolve:{}}).state("password",{templateUrl:"/views/member/password.html",controller:"ChangePasswordCtrl as password",url:"/change-password"}).state("connectfacebook",{templateUrl:"/views/member/connect-facebook.html",controller:"ConnectFacebookCtrl as fbconnect",url:"/connect-facebook"}).state("editprofile",{templateUrl:"/views/member/edit-profile.html",controller:"EditProfileCtrl as edit",url:"/edit-profile"}).state("verifymobile",{templateUrl:"/views/member/verify-mobile.html",controller:"VerifyMobileCtrl as verification",url:"/verify-mobile/?ms",resolve:{autoVerified:["memberNotification","UserService","MobVerification","ParseUser","$stateParams","$q","$log",function(a,b,c,d,e,f,g){var h=f.defer();return b.currentUser.isLogged?_.isUndefined(e.ms)||_.isNull(e.ms)?(g.debug("verify mobile was not passed a mobilesecret in state params"),h.resolve()):(g.debug("verify mobile was passed code"+e.ms+" in state params"),b.currentUser.verifiedMobileNumber?(g.debug("No need to run state resolve auto"),h.resolve()):c.auto(e.ms).then(function(b){_.isUndefined(b)||_.isNull(b)?(g.error("MobVerification check result is undefined"),h.resolve()):(d.refresh(),a.GET_NEW_DATA=!0,h.resolve({data:b}))},function(){h.resolve(!1)})):h.resolve(),h.promise}]}})}]),angular.module("cloakroomApp").service("UserService",["$log","$http","$rootScope","$q","ApplicationService","StatusService",function(a,b,c,d,e,f){var g=this;this.currentUser={isLogged:!1},this.setUser=function(b){if(b.isLogged){a.debug("setting current user to "+b.id);var c=b;b.lastUpdated=moment(),g.currentUser=c,_.isUndefined(b.photoUrl)||_.isNull(b.photoUrl)?f.update("photo",!1):f.update("photo",!0)}else a.debug("setting current user to logged out"),g.resetUser()},this.currentParseUser={isLogged:!1},this.resetUser=function(){c.currentUser=null,this.currentUser=null,this.currentUser={isLogged:!1}}}]),angular.module("cloakroomApp").factory("AuthenticationService",["$log","$q","UserService","MemberService","ParseUser",function(a,b,c,d,e){var f=function(a){return a.replace(/[\-\s\(\)]+/g,"")},g=function(a){a=f(a);var b=/^[A-Za-z]+$/,c=/^\(?(?:(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?\(?(?:0\)?[\s-]?\(?)?|0)(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}|\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4}|\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3})|\d{5}\)?[\s-]?\d{4,5}|8(?:00[\s-]?11[\s-]?11|45[\s-]?46[\s-]?4\d))(?:(?:[\s-]?(?:x|ext\.?\s?|\#)\d+)?)$/,d=/^\s*(?:\+?(\d{1,3}))?[-. (]*(\d{3})[-. )]*(\d{3})[-. ]*(\d{4})(?: *x(\d+))?\s*$/g;
return b.test(a)?"alias":c.test(a)?"mobile":d.test(a)?"international":!1},h=function(c,e){var h=b.defer();switch(c=f(c),g(c)){case"alias":c=c.toLowerCase(),Parse.User.logIn(c,e,{success:function(a){h.resolve(a)},error:function(b,f){/^[a-z]+$/.test(c)&&d.getAlias(c,["username"]).then(function(b){if(_.isUndefined(b)||_.isNull(b))h.reject("Fallback Login Failed: No such user");else{var c=b.attributes.username,d=e;Parse.User.logIn(c,d,{success:function(a){h.resolve(a)},error:function(b){a.error("Fallback Login Failed: Parse.User.logIn unsuccessful - "+JSON.stringify(b)),h.reject(b)}})}},function(a,b){h.reject(b)}),h.reject(f)}});break;case"mobile":"+44"!==c.substring(0,3)&&"07"===c.substring(0,2)&&(c="+44"+c.substring(1));d.getMobile(c,["username"]).then(function(a){_.isUndefined(a)||_.isNull(a)?h.reject("Logging in via Mobile Number Failed - Could Not Find User"):Parse.User.logIn(a.attributes.username,e,{success:function(a){h.resolve(a)},error:function(a,b){h.reject(b)}})},function(a,b){h.reject(b)}),a.error("we cant log in via mobile number on parse yet");break;default:h.reject("Input is neither alias nor mobile")}return h.promise},i=function(){var d=b.defer();return Parse.User.current()?e.logout().then(function(){c.resetUser(),d.resolve()},function(a){d.reject(a)}):(d.reject("no parse user to logout"),a.error("no parse user to logout!")),d.promise};return{isAliasOrMobile:g,parseLogin:h,logout:i}}]),angular.module("cloakroomApp").service("ApplicationService",["cr","crLog","$q","$http","$rootScope","serviceHelpers","GuestlistService","StatusService","CacheService","ModalInterface","ErrorInterface","CLOAKROOM_IN_DEVELOPMENT","cfpLoadingBar",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b.create("ApplicationService",!1,"blue"),o=!0,p=!0,q=this,r=!1;this.applicationCache={},this.clearCache=function(){r=!1,q.applicationCache=null,q.applicationCache={}},this.getEventId=function(a){var b=c.defer(),d=_.findIndex(q.applicationCache,function(b){return b.id===a.id});if(-1!==d)n.debug("Application found in application cache"),b.resolve(q.applicationCache[d].attributes.guestlist.id);else{n.debug("Application not found in application cache");var e=new Parse.Query("CRApplication");e.get(a.id,{success:function(a){b.resolve(a.attributes.guestlist.id)},error:function(a){b.reject(a)}})}return b.promise},this.getMemberApplications=function(){var a=moment(f.getTimeReference()),b=c.defer(),d=new Parse.Query("CRApplication");return d.equalTo("isOriginal",!0),d.ascending("createdAt"),d.equalTo("member",Parse.User.current()),d.include(["guestlist","guestlist.venue","guestlist.memberHost"]),d.find().then(function(c){!l||l&&o===!0?(n.debug("Cloakroom not in development - purging invalid applications"),c=_.filter(c,function(b){var c=!(_.isUndefined(b.attributes)||_.isNull(b.attributes)||_.isUndefined(b.attributes.guestlist)||_.isNull(b.attributes.guestlist)||_.isUndefined(b.attributes.guestlist.attributes.venue)||_.isNull(b.attributes.guestlist.attributes.venue)||_.isUndefined(b.attributes.guestlist.attributes.memberHost)||_.isNull(b.attributes.guestlist.attributes.memberHost));if(p){{moment().startOf("week").toJSON()}c=c&&!moment(b.attributes.guestlist.attributes.dateOfEvent).isBefore(a)}return c})):n.debug("Cloakroom in development - keeping invalid applications"),c=_.sortBy(c,function(a){return a.attributes.guestlist.attributes.dateOfEvent}),_.isUndefined(c)||_.isNull(c)?(n.debug("AS + SS: user has no applications"),h.update("applications",!1)):_.isEmpty(c)?(n.debug("AS + SS: user has no applications"),h.update("applications",!1)):(n.debug("AS + SS: user has applications"),h.update("applications",!0)),r||(q.applicationCache=c,r=!0),e.applicationCache=q.applicationCache,b.resolve(c)},function(a){b.reject(a)}),b.promise},this.checkInProgress=function(){var b=c.defer();return i.loadAll().then(function(){i.hasExpired("newApplication").then(function(c){if(a.exists(c)&&a.exists(c.hasExpired)&&"not_expired"===c.hasExpired){var d;a.exists(c.cacheData)&&(d=c.cacheData),_.isNull(d)||_.isUndefined(d)||d.isMember!==!0||d.needsProcessing!==!0?(n.debug("No new application to process"),b.resolve()):q.processApplication(d.objectId).then(function(a){n.debug("checkInProgress: successfully processed newApplication"),i.unset("newApplication").then(function(){n.debug("checkInProgress: successfully cleared newApplication cache"),b.resolve(a)},function(a){n.error("failed to clear newApplication cache"),b.reject(a)})},function(a){n.error("failed to process application!"),b.reject(a)})}else n.debug("newApplication cache empty"),b.resolve()},function(a){n.error("ApplicationService: failed to get in progress: "),n.error(a)})},function(a){b.reject(a)}),b.promise},this.processApplication=function(a){var b=c.defer();n.debug("processing application "+a+" on Parse!");var d=Parse.User.current().id;return Parse.Cloud.run("processApplication",{id:a,member:d},{success:function(a){n.debug("ApplicationService: processed application via cloud code"),r=!1,b.resolve(a)},error:function(a){n.error("ApplicationService: Application Processing FAILED"),n.error(a),b.reject(a)}}),b.promise},this.createApplication=function(b){m.start();var d,e,f,g=function(a){return a.replace(/[\-\s\(\)]+/g,"")};d=c.defer(),f=new Parse.Object("CRApplication"),a.exists(b.member)&&a.exists(b.member.id)&&(e=b.member.id);var j=!0;if(_.isUndefined(e))if(n.debug("making an application without user reference"),b.isMember)f.set("isMember",!0),f.set("needsProcessing",!0);else{if(f.set("isMember",!1),_.isUndefined(b.nonMemberName)||_.isNull(b.nonMemberName))m.complete(),d.reject("no nonMemberName for !isMember"),j=!1;else{var k,l,o=b.nonMemberName.split(" ");o.length>1?(k=o[0],l=o[o.length-1],f.set("firstName",k),f.set("lastName",l)):f.set("firstName",b.nonMemberName)}_.isUndefined(b.nonMemberNumber)||_.isNull(b.nonMemberNumber)?(m.complete(),d.reject("no nonMemberNumber for !isMember"),j=!1):f.set("mobileNumber",g(b.nonMemberNumber))}else Parse.User.current()?(n.debug("making a new application for %j",Parse.User.current().id),f.set("isMember",!0),f.set("member",Parse.User.current())):(n.error("ApplicationService: could not create application for user "+e+"because user is not logged in"),m.complete(),d.reject());if(j){var p=parseInt(b.malePlusOne),q=parseInt(b.femalePlusOne);_.isUndefined(b.isMember)||_.isNull(b.isMember)||b.isMember!==!1||f.set("isOriginal",!0),f.set("malePlusOne",p),f.set("femalePlusOne",q),f.set("guestlist",{__type:"Pointer",className:"CRGuestlist",objectId:b.guestlist.id}),f.set("processed",!1),f.set("altered",!0),f.save().then(function(c){if(n.debug("ApplicationService: saving new application success!"),m.set(80),r=!1,h.update("applications",!0),a.exists(c)){var e={id:c.id||c.objectId,malePlusOne:p,femalePlusOne:q,guestlist:{__type:"Pointer",className:"CRGuestlist",objectId:b.guestlist.id},isMember:f.get("isMember"),processed:c.get("processed"),needsProcessing:c.get("needsProcessing"),altered:c.get("altered"),isOriginal:c.get("isOriginal"),member:c.get("member"),nonMemberName:c.get("nonMemberName"),mobileNumber:c.get("mobileNumber"),firstName:c.get("firstName"),lastName:c.get("lastName")};e.objectId=e.id,i.set("newApplication",e).then(function(a){m.complete(),d.resolve(a),n.debug(a)},function(a){m.complete(),d.reject(a)})}else m.complete(),d.resolve()},function(a,b){n.error("ApplicationService: saving new application failed!"),n.error(b),n.error(a),d.reject(b),m.complete()})}return d.promise},this.deleteApplication=function(a,b){var d=c.defer(),e={softCancel:!1,text:"Are you sure you want to cancel your application to "+b+"?",title:"Confirm Cancel",yesText:"Yes",size:"sm",noText:"No",extraLink:{href:"http://www.google.com",text:"Google",show:!1,preMessage:"Why don't you google it?"},showNoButton:!0};return j.yesNo(e).then(function(){var c=new Parse.Query("CRApplication");c.get(a,{success:function(c){_.isUndefined(c)||_.isNull(c)?(n.error("deleteApplication - no results found for get "+a),k.popup("Oh no..","There was a problem with deleting your application"),d.reject("No results")):c.attributes.member.id===Parse.User.current().id?c.destroy().then(function(){k.popup("RSVP Cancelled","You are no longer associated with "+b+". Thank you for using Cloakroom!"),d.resolve({status:"success"}),r=!1},function(a,b){k.popup("Oh no..","There was a problem with deleting your application"),d.reject(b)}):(n.error("deleteApplication - application id does not match current user's"),k.popup("Oh no..","There was a problem with deleting your application"))},error:function(a,b){d.reject(b)}})},function(){d.resolve({status:"cancelled"})}),d.promise},this.getStatus=function(a){if(_.isUndefined(a)||_.isNull(a)||!_.isObject(a)||_.isUndefined(a.id)||_.isNull(a.id)||_.isUndefined(a.attributes)||_.isNull(a.attributes))return"invalid";var b=a.attributes.isMember,c=a.attributes.onList,d=a.attributes.altered,e=a.attributes.checkedIn,f=a.attributes.processed,g=a.attributes.malePlusOne,h=a.attributes.femalePlusOne;return _.isUndefined(g)||_.isNull(g)||_.isUndefined(h)||_.isNull(h)?"invalid":d===!1&&c===!1&&f?"rejected":b||f?c&&d?"modified":c&&!d?e?"complete":"accepted":!c&&d?"applied":void 0:"unprocessed"},this.updateApplication=function(a,b){var d=c.defer(),e=new Parse.Query("CRApplication");return e.get(a,{success:function(a){n.debug("ApplicationService: Successfully retrieved object to update"),a.set("femalePlusOne",parseInt(b.femalePlusOne)),a.set("malePlusOne",parseInt(b.malePlusOne)),a.set("altered",!0),a.save(null,{success:function(a){n.debug("ApplicationService: application update successful"),d.resolve(a),r=!1},error:function(a,b){n.error("ApplicationService: unable to update application"),d.reject(b)}})},error:function(a){n.error("ApplicationService: unable to retrieve original object to update"),d.reject(a)}}),d.promise}}]),angular.module("cloakroomApp").service("GuestlistService",["$log","$q","$http","cfpLoadingBar",function(a,b,c,d){this.getGuestlistById=function(c){d.start();var e=b.defer();_.isUndefined(c)&&(d.complete(),e.reject("getGuestlistById was passed an undefined id!"));var f=new Parse.Query("CRGuestlist");return f.include(["venue","memberHost"]),f.get(c,{success:function(a){d.complete(),e.resolve(a)},error:function(b,c){d.complete(),a.error(c),e.reject(c)}}),e.promise},this.getGuestlistByEventUrl=function(a){var d=b.defer();return c.get("http://localhost:1337/api/guestlist/"+a).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},this.getGuestlists=function(){var a=b.defer();return c.get("http://localhost:1337/api/guestlists/").success(function(b){a.resolve(b)}).error(function(b){a.reject(b)}),a.promise}}]),angular.module("cloakroomApp").service("MemberService",["$q","$log","ErrorInterface","cfpLoadingBar",function(a,b,c,d){var e=this,f=function(a){return a.replace(/[\-\s\(\)]+/g,"")},g=function(a){a=f(a);var b=/^[A-Za-z]+$/,c=/^\(?(?:(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?\(?(?:0\)?[\s-]?\(?)?|0)(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}|\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4}|\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3})|\d{5}\)?[\s-]?\d{4,5}|8(?:00[\s-]?11[\s-]?11|45[\s-]?46[\s-]?4\d))(?:(?:[\s-]?(?:x|ext\.?\s?|\#)\d+)?)$/,d=/^\s*(?:\+?(\d{1,3}))?[-. (]*(\d{3})[-. )]*(\d{3})[-. ]*(\d{4})(?: *x(\d+))?\s*$/g;return b.test(a)?"alias":c.test(a)?"mobile":d.test(a)?"international":!1},h=function(a){if(a&&(a=f(a)),a)if(a&&14===a.length){var c=a.substring(0,4);if("0044"===c)return"+44"+a.substring(4)}else{if(!a||13===a.length||"+44"===a.substring(0,3))return b.debug("using raw mobile number "+a),a;if("07"===a.substring(0,2)){var d="+44"+a.substring(1);return b.debug("converted "+a+" to "+d),d}}else b.error("could not parse mobile number - no input")},i=function(a,c){if(a&&a.attributes&&a.attributes.isHost){var d,e=new Date,f=moment(e).subtract("1","day").startOf("day").add("6","hours").toDate(),g=moment(e).startOf("day").add("6","hours").toDate();moment(e).hour()<6?d=f:moment(e).hour()>=6?d=g:b.error("MemberService.getUpcomingEvent: could not determine reference hour"),b.debug("Getting first guestlist after "+d);var h=a,i=new Parse.Query("CRGuestlist");i.equalTo("memberHost",a),i.greaterThan("dateOfEvent",d),i.ascending("dateOfEvent"),i.select(["venue","dateOfEvent","guestlistName","eventUrl"]),i.include("venue"),i.first({success:function(a){b.debug("upcoming guestlist Parse.com query successful"),h.upcoming=a,b.debug("extended member object: %j",h),c.resolve(h)},error:function(a,d){c.resolve(h),b.error("Unable to get Upcoming Guestlist for Host Member"),b.error(d)}})}else c.resolve(a)};this.getMember=function(c,d){b.debug("Getting Member with id "+c);var e=a.defer(),f=new Parse.Query("User");return f.include("verifiedVenues"),d&&(b.debug("Member query selecting fields "+d),f.select(d)),f.get(c,{success:function(a){i(a,e)},error:function(a,c){b.error("Parse Error",c.code+": "+c.message),e.reject(c)}}),e.promise},this.getAlias=function(c,e,f){d.start();var g=a.defer(),h=new Parse.Query("User");return h.equalTo("username",c.toLowerCase()),h.include("verifiedVenues"),e&&(b.debug("Member query selecting fields "+e),h.select(e)),f===!0&&h.select(["firstName","username","alias"]),h.first({success:function(a){d.complete(),f?g.resolve(a):i(a,g)},error:function(a){var c="MS.getAlias: Parse Error ";_.isUndefined(a)||_.isNull(a)||(_.isUndefined(a.code)||_.isNull(a.code)?c+=a:c=c+a.code+": "+a.message),b.error(c),g.reject(a)}}),g.promise},this.getMobile=function(c,e,f){d.start();var g=a.defer(),j=new Parse.Query("User");return c=h(c),j.equalTo("mobileNumber",c),f||j.include("verifiedVenues"),e&&(b.debug("Member query selecting fields "+e),j.select(e)),f===!0&&j.select(["firstName","username","alias","mobileNumber"]),j.first({success:function(a){f?g.resolve(a):i(a,g),d.complete()},error:function(a,b){g.reject(b),d.complete()}}),g.promise},this.getAliasOrMobile=function(a,c,d){var f=g(a);return f===!1?(b.error("Not an alias or mobile"),!1):"alias"===f||"mobile"===f?e.cloudMember(a,c,d):void 0},this.getId=function(c,e){d.start();var f=a.defer();if(_.isUndefined(c)||_.isNull(c)||"undefined"===c)b.error("id is blank!"),f.resolve();else{var g=new Parse.Query("User");g.include("verifiedVenues"),_.isUndefined(e)||_.isNull(e)||e!==!0||g.select(["firstName","username","alias"]),g.get(c,{success:function(a){d.complete(),e?f.resolve(a):i(a,f)},error:function(a){var c="MS.getId: Parse Error ";_.isUndefined(a)||_.isNull(a)||(_.isUndefined(a.code)||_.isNull(a.code)?c+=a:c=c+a.code+": "+a.message),b.error(c),f.reject(a)}})}return f.promise},this.cloudMember=function(c,e,f){var g=a.defer();return e.credential=c,Parse.Cloud.run("getMember",e,{success:function(a){d.complete(),f?g.resolve(a):i(a,g)},error:function(a){var c="MS.getAlias: Parse Error ";_.isUndefined(a)||_.isNull(a)||(_.isUndefined(a.code)||_.isNull(a.code)?c+=a:c=c+a.code+": "+a.message),b.error(c),g.reject(a),d.complete(),g.reject(a)}}),g.promise},this.updateMember=function(b){var c=a.defer(),d=new Parse.Query("User");return d.get(b,{success:function(a){c.resolve(a)},error:function(a){c.reject(a)}}),c.promise}}]),angular.module("cloakroomApp").service("MemberLinkService",["$rootScope","$log","$http","$q","UserService","CacheService","CLOAKROOM_IN_DEVELOPMENT","ApplicationService","StatusService","cfpLoadingBar","crLog",function(a,b,c,d,e,f,g,h,i,j,k){var l=this,m=k.create("MemberLinkService",g,"purple");this.linkCache={},this.linkedGuestlistsCache={},this.linkedEventsCache={},this.linkedHosts={all:[]},a.linkCache=this.linkCache,a.linkedHosts=this.linkedHosts,this.linkBuffer=[],this.unlinkBuffer=[];var n=function(){l.linkBuffer=[],l.unlinkBuffer=[]},o=function(a,b){return b.push(a)};this.getLinkCache=function(){return l.linkCache},this.getLinkedEvents=function(){var a=d.defer();return Parse.User.current()?Parse.Cloud.run("getLinkedGuestlists").then(function(b){m.info(" successfully retrieved getLinkedEvents"),l.linkedEventsCache=b,a.resolve(b)},function(b){m.error(b),a.reject(b)}):a.reject("getLinkedEvents: Not Logged In"),a.promise};var p=function(a){return a=_.filter(a,function(a){var b=!(_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.list)||_.isNull(a.list)||_.isUndefined(a.host)||_.isNull(a.host)||_.isUndefined(a.list.id)||_.isNull(a.list.id)||_.isUndefined(a.host.id)||_.isNull(a.host.id)||_.isUndefined(a.list.attributes)||_.isNull(a.list.attributes)),c=!0;return c&&(b=b&&a.host.id!==e.currentUser.id),b})},q=function(a){return a=_.map(a,function(a){return{type:"host",list:a.list,host:a.host,info:{linksAttending:0}}})},r=function(a,b){return a=_.reject(a,function(a){return _.isUndefined(a.list)||_.isNull(a.list)?!1:_.contains(b,a.list.id)?!0:!1})};this.getLinks=function(b,c){var e,j,k=d.defer();"guestlists"===b?(m.info("getLinks: required response is guestlists"),j=!1,e=!0):"links"===b||_.isUndefined(b)||_.isNull(b)?(m.info("getLinks - required response is normal"),j=!0):m.error("getLinks was passed an unsupported requiredResponse argument of "+b);var n={thumbnail:!1,hosts:!1};_.isUndefined(c)||_.isNull(c)||(_.isUndefined(c.skip)||_.isNull(c.skip)||(m.info("getLinks - skipping "+c.skip),n.skip=c.skip),_.isUndefined(c.limit)||_.isNull(c.skip)||(m.info("getLinks - limiting "+c.limit),n.limit=c.limit)),_.isUndefined(b)||_.isNull(b)||"guestlists"!==b||(n.hosts=!0);var o=function(){Parse.User.current()?(m.info("MemberLinkService: calling getLinks as user is logged in."),j&&(s=!0),m.info(" running getLinks with parameters "+JSON.stringify(n)),Parse.Cloud.run("getLinks",n).then(function(c){j&&(_.isUndefined(c.links)||_.isNull(c.links)||_.isEmpty(c.links)?l.linkedHosts.all=[]:(l.linkCache=c,l.linkedHosts.all=_.compact(_.map(c.links,function(a){return a.isHost===!0?a.id:void 0})),!_.isUndefined(l.linkedHosts.all)&&!_.isNull(l.linkedHosts.all)&&!_.isEmpty(l.linkedHosts.all)&&l.linkedHosts.all.length>0?(i.update("linkedHosts",!0),g&&m.table(l.linkedHosts.all)):(i.update("linkedHosts",!1),m.info("MLS.getLinks - user has no linked hosts"))));var d=c.linkedGuestlists;_.isEmpty(b)||"guestlists"!==b||(_.isUndefined(d)||_.isNull(d)||_.isEmpty(d)?i.update("linkedLists",!1):i.update("linkedLists",!0)),h.getMemberApplications().then(function(e){var g=[],h=[];!_.isUndefined(e)&&!_.isNull(e)&&!_.isEmpty(e)&&e.length>0&&(_.each(e,function(a){g.push(a.id),_.isUndefined(a.attributes.guestlist)||_.isNull(a.attributes.guestlist)?m.error(" building complete application ids array impaired: application has no guestlist "+JSON.stringify(a)):h.push(a.attributes.guestlist.id)}),d=r(d,h)),d=p(d),d=q(d),a.linkCache=l.linkCache,a.linkedGuestlistsCache=l.linkedGuestlistsCache,l.linkedGuestlistsCache=d,_.isUndefined(c.links)||_.isNull(c.links)?i.update("links",!1):_.isEmpty(c.links)?i.update("links",!1):i.update("links",!0);var n=function(){_.isUndefined(b)||_.isNull(b)||"links"===b?(m.info("MLS.getLinks: resolving with links"),k.resolve(c.links)):"guestlists"===b?(m.info("MLS.getLinks: resolving with linkedGuestlistsBuffer"),k.resolve(d)):k.reject("Unsupported requiredResponse for getLinks: "+b),s=!0};j?f.set("links",c).then(function(){n()},function(a){m.error("MLS: CacheService initialisation error: "+a),k.reject(a),s=!1}):n()},function(a){l.linkedGuestlistsCache=d,k.reject(a)})},function(a){m.error("link retrieval unsuccessful: "+a),k.reject(a),s=!1})):(m.info("MemberLinkService: getLinks not being called - user not logged in"),k.resolve())};return s?e?(m.info(" cache populated but forcing request"),o()):(m.info(" already cached user links"),f.hasExpired("links").then(function(a){m.info(" called hasExpired successfully"),"not_expired"===a.hasExpired?(m.info("link cache has not expired"),k.resolve(a.cacheData)):(m.info(" Cache Expired - refreshing"),s=!1,o())},function(){m.info(" Cache Checking Error - failsafe refresh"),s=!1,o()})):(m.info(" cache not populated"),o()),k.promise};var s=!1,t=function(){s=!1,l.linkCache={},a.linkCache=l.linkCache},u=function(){var b=d.defer();return l.clearCache(),s=!1,f.unset("links").then(function(){l.getLinks().then(function(){a.linkCache=l.linkCache,b.resolve()},function(a){b.reject(a)})},function(a){b.reject(a)}),b.promise};this.clearBuffers=n,this.clearCache=t,this.resetCache=u;var v=function(a){var b=d.defer();if(e.currentUser.isLogged)if(m.info("+link "+a.id),_.contains(l.linkBuffer,a.id))m.info("we are already trying to link "+a),b.reject(!1);else{j.start(),l.linkBuffer=o(a.id,l.linkBuffer);var c=new Parse.Object("CRMemberActivity");c.set("activity","link"),c.set("from",Parse.User.current()),c.set("to",a),c.set("toName",a.attributes.firstName),c.set("fromName",e.currentUser.firstName),b.notify({data:!0}),j.set(40),c.save().then(function(){j.complete(),b.notify({data:!0}),n(),u().then(function(){b.resolve({status:"success",data:!0})},function(a){b.reject(a)}),m.info("+link SUCCESS!")},function(a){var c=function(){n(),b.notify({data:!1}),u().then(function(){j.complete(),b.reject(a)},function(a){j.complete(),b.reject(a)})},d=function(){n(),b.notify({data:!0}),u().then(function(){j.complete(),b.resolve({status:"success",data:"true"})},function(a){j.complete(),b.reject(a)})};_.isUndefined(a.status)||_.isNull(a.status)?c():"duplicate"===a.status?(m.info("Duplicate link object created - user still linking"),d()):c()})}else m.error("+link FAIL: user not logged in"),b.reject(!1);return b.promise};this.addLink=v,this.removeLink=function(a){var b=d.defer();if(e.currentUser.isLogged)if(l.isLinking(a))if(m.info("-link "+a),_.contains(l.unlinkBuffer,a.id))m.info("we are already trying to unlink "+a.id),b.reject(!0);else{j.start(),j.set(50),l.unlinkBuffer=o(a.id,l.unlinkBuffer);var c=new Parse.Query("CRMemberActivity");c.equalTo("activity","link"),c.equalTo("from",Parse.User.current()),c.equalTo("to",a),c.ascending("createdAt"),c.first().then(function(a){m.info("found activityObject to destroy"),j.set(75),a.destroy({success:function(){j.set(90),j.complete(),m.info("SUCCESS: removed link"),n(),u().then(function(){j.complete(),b.resolve({status:"success",data:!1})},function(a){b.reject(a)})},error:function(a){m.error("failed to delete activityObject: "+JSON.stringify(a)),j.complete(),n(),u().then(function(){b.reject(!0)},function(a){b.reject(a)})}})},function(){m.error("could not find activityObject to destroy"),n(),u().then(function(){b.reject(!0)},function(a){b.reject(a)})})}else m.error("user not even linking "+a.id),b.reject(!1);else m.error("-link FAIL: user not logged in"),b.reject(!1);return b.promise},this.isLinking=function(a){if(a.id===e.currentUser.id)return m.info("member is current user"),!1;if(e.currentUser.isLogged){var b=_.find(l.linkCache.links,function(b){return b.id===a.id});return _.isUndefined(b)?(m.info(e.currentUser.id+" is not linking "+a.id),!1):(m.info(e.currentUser.id+" is linking "+a.id),!0)}return!1};var w=function(a){var b=d.defer();return _.isUndefined(a)||_.isNull(a)?b.reject("linkBack target is undefined"):Parse.User.current()?l.isLinking(a)?b.resolve("already linking"):v(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}):b.reject("not logged in"),b.promise};this.linkBack=w}]),angular.module("cloakroomApp").service("SignupService",["$log","$q","cr","ErrorInterface","MemberLinkService","CacheService","cfpLoadingBar","EMAIL_REGEX",function(a,b,c,d,e,f,g){var h=this;this.invitation={},this.newMember={status:"none"};this.setStatus=function(c,d){var e=b.defer(),g=["none","alias","ready","created","complete"],i={};return _.isUndefined(c)||!_.contains(g,c)?(a.error("SignupService: setStatus was provided an invalid status"),e.reject({status:"error",error:"setStatus was provided an invalid status"})):(a.info("Setting Signup status to "+c),i.status=c,h.newMember.status=c,"none"!==c&&"complete"!==c&&(_.isUndefined(d.firstName)||_.isNull(d.firstName)?(e.reject("SignupService.setStatus: incomplete object"),a.error("signupObject is missing firstName!")):i.firstName=d.firstName,_.isUndefined(d.lastName)||_.isNull(d.lastName)?(e.reject("SignupService.setStatus: incomplete object"),a.error("signupObject is missing lastName!")):i.lastName=d.lastName,_.isUndefined(d.mobileNumber)||_.isNull(d.mobileNumber)?(e.reject("SignupService.setStatus: incomplete object"),a.error("signupObject is missing mobileNumber!")):i.mobileNumber=d.mobileNumber,_.isUndefined(d.invitedBy)||_.isNull(d.invitedBy)?(e.reject("SignupService.setStatus: incomplete object"),a.error("signupObject is missing invitedBy!")):i.invitedBy=d.invitedBy,_.isUndefined(d.password)||_.isNull(d.password)?(e.reject("SignupService.setStatus: incomplete object"),a.error("signupObject is missing password!")):i.password=d.password,_.isUndefined(d.isFemale)||_.isNull(d.isFemale)?(e.reject("SignupService.setStatus: incomplete object"),a.error("signupObject is missing isFemale!")):i.isFemale=d.isFemale,_.isUndefined(d.email)||_.isNull(d.email)?(e.reject("SignupService.setStatus: incomplete object"),a.error("signupObject is missing email!")):i.email=d.email,_.isUndefined(d.verifiedMobileNumber)||_.isNull(d.verifiedMobileNumber)?a.error("signupObject is missing verifiedMobileNumber!"):i.verifiedMobileNumber=d.verifiedMobileNumber,_.isUndefined(d.associatedInvitation)||_.isNull(d.associatedInvitation)||(i.associatedInvitation=d.associatedInvitation,console.debug("SignupService: associated invitation set to %j",d.associatedInvitation)),_.isUndefined(d.alias)||_.isNull(d.alias)||(i.alias=d.alias,a.debug("SignupService: alias set to "+d.alias))),"complete"!==c?f.set("signup",i).then(function(a){h.newMember=i,e.resolve({status:"success",data:a})},function(a){e.reject({status:"error",error:a})}):f.unset("signup").then(function(a){e.resolve({status:"success",data:a})},function(a){e.reject({status:"error",error:a})})),e.promise},this.getInProgress=function(){var a=b.defer(),d=f.isPopulated("signup");return d?f.hasExpired("signup").then(function(b){c.exists(b)&&c.exists(b.getStatus)&&"success"===b.getStatus&&c.exists(b.hasExpired)&&"not_expired"===b.hasExpired?(a.resolve({status:b.cacheData.status,data:b.cacheData}),h.newMember=b.cacheData):a.resolve({status:"unset",error:"SignupService.getInProgress - unset"})},function(b){a.reject({status:"error",error:b.error})}):a.resolve({status:"unset",error:"SignupService.getInProgress - unset"}),a.promise},this.buildMember=function(b){h.newMember=b,a.debug("SignupService: new member is "+b)},this.checkAlias=function(c){var d=b.defer();a.debug("checking alias availability for "+c);var e=new Parse.Query(Parse.User);return e.equalTo("username",c.toLowerCase()),e.count({success:function(b){a.debug("count success: "+b),d.resolve(b)},error:function(b){a.debug("count error: "+b),d.reject(b)}}),d.promise},this.getInvitation=function(c){var d=b.defer(),e=new Parse.Query("CRInvitation");return e.include(["sender"]),e.get(c,{success:function(b){b.attributes.accepted?b.attributes.accepted&&(d.resolve({status:"taken",data:b}),a.error("SignupService: Invitation has already been accepted!")):(d.resolve({status:"available",data:b}),h.invitation=b,a.debug("SignupService: Succesfully retrieved unclaimed invitation!"))},error:function(b,c){d.resolve({status:"error",error:c}),a.error(c)}}),d.promise},this.updateInvitation=function(c){var d=b.defer();d.resolve();var e=new Parse.Query("CRInvitation");return e.get(c,{success:function(){a.debug("SignupService: Succesfully retrieved invitation!")},error:function(b){a.error(b)}}),d.promise},this.createMember=function(d,e){var f,i,j,k=b.defer(),l=!1;j=!0;var m=function(a){return a.attributes.invites<1?!1:a.attributes.canRefer?!0:!1},n=function(){if(c.exists(d.associatedInvitation))d.associatedInvitation.id?(f=d.associatedInvitation,d.associatedInvitation.objectId&&(f.id=d.associatedInvitation.objectId),c.exists(d.associatedInvitation.accepted)?j=d.associatedInvitation.accepted:c.exists(d.associatedInvitation.attributes)&&c.exists(d.associatedInvitation.attributes.accepted)&&(j=d.associatedInvitation.attributes.accepted),a.debug("Associated invitation "+f.objectId+" passed.. building query"),l=!0):d.associatedInvitation.objectId&&!d.associatedInvitation.attributes?(f={__type:"Pointer",className:"CRInvitation",objectId:d.associatedInvitation.objectId},j=d.associatedInvitation.accepted,a.debug("Associated invitation "+f.objectId+" passed.. building query"),l=!0):k.reject("SignupService - invalid associated invitation"),j?k.reject("associated invitation already claimed!"):o();else if(e&&!d.associatedInvitation)k.reject("SignupService: Failed to sign up: no associated invitation passed to method!");else if(!d.associatedInvitation&&e&&(!d.invitedBy||d.invitedBy.length<3))k.reject("SignupService: Invitation Needed and not passed");else if(!e&&d.invitedBy&&d.invitedBy.length>3){var b=new Parse.Query(Parse.User);b.equalTo("username",d.invitedBy.toLowerCase()),b.first({success:function(b){g.complete(),a.debug("found supposed referrer"),i=b,m(i)?(a.debug("sender qualified to invite this user"),o()):(a.error("sender unqualified to invite this user"),k.reject("sender unqualified to invite this user"))},error:function(b){g.complete(),a.error("SignupService: referrer checking failed: "+b.code+": "+b.message),k.reject(b)}})}else k.reject("SignupService.createMember: Unable to conclude init() - is invitation not required?"),a.error("SignupService.createMember: Unable to conclude init() - is invitation not required?")},o=function(){var b=!0,e=new Parse.User;d.alias&&d.alias.length>3&&d.alias.length<17?(e.set("username",d.alias.toLowerCase()),e.set("alias",d.alias),a.debug("setting username to "+d.alias.toLowerCase())):(b=!1,k.reject("invalid alias")),d.password&&d.password.length>=4?(e.set("password",d.password),a.debug("setting password to "+d.password)):(b=!1,k.reject("invalid password")),d.firstName&&d.firstName.length>=3?(e.set("firstName",d.firstName),a.debug("setting firstName to "+d.firstName)):(b=!1,k.reject("invalid firstName")),_.isUndefined(d.verifiedMobileNumber)||_.isNull(d.verifiedMobileNumber)||(_.isUndefined(d.mobileNumber)||_.isNull(d.mobileNumber)?a.error("SignupService: newMember has verifiedMobileNumber defined but mobileNumber is not defined"):(a.debug("setting verifiedMobileNumber to "+d.verifiedMobileNumber),(d.verifiedMobileNumber===!0||d.verifiedMobileNumber===!0)&&e.set("verifiedMobileNumber",d.verifiedMobileNumber))),d.lastName&&d.lastName.length>=3?(e.set("lastName",d.lastName),a.debug("setting lastName to "+d.lastName)):(b=!1,k.reject("invalid lastName")),d.mobileNumber&&d.mobileNumber.length>10?(e.set("mobileNumber",d.mobileNumber),a.debug("setting mobileNumber to "+d.mobileNumber)):(b=!1,k.reject("invalid mobileNumber")),d.invitedBy?(e.set("invitedBy",d.invitedBy),a.debug("setting invitedBy to "+d.invitedBy)):(b=!1,k.reject("invalid invitedBy")),_.isUndefined(d.isFemale)?(b=!1,k.reject("missing isFemale")):(e.set("isFemale",d.isFemale),a.debug("setting isFemale to "+d.isFemale)),_.isUndefined(d.email)?(b=!1,k.reject("missing email")):(e.set("email",d.email),a.debug("setting email to "+d.email)),_.isUndefined(d.associatedInvitation)?a.debug("no associated invitation"):c.exists(f)&&(c.exists(f.id)||c.exists(f.objectId))?(e.set("associatedInvitation",f),a.debug("setting associatedInvitation to "+(f.id||f.objectId))):(console.error('newMember has associated invitation but variable "invitation"'),console.error(f)),b&&(h.newMember=d,g.start(),e.signUp(null,{success:function(b){g.set(50),h.setStatus("created",h.newMember).then(function(){g.complete(),a.debug("Sign up success! Welcome new member!"),k.resolve(b)},function(a){g.complete(),k.reject(a)})},error:function(b,c){g.complete(),a.error("Error: "+c.code+" "+c.message),k.reject(c)}}))};return n(),k.promise},this.processSignup=function(c){g.start();var d=b.defer();return Parse.Cloud.run("claimInvitation",{invitation:c}).then(function(b){g.set(.5),e.getLinks().then(function(){g.complete(),a.debug("successfully retrieved new member's links"),d.resolve(b)},function(){g.complete(),a.error("failed to retrieve new member's links"),d.resolve(b)})},function(a){g.complete(),d.reject(a)}),d.promise},this.checkInvitation=function(a,c){g.start();var d=b.defer();return Parse.Cloud.run("checkInvitation",{invitedBy:a,mobileNumber:c}).then(function(a){g.complete(),d.resolve(a)
},function(a){g.complete(),d.reject(a)}),d.promise}}]),angular.module("cloakroomApp").service("StatusService",["crLog","$rootScope",function(a,b){var c=this,d=a.create("StatusService",!1,"blue"),e={has:{applications:!1,suggestions:!1,links:!1,linkedHosts:!1,linkedLists:!1,photo:!1,notifications:!1},needsUpdating:!0};this.user=_.cloneDeep(e),b.memberStatus=this.user,this.update=function(a,b){return _.isUndefined(a)||_.isNull(a)?(d.error("update was not passed a key to set"),1):_.isUndefined(b)||_.isNull(b)?(d.error("update "+a+" was not passed a value"),2):_.has(c.user.has,a)?_.isBoolean(b)?(c.user.has[a]=b,d.debug(" "+a+" is now "+b),0):(d.error("update failed - value was not a boolean"),4):(d.error("update "+a+" invalid - not already defined in StatusService"),3)},this.get=function(a){return this.user.has[a]},this.reset=function(){c.user=null,c.user=_.cloneDeep(e)}}]),angular.module("cloakroomApp").service("serviceHelpers",["$log","CLOAKROOM_IN_DEVELOPMENT",function(a,b){this.list={controllers:[],services:[]},this.developerLog=function(a,c,d){b&&d!==!0&&log("_"+a+"_: "+c)};var c=function(a){return _.isEmpty(a)?void 0:a.replace(/[\-\s\(\)]+/g,"")},d=function(a,b,c){var d="cr-i-"+b;_.isUndefined(c)||_.isNull(c)||(d=d+" "+c);var e='<i class="'+d+'"></i>';return e+a};this.prependIcon=d;var e=function(a){return a=c(a),"+"!==a.substr(0,1)&&"0"===a.substr(0,1)&&(a="0044"===a.substr(0,4)?"+44"+a.substring(4):"+44"+a.substring(1)),a};this.convertMobile=e,this.prepareValue=c,this.prepare=c,this.convertMobile=e,this.getTimeReference=function(a){var b;return b=_.isUndefined(a)||_.isNull(a)?moment():moment(a),b.hour()<6?b.subtract(1,"day").hour(6):b.hour(6).minute(0),b.toJSON()},this.startsWith=function(a,b){return _.isUndefined(a)||_.isNull(a)?1:_.isUndefined(b)||_.isNull(b)?2:b.substring(0,a.length)===a}}]),angular.module("cloakroomApp").service("ModalInterface",["$q","$log","$modal",function(a,b,c){var d=this;d.defaultLink={href:"/",text:"go back to page",show:!1,preMessage:"Was this an accident?"},d.yesNo=function(d){var e=a.defer();if(_.isUndefined(d)||_.isNull(d))e.reject("Options is undefined");else{var f={templateUrl:"/views/partials/modals/yesno.html",controller:"ModalYesnoCtrl",resolve:{modalOptions:function(){return d}},backdrop:!0,keyboard:!0,windowClass:"cr-modal",size:d.size?d.size:"lg"},g=c.open(f);g.result.then(function(a){b.debug("Modal closed: "+a),e.resolve(a)},function(a){b.debug("Modal dismissed: "+a),e.reject(a)})}return e.promise},d.showForm=function(d){var e=a.defer();if(_.isUndefined(d)&&_.isNull(d))e.reject("Options Undefined");else{var f=c.open({templateUrl:"/views/partials/modals/form.html",controller:"ModalFormCtrl",resolve:{modalOptions:function(){return d}},backdrop:!0,keyboard:!0,windowClass:"cr-modal",size:d.size?d.size:"lg"});f.result.then(function(a){b.debug("Modal closed: "+a),e.resolve(a)},function(a){b.debug("Modal dismissed: "+a),e.reject(a)})}return e.promise}}]),angular.module("cloakroomApp").service("memberNotification",["crLog","UserService","CLOAKROOM_IN_DEVELOPMENT","$q","serviceHelpers","CacheService","StatusService",function(a,b,c,d,e,f,g){var h=this;h.ntfcns={show:!1,count:0,unseenCount:0,all:[]},h.notificationUpdates={};var i=a.create("memberNotification",!1,"black"),j=function(a){return c?i.table(a):void 0};h.notificationUpdates={seen:[],refresh:[],dismissed:[],unseen:[]};var k=function(a){a.important===!0&&a.data.attributes.dismissed===!1?(h.ntfcns.count++,h.ntfcns.unseenCount++):((a.data.attributes.dismissed===!1||a.data.attributes.seen===!1)&&h.ntfcns.count++,a.data.attributes.seen||h.ntfcns.unseenCount++)},l=function(a){h.ntfcns.count=0,h.ntfcns.unseenCount=0,_.isEmpty(a)?_.forEach(h.ntfcns.all,function(a){a.important="ACTION_REQUIRED"===a.type?!0:!1,k(a)}):(i.info("calculating count based off input data"),_.forEach(a,function(a){a.important="ACTION_REQUIRED"===a.type?!0:!1,k(a)})),h.ntfcns.count>0&&(h.ntfcns.show=!0)},m=function(){i.info("Resetting notification updates"),h.notificationUpdates={seen:[],refresh:[],dismissed:[],unseen:[]},i.info("Recalculating count, should be 0"),l()};m(),h.GET_NEW_DATA=!0;var n=function(){i.info("Removing duplicates from memberNotification.notificationUpdates"),_.forOwn(h.notificationUpdates,function(a,b){h.notificationUpdates[b]=_.uniq(a)}),i.info("after duplicates removed:"),j(h.notificationUpdates)};h.getNotifications=function(a){var b=d.defer(),c=function(){i.info("Fetching member notifications data");var b=d.defer();return Parse.Cloud.run("getNotifications",a).then(function(a){_.isUndefined(a)||_.isNull(a)?(i.error(a),b.reject("Success seems undefined")):"NO_NOTIFICATIONS"===a.status?(g.update("notifications",!1),i.info("getNotifications successful but user has no notifications!"),b.resolve({})):"NOTIFICATIONS_FOUND"===a.status&&(g.update("notifications",!0),i.info("Recieved notification data"),b.resolve(a.data))},function(a){i.error(a),b.reject(a)}),b.promise},e=function(a){i.info("building notifications object");var b=[],c=function(a){return i.info("processing notifications data"),l(a),a};return b=c(a),i.info("User has "+h.ntfcns.count+" notifications"),b},f=function(){c().then(function(a){var c=e(a);h.GET_NEW_DATA=!1,h.ntfcns.all=c,_.isEmpty(h.ntfcns.all)?g.update("notifications",!1):g.update("notifications",!0),b.resolve(c)},function(a){h.GET_NEW_DATA=!0,b.reject(a)})};return h.updateAll().then(function(){h.GET_NEW_DATA?(i.info("member notifications data request necessary"),f()):(i.info("GET_NEW_DATA is false"),b.resolve(h.ntfcns.all))},function(a){b.reject(a)}),b.promise},h.setSeen=function(a,b){if(_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.data.id)||_.isNull(a.data.id))return i.error("memberNotifications.setSeen: Did not pass a valid notification (including id) to setSeen"),!1;var c=_.some(h.ntfcns.all,function(b){return b.data.id===a.data.id});if(h.ntfcns.all.length>0&&c){var d;d=_.isUndefined(b)||_.isNull(b)?!0:b,i.info("memberNotifications: setting notification "+a.data.id+" as "+(d?"seen":"unseen"));var e=a.data.id,f=o(e);return h.ntfcns.all[f].data.attributes.seen!==d?(h.ntfcns.all[f].data.attributes.seen=d,_.isEmpty(b)||b===!0?h.notificationUpdates.seen.push(e):h.notificationUpdates.unseen.push(e),n(),l(),h.GET_NEW_DATA=!0):i.info("notification "+a.data.id+" is already seen so not doing anything with it"),!0}return i.error("memberNotifications.setSeen: invalid notification to setSeen or array is empty"),!1};var o=function(a){return _.findIndex(h.ntfcns.all,function(b){return b.data.id===a})};h.dismiss=function(a,b){if(_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.data.id)||_.isNull(a.data.id))return i.error("memberNotifications.dismiss: Did not pass a valid notification (including id) to dismiss"),!1;var c=_.some(h.ntfcns.all,function(b){return b.data.id===a.data.id});if(h.ntfcns.all.length>0&&c){i.info("memberNotifications: dismissing notification "+a.data.id);var d=a.data.id,e=o(d);return _.isUndefined(a.important)||_.isNull(a.important)||!a.important||b?(b&&i.info("forcing notification dismissal"),h.ntfcns.all[e].data.attributes.dismissed=!0,h.ntfcns.all[e].data.attributes.seen=!0,h.notificationUpdates.dismissed.push(d)):i.info("Notification is important, not dismissing"),n(),l(),h.GET_NEW_DATA=!0,!0}return i.error("memberNotifications.dismiss: invalid notification to dismiss or array is empty"),!1},h.dismissSetPhoto=function(){var a=_.findIndex(h.ntfcns.all,function(a){return"ACTION_REQUIRED"===a.type&&"requiredAction"===a.data.attributes.activity&&"SET_PHOTO"===a.data.attributes.actionRequired});return a&&-1!==a?h.dismiss(h.ntfcns.all[a],!0):void 0},h.refresh=function(a){var b=a.data.id,c=o(b);h.ntfcns.all[c].data.attributes.seen=!0,h.ntfcns.all[c].data.attributes.dismissed=!0,h.notificationUpdates.refresh.push(b),h.GET_NEW_DATA=!0,n(),l()},h.remove=function(a){return i.error("memberNotification.remove is DEPRECATED, please use memberNotification.dismiss"),h.dismiss(a)},h.hide=function(){return i.info("Notifications: Hiding Notifications"),_.isEmpty(h.ntfcns.all)?!1:(_.forEach(h.ntfcns.all,function(a){h.setSeen(a,!0)}),!0)},h.updateAll=function(){var a=d.defer();return _.isEmpty(h.notificationUpdates.dismissed)&&_.isEmpty(h.notificationUpdates.seen)&&_.isEmpty(h.notificationUpdates.unseen)&&_.isEmpty(h.notificationUpdates.refresh)?(i.info("Notifications: no notifications to update"),a.resolve()):(i.info("Notifications: notifications need updating"),h.update(h.notificationUpdates).then(function(b){a.resolve(b),m()},function(b){a.reject(b)})),a.promise},h.update=function(a){var b=d.defer();return _.isEmpty(a)?b.reject("updateAll: passed an empty idsObject"):(c&&i.table(a),Parse.Cloud.run("updateNotifications",a).then(function(a){b.resolve(a),m()},function(a){b.reject(a)})),b.promise},h.clear=function(){h.ntfcns={show:!1,count:0,all:[]},m(),g.update("notifications",!1),c&&i.info("Cleared notifications cache"),h.GET_NEW_DATA=!0}}]),angular.module("cloakroomApp").service("SuggestionsService",["$log","$q","StatusService","MemberLinkService","cfpLoadingBar","UserService","$rootScope",function(a,b,c,d,e,f,g){var h=this;h.suggestions={guestlists:[],venues:[]},g.randomEventSuggestions=h.suggestions;var i=function(a){var g=b.defer();if(_.isUndefined(f.currentUser)||_.isNull(f.currentUser)||!f.currentUser.isLogged)g.reject("You need to be logged in to do get event suggestions.");else{var i,j=c.get("linkedHosts");i=_.isUndefined(a)||_.isNull(a)?{}:a,j&&(a.alreadyLinkedHosts=d.linkedHosts.all),e.start(),Parse.Cloud.run("getEventSuggestion",i).then(function(a){if(e.complete(),"success"===a.status){h.suggestions.guestlists=_.union(h.suggestions.guestlists,_.map(a.guestlists,function(b,c){var d=b;return d.venue=a.venues[c],d}));var b=[];h.suggestions.guestlists=_.compact(_.map(h.suggestions.guestlists,function(a){return!_.isEmpty(b)&&_.contains(b,a.id)?void 0:(b.push(a.id),a)})),h.suggestions.venues=_.union(h.suggestions.venues,a.venues),h.suggestions.guestlists.length>0?c.update("suggestions",!0):c.update("suggestions",!1)}g.resolve(a)},function(a){e.complete(),g.reject(a)})}return g.promise};h.getSuggestions=i;var j=function(){h.suggestions={guestlists:[],venues:[]},c.update("suggestions",!1)};h.clear=j}]),angular.module("cloakroomApp").directive("searchbar",function(){return{template:"<div></div>",restrict:"E",link:function(a,b){b.text("this is the searchbar directive")}}}),angular.module("cloakroomApp").service("searchMembers",["$timeout","$log","$q","CLOAKROOM_IN_DEVELOPMENT","serviceHelpers","MemberLinkService","StatusService","UserService",function(a,b,c,d,e,f){var g=this,h=!1,i=function(a){return d?h?console.log(a):b.debug(a):!1};this.results={data:[]};var j=function(a){if(_.isUndefined(a)||_.isNull(a)||!_.isArray(a))throw _.isUndefined(a)||_.isNull(a)?"input undefined or null":"input not an array";g.results.data=a},k=function(){g.results={data:[]}},l=function(a,c,d){var f,g,h;_.isUndefined(a)||_.isNull(a)||(f=_.isUndefined(a.key)||_.isNull(a.key)?void 0:a.key.toLowerCase(),g=_.isUndefined(a.reverse)||_.isNull(a.reverse)?void 0:a.reverse,h=_.isUndefined(a.alias)||_.isNull(a.alias)?void 0:a.alias);var j,k,l=function(a){var b={alias:{ids:[],data:[]},fn:{ids:[],data:[]},ln:{ids:[],data:[]}};_.each(a,function(a){var c,d,g,i=e.startsWith;c=a.username,d=a.firstName.toLowerCase(),g=a.lastName.toLowerCase(),i(f,c)?b.alias.data.push(a):!h&&i(f,d)?b.fn.data.push(a):!h&&i(f,g)&&b.ln.data.push(a)});var c=[];return b.alias.data.length>0&&(b.alias.data=_.sortBy(b.alias.data,function(a){return a.username}),c=_.union(c,b.alias.data)),b.fn.data.length>0&&(b.fn.data=_.sortBy(b.fn.data,function(a){return a.firstName}),c=_.union(c,b.fn.data)),b.ln.data.length>0&&(b.ln.data=_.sortBy(b.ln.data,function(a){return a.lastName}),c=_.union(c,b.ln.data)),c},m=function(a){return _.sortBy(a,function(a){return a.username})};k=[];var n=[];if(_.isUndefined(f)||_.isNull(f))throw"no key to sort";if(!_.isUndefined(c)&&!_.isNull(c)&&c.links.length>0&&(j=c.links,k=l(j)),!_.isUndefined(d)&&!_.isNull(d)){var o=m(d);k.length>0&&(n=_.map(k,function(a){return a.id}),b.debug("Search Results sorting: links already in array: "+n)),k=_.compact(_.union(k,_.map(o,function(a){return _.contains(n,a.id)?void i("Search Results sorting: not adding search result "+a.id):(i("Search results sorting: adding result "+a.id),a)})))}return k},m=function(a){var b=c.defer(),d=function(){return{credential:_.isUndefined(a)?"no input":e.prepare(a),host:!1,multiple:!0,partial:!0}};if(_.isUndefined(a)||_.isNull(a))b.reject("undefined or null input");else if(_.isString(a))if(Parse.User.current()){var f=d();Parse.Cloud.run("getMember",f).then(function(a){b.resolve({status:"success",data:a.results})},function(a){b.reject({status:"error",data:a})})}else b.reject("not logged in");else b.reject("input not a string");return b.promise},n=function(a){var b=f.getLinkCache(),d=_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.promise)||_.isNull(a.promise)?!1:a.promise,e=function(a){return d?c.when(a):a};return e(_.isUndefined(b)||_.isNull(b)||_.isUndefined(b.links)||_.isNull(b.links)||_.isEmpty(b.links)?!1:b.links)},o=function(a){var d=c.defer(),f=function(a,b){d.notify({status:a,results:b})};if(_.isUndefined(a)||_.isNull(a))d.reject("input undefined");else if(_.isString(a)){var h;a=e.prepare(a);var j={key:a};"~"===a.substr(0,1)&&(a=a.substr(1),h=!0,j.aliasOnly=!0);var k=[];g.checkLinkCache({promise:!0}).then(function(c){if(c){var e=_.map(c,function(a){return a.resultType="link",a});k=g.sort(j,{links:e}),f(1,k)}else f(1,[]);g.query(a).then(function(a){if(!_.isUndefined(a)&&!_.isNull(a)&&!_.isUndefined(a.data)&&!_.isNull(a.data)&&a.data.length>0){var b=_.map(a.data,function(a){var b=a.attributes;return b.resultType="remote",b.id=a.id,b});k=g.sort(j,{links:k},b)}f(2,k),d.resolve({status:"success",results:k})},function(a){_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.error)||_.isNull(a.error)?(b.error(a),d.reject(a)):(b.error(a.error),d.reject(a.error))})},function(a){i("search checkLinkCache error: "+JSON.stringify(a)),d.reject(a)})}else d.reject("not a string");return d.promise};this.set=j,this.sort=l,this.query=m,this.reset=k,this.find=o,this.checkLinkCache=n}]),angular.module("cloakroomApp").service("recentActivitiesService",["$q","$log","cr","crLog","serviceHelpers","CacheService",function(a,b,c,d,e,f){{var g=this;d.create("recentActivitiesService",!0,"black")}this.data={all:[]};var h=function(b){var d=Parse.User.current(),e=a.defer();if(d){var h=function(){f.retrieve("getRecentActivities",b).then(function(a){if(c.exists(a)&&c.exists(a.cacheData)){var b=a.cacheData.data;c.exists(b)&&_.isArray(b)&&b.length>0?(b=_.sortBy(b,"updatedAt").reverse(),g.set(b),e.resolve()):e.reject(_.isPlainObject(a)?"No data! (retrieveResult: "+JSON.stringify(a)+" )":"No data! (retrieveResult: "+a+" )")}else e.reject("No data!")},function(a){var b;g.reset(),b=_.isUndefined(a)||_.isNull(a)||_.isUndefined(a.data)||_.isNull(a.data)?a:a.data,e.reject(b)})};h()}else e.reject("Not logged in!");return e.promise},i=function(a){if(_.isUndefined(a)||_.isNull(a)||!_.isArray(a))throw"invalid input - check if defined and array";g.data.all=a},j=function(){g.set([])};this.get=h,this.set=i,this.reset=j}]),angular.module("cloakroomApp").directive("activityItem",["recentActivitiesService","serviceHelpers","$log","$compile",function(a,b,c,d){return{template:'<li class="activity-item"><span bindonce="activityItemPhoto"><img class="cloakroom-member-photo thirtysix round float left notopmargin" bo-if="activityItemPhoto" bo-src="$root.generatePhotoUrl({photoFileInfo: activityItemPhoto, size: \'xs\'})"></span><span bindonce="information" class="information" bo-html="information"></span></li>',restrict:"E",scope:{data:"=data"},link:function(a,e){var f=a.data,g=f.attributes.activity,h=f.attributes.from,i=f.attributes.fromName,j=f.attributes.fromAlias,k=f.attributes.fromPhoto,l=f.attributes.toPhoto,m=f.attributes.toAlias,n=_.isUndefined(f.attributes.fromAlias)||_.isNull(f.attributes.fromAlias)?void 0:f.attributes.fromAlias.toLowerCase(),o=_.isUndefined(f.attributes.toAlias)||_.isNull(f.attributes.toAlias)?void 0:f.attributes.toAlias.toLowerCase(),p=f.attributes.to,q=f.attributes.toName,r=f.attributes.guestlistName,s=(f.attributes.guestlist,Parse.User.current().id,moment(f.updatedAt).toJSON()),t=b.prependIcon;if(_.isUndefined(g)||_.isNull(g))return void c.error("Activity item directive rendering not possible because ACTIVITY_TYPE was undefined or null");switch(g){case"link":p.id===Parse.User.current().id?(a.information="You were linked by ",a.information=_.isUndefined(q)||_.isNull(q)?"someone ":a.information+'<str class="name">'+i+"</str> ",_.isUndefined(n)||_.isNull(n)||(a.information=a.information+" <span class='alias'>~"+j+"</span>",a.engage={href:_.isUndefined(j)||_.isNull(j)?void 0:"/member/?byId="+n,contents:"view"}),_.isUndefined(k)||_.isNull(k)||(a.activityItemPhoto=k),_.isUndefined(h)||_.isNull(h)||(a.engage={href:_.isUndefined(h.id)||_.isNull(h.id)?void 0:"/member/?byId="+h.id,contents:"view"})):(a.information="You linked ",a.information=_.isUndefined(q)||_.isNull(q)?a.information+" someone ":a.information+'<str class="name">'+q+"</str> ",_.isUndefined(l)||_.isNull(l)||(a.activityItemPhoto=l),_.isUndefined(o)||_.isNull(o)||(a.information=a.information+" <span class='alias'>~"+m+"</span> "),_.isUndefined(p)||_.isNull(p)||(a.engage={href:_.isUndefined(p.id)||_.isNull(p.id)?void 0:"/member/?byId="+p.id,contents:"view"}));break;case"acceptance":var u="<str>"+i+"</str> confirmed your attendance on <str>"+r+"</str> ";a.information=t(u,"tick","green"),a.engage={href:"/event/"+f.attributes.guestlist.id+"/",contents:"view"};break;case"rejection":var v="Your application to <str>"+r+"</str> was <str>unsuccessful. </str> ";a.information=t(v,"cross","red"),a.engage={href:"/event/"+f.attributes.guestlist.id+"/",contents:"view"};break;case"checkIn":a.information="You were checked into <str>"+r+"</str>. Have a great night! ";break;case"cancellation":a.information=i+" cancelled "+r;break;default:a.information="Something unknown happened."}if(!_.isUndefined(s)&&!_.isNull(s)){a.timestamp=s;var w='<span class="extra">';w=w+'<span class="timestamp" precise-time-difference="'+s+'"></span> ',_.isUndefined(a.engage)||_.isNull(a.engage)||(w+='<a bindonce="engage" bo-href="engage.href" class="action" bo-html="engage.contents"></a>'),w+="</span>";var x=angular.element(w);d(x)(a),e.find("li").append(x)}}}}]),angular.module("cloakroomApp").service("MemberPhotoService",["CLOAKROOM_IN_DEVELOPMENT","CLOAKROOM_PHOTO_CDN_URL","UserService","GoTo","$q","$log","$rootScope",function(a,b,c,d,e,f,g){var h={USE_PROGRESSIVE:!0,DEV_INVERT_ALL:!1},i=function(a){_.isUndefined(a)||_.isNull(a)||_.isUndefined(c.currentUser)||_.isNull(c.currentUser)?f.debug("self.member or currentuser undefined"):c.currentUser.isLogged?c.currentUser.id===a.id?d.profilePhotoPicker():f.debug("not current user"):f.debug("not logged in")};this.changeOwnPhoto=i;var j=function(c){if(_.isUndefined(c)||_.isNull(c))throw"input undefined";if(!_.isPlainObject(c))throw"input not an object";if((_.isUndefined(c.photoFileInfo)||_.isNull(c.photoFileInfo))&&(_.isUndefined(c.photoUrl)||_.isNull(c.photoUrl)))throw"missing photoUrl and photoFileInfo";var d,e;d=_.isUndefined(c.photoUrl)||_.isNull(c.photoUrl)?void 0:c.photoUrl,e=_.isUndefined(c.photoFileInfo)||_.isNull(c.photoFileInfo)?void 0:c.photoFileInfo;var f,g,i,j,k,l;if(_.isUndefined(c.size)||_.isNull(c.size)||(g=c.size),_.isUndefined(g)||_.isNull(g))f=!1,i=640,j=640;else switch(f=!0,g){case"xxs":i=24,j=24;break;case"xs":i=48,j=48;break;case"small":i=64,j=64;break;case"medium":i=128,j=128;break;case"large":i=256,j=256;break;case"xl":i=512,j=512;break;case"xxl":i=1024,j=1024;break;case"max":i=2048,j=2048;break;case"custom":_.isUndefined(c.width)||_.isNull(c.width)||_.isUndefined(c.height)||_.isNull(c.height)?(i=640,j=640):(i=c.height,j=c.width);break;default:i=640,j=640}var m;if(_.isUndefined(e)||_.isNull(e)||_.isUndefined(e.crop)||_.isNull(e.crop)?m=0:(l=e.crop,m=_.isUndefined(l.top)||_.isNull(l.top)||_.isUndefined(l.left)||_.isNull(l.left)?1:2),_.isUndefined(e)||_.isNull(e)){if(!_.isUndefined(d)&&!_.isNull(d)&&d.length>0)return d;throw"photoUrl and photoFileInfo both undefined"}var n=b,o=_.isUndefined(e.uuid)||_.isNull(e.uuid)?void 0:e.uuid;if(_.isUndefined(o)||_.isNull(o))throw"photo id undefined";return n=n+o+"/",a&&h.DEV_INVERT_ALL&&(n+="-/invert/"),!_.isUndefined(m)&&!_.isNull(m)&&m>0&&(n=n+"-/crop/"+l.width+"x"+l.height+"/",m>1&&(n=n+l.left+","+l.top+"/")),k=_.isUndefined(c.quality)||_.isNull(c.quality)||!_.isString(c.quality)?"normal":c.quality,n=n+"-/quality/"+k+"/",n+="-/preview/",f&&(n=n+j+"x"+i,n+="/"),h.USE_PROGRESSIVE&&(n+="-/progressive/yes/"),_.isUndefined(n)||_.isNull(n)?void 0:n};g.generatePhotoUrl=j,this.generateUrl=j}]),angular.module("cloakroomApp").controller("ErrorViewCtrl",["$scope","$stateParams","$log","TitleService","GoTo",function(a,b,c,d,e){a.GoTo=e;var f=this;f.error={identified:!1,link:{url:"",text:""},dontSendHome:!1,symbol:"alert",title:"Error",text:"Something went wrong. We'll work hard to make sure it doesn't happen again."}}]),angular.module("cloakroomApp").service("CloudCode",["$q","crLog","cr","CLOAKROOM_IN_DEVELOPMENT",function(a,b,c,d){var e=b.create("CloudCode",d,"brown"),f=function(b,d){c.exists(d)?e.json(d,"Executing Cloud Code function "+b):e.info("Executing Cloud Code function "+b+" with no parameters");var f=a.defer();return Parse.Cloud.run(b,d).then(function(a){e.info("cc"+b+" successful"),f.resolve(a)},function(a){e.error("cc"+b+" unsuccessful"),e.error(a),f.reject(a)}),f.promise};this.run=f}]),angular.module("cloakroomApp").run(["$templateCache",function(a){a.put("views/about.html",'<div ng-cloak></div><div class="container infopage" ng-show=!isViewLoading><div class="row centering"><div class=col-xs-12><we-change-at-night class="small centered"></we-change-at-night></div></div></div>'),a.put("views/contact.html",'<div class="container infopage formpage"><h1>Change Password</h1><div class=row id=before-form><div class=col-xs-12><div class="col-xs-1 col-sm-2"></div><div class="col-xs-10 col-sm-8"><p class="text-center instructions">To change any of your personal details, please fill in the appropriate field below and tap/click <strong>save</strong>. To cancel, just leave this page.</p></div><div class="col-xs-1 col-sm-2"></div></div></div><div class=row id=has-form><div class=center-block><div class=col-xs-12><form name=editProfileForm class=form-horizontal role=form><div class=form-group><label for=firstname class="control-label col-xs-2">First Name</label><div class=col-xs-10><input name=firstname class=form-control ng-model=edit.vm.fields.firstName.value placeholder={{currentUser.firstName}} ng-minlength=3 ng-maxlength=11 name-input ng-pattern="/^[A-Za-z ]+$/" required ng-change="edit.hideErrors(\'firstname\')"><form-error ng-if="editProfileForm.firstname.$error.minlength &&  edit.controls.error.firstname">Too Short!</form-error><form-error ng-if="editProfileForm.firstname.$error.maxlength &&  !editProfileForm.firstname.$pristine">Too long!</form-error><form-error ng-if="editProfileForm.firstname.$error.pattern &&  !editProfileForm.firstname.$pristine">Alphabetical characters only, please.</form-error></div></div><div class=form-group><label for=lastname class="control-label col-xs-2">Last Name</label><div class=col-xs-10><input name=lastname class=form-control ng-model=edit.vm.fields.lastName.value placeholder={{currentUser.lastName}} ng-minlength=2 ng-maxlength=26 name=lastname ng-pattern="/^[A-Za-z ]+$/" ng-change="edit.hideErrors(\'lastname\')" name-input=once><form-error ng-if="editProfileForm.lastname.$error.required && edit.controls.error.lastname">Please fill this in!</form-error><form-error ng-if="editProfileForm.lastname.$error.minlength &&  edit.controls.error.lastname">Too Short!</form-error><form-error ng-if="editProfileForm.lastname.$error.maxlength &&  !editProfileForm.lastname.$pristine">Too long!</form-error><form-error ng-if="editProfileForm.lastname.$error.pattern &&  !editProfileForm.lastname.$pristine">Alphabetical characters only, please.</form-error></div></div><div class=form-group><label for=mobilenumber class="control-label col-xs-2">Mobile No.</label><div class=col-xs-10><input class=form-control ng-model=edit.vm.fields.mobileNumber.value placeholder={{currentUser.mobileNumber}} name=mobile ng-change="edit.hideErrors(\'mobileNumber\')"><form-error ng-if="edit.controls.error.mobileNumber && edit.vm.fields.mobileNumber.value.length > 0">Invalid mobile number.</form-error><span class=help-block ng-if=edit.vm.fields.mobileNumber.modified>Please note that you will have to verify your new mobile number.</span></div></div><button class="btn btn-lg btn-block" ng-bind=edit.vm.buttonText ng-click=edit.saveChanges() ng-class="{\'btn-default\': !edit.controls.formValid || !edit.controls.somethingModified, \'btn-success\': edit.controls.formValid && edit.controls.somethingModified}">Save</button></form></div></div></div></div>'),a.put("views/devpanel.html",'<div class=container-fluid><div class=row><h1>Dev</h1><hr></div><div class=row><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><button type=button class="btn btn-default" ng-click=body.toggleDayNight()>Switch Day/Night</button> <button type=button class="btn btn-primary" ng-click=body.calcND()>Calculate Day/Night</button></div><div class="col-xs-11 col-sm-12 col-md-12 col-lg-12"><button type=button class="btn btn-info" ng-click=body.toggleTestPanel()>Enable Test Panel</button></div></div></div>'),a.put("views/error.html",'<div id=errorpage class="container infopage"><div class=row bindonce><div class="row center-block" id=info><div class=col-sm-2></div><div class="col-xs-12 col-sm-8" bo-if=ErrorView.error.identified>Identified Error!<h1 bo-text=ErrorView.error.title></h1><i class="errorsymbol cr-i-{{ErrorView.error.symbol}} {{ErrorView.error.color ? ErrorView.error.color : \'yellow\'}}"></i><p bo-text=ErrorView.error.text></p></div><div class="col-xs-12 col-sm-8" bo-if=!ErrorView.error.identified><h1>Error</h1><i class="errorsymbol cr-i-alert yellow"></i><p>Something went wrong. We\'ll work hard to fix this problem!</p></div><div class=col-sm-2></div></div><div class="row center-block" id=instructions><div class=col-sm-2></div><div class="col-xs-12 col-sm-8"><p>Please contact us with details of the issue if you notice this happening again!</p><p>Thank You for using<str>Cloakroom</str>!</p></div><div class=col-sm-2></div></div><div class="row center-block" id=errorpage-buttons><div class=col-sm-3></div><div class="col-xs-12 col-sm-6"><a btn-class="btn btn-lg btn-success" bo-if="ErrorView.error.identified && ErrorView.error.dontSendHome" bo-href=ErrorView.error.link.url bo-text=ErrorView.error.link.text></a> <a class="btn btn-lg btn-success" bo-if="!ErrorView.error.identified || !ErrorView.error.dontSendHome" ng-href=/home>Go to Home Page</a> <a class="btn btn-lg btn-warning" ng-href=mailto:team@cloakroom.me>Contact Us</a></div></div><div class=col-sm-3></div></div></div>'),a.put("views/event/apply/apply.html",'<div id=apply-container><div ng-hide=Guestlist.nonMemberStepTwo><h1>{{Guestlist.controls.existingApplication.exists ? "Update" : "Guestlist"}} Request</h1><form id=event-apply-form name=applicationForm novalidate><div ng-if=!userIsLoggedIn><h3>Are you a<div class="cloakroom-logo logo-small">Cloakroom</div>member?</h3><input type=radio id=notmember name=member ng-value=false ng-model=Guestlist.userApplication.isMember ng-change=clickIsMember()><label for=notmember ng-click=clickIsMember()>No</label><input type=radio id=ismember name=member ng-value=true ng-model=Guestlist.userApplication.isMember ng-change=clickIsMember()><label for=ismember ng-click=clickIsMember()>Yes</label><p id=explanation ng-if="Guestlist.userApplication.isMember === false">We will need your name and contact number<br>so that<str>{{Guestlist.event.attributes.memberHost.attributes.firstName}}</str>can get in touch.</p></div><h3>Bringing Friends?</h3><div class="cr-dropdown male"><select name=malePlusOne id=male ng-model=Guestlist.userApplication.malePlusOne><option value=0>+0 Guys</option><option value=1>+1 Guy</option><option value=2>+2 Guys</option><option value=3>+3 Guys</option><option value=4>+4 Guys</option><option value=5>+5 Guys</option><option value=6>+6 Guys</option><option value=7>+7 Guys</option><option value=8>+8 Guys</option><option value=9>+9 Guys</option><option value=10>+10 Guys</option></select><label for=male-plusones><i class="cr-i-triangle male"></i></label></div><div class="cr-dropdown female"><select name=femalePlusOne id=female ng-model=Guestlist.userApplication.femalePlusOne><option value=0>+0 Girls</option><option value=1>+1 Girl</option><option value=2>+2 Girls</option><option value=3>+3 Girls</option><option value=4>+4 Girls</option><option value=5>+5 Girls</option><option value=6>+6 Girls</option><option value=7>+7 Girls</option><option value=8>+8 Girls</option><option value=9>+9 Girls</option><option value=10>+10 Girls</option></select><label for=female-plusones><i class="cr-i-triangle female"></i></label></div><div class=button id=cancel-event-application ng-if="Guestlist.controls.existingApplication.exists && !Guestlist.controls.applying" ng-click=Guestlist.controls.go.cancelApplication() ng-class="{applying: Guestlist.controls.applying}" ng-bind=Guestlist.cancelButtonText>Cancel RSVP</div><div class=button id=submit-event-application ng-click=Guestlist.controls.go.submitApplication() ng-class="{invalidApplication:!currentUser.isLogged && !Guestlist.isMemberClicked, applying: Guestlist.controls.applying, solo: !Guestlist.controls.existingApplication.exists || Guestlist.controls.applying}" ng-bind=Guestlist.applyButtonText>Send</div></form></div><div ng-if=Guestlist.nonMemberStepTwo><h1>Guest Details</h1><p id=explanation ng-if="Guestlist.userApplication.isMember === false"><str>{{Guestlist.event.attributes.memberHost.attributes.firstName}}</str>may invite you to<str>cloakroom</str><br>if {{Guestlist.event.attributes.memberHost.attributes.isFemale ? "she" : "he"}} confirms your place</p><form name=nonMember novalidate><div class=form-group><input class=form-control name=nonMemberName placeholder="Your Name" name-input ng-model=Guestlist.userApplication.nonMemberName ng-minlength=3 ng-maxlength=30 ng-required=!Guestlist.userApplication.isMember ng-pattern="/^[A-Za-z ]+$/"><form-error ng-if="(Guestlist.showErrorFeedback || nonMember.nonMemberNumber.$dirty) && nonMember.nonMemberName.$error.required" class=help-block>Missing Name</form-error><form-error ng-if="Guestlist.showErrorFeedback && nonMember.nonMemberName.$dirty && nonMember.nonMemberName.$error.pattern" class=help-block>Alphabetical only, please.</form-error><form-error ng-if="Guestlist.showErrorFeedback && nonMember.nonMemberName.$error.minlength" class=help-block>Minimum length: 3 characters.</form-error><form-error ng-if="nonMember.nonMemberName.$dirty && nonMember.nonMemberName.$error.maxlength" class=help-block>Maximum length: 30 characters.</form-error></div><div class=form-group><input class=form-control name=nonMemberNumber placeholder="Mobile Number" ng-model=Guestlist.userApplication.nonMemberNumber ng-required=!Guestlist.userApplication.isMember ng-minlength=9 ng-maxlength=15 ng-pattern="/^\\(?(?:(?:0(?:0|11)\\)?[\\s-]?\\(?|\\+)44\\)?[\\s-]?\\(?(?:0\\)?[\\s-]?\\(?)?|0)(?:\\d{2}\\)?[\\s-]?\\d{4}[\\s-]?\\d{4}|\\d{3}\\)?[\\s-]?\\d{3}[\\s-]?\\d{3,4}|\\d{4}\\)?[\\s-]?(?:\\d{5}|\\d{3}[\\s-]?\\d{3})|\\d{5}\\)?[\\s-]?\\d{4,5}|8(?:00[\\s-]?11[\\s-]?11|45[\\s-]?46[\\s-]?4\\d))(?:(?:[\\s-]?(?:x|ext\\.?\\s?|\\#)\\d+)?)$/"><form-error class=help-block ng-if="Guestlist.showErrorFeedback && nonMember.$dirty && nonMember.nonMemberNumber.$error.required">Missing Mobile Number</form-error><form-error class=help-block ng-if="Guestlist.showErrorFeedback && nonMember.nonMemberNumber.$dirty && nonMember.nonMemberNumber.$error.pattern">Invalid Mobile Number</form-error></div></form><div class=button id=submit-event-application ng-click=Guestlist.controls.go.submitApplication() ng-class="{invalidApplication: nonMember.$invalid, applying: Guestlist.controls.applying, solo: !Guestlist.controls.existingApplication.exists || Guestlist.controls.applying}" ng-bind=Guestlist.applyButtonText>Send</div></div></div>'),a.put("views/event/apply/confirmation.html",'<div id=application-confirmation-container><h1>Thank You!</h1><p><str>{{Guestlist.event.attributes.memberHost.attributes.firstName}}</str>has been notified.</p><h3>More:</h3><button type=button class="btn btn-lg btn-warning" id=host-profile ng-click=Guestlist.controls.go.toHostProfile()>{{Guestlist.event.attributes.memberHost.attributes.firstName}}\'s Profile</button> <button type=button class="btn btn-lg btn-info" id=event-page ng-click=Guestlist.controls.go.backToEvent()>Event Page</button></div>'),a.put("views/event/apply/edit.html","<div edit-monster-form monster-to-save=applicationCtrl.current></div>"),a.put("views/event/detail.html","<link rel=stylesheet href=/vendor/leaflet.css><div id=eventpage-container ng-if=Guestlist.controls.guestlistFound><h2>{{Guestlist.event.attributes.venue.attributes.venueName}}</h2><h1>{{Guestlist.event.attributes.guestlistName}}</h1><span class=countdown live-time-difference=Guestlist.event.attributes.dateOfEvent></span><div id=event-graphics><div id=event-club><img ng-src={{Guestlist.event.attributes.venue.attributes.photoUrl}} alt={{Guestlist.event.attributes.venue.attributes.venueName}}></div><div id=event-map><leaflet center=map.center markers=markers watch-markers=false defaults=mapDefaults></leaflet></div></div><div class=profile-details ng-click=goTo.profile(Guestlist.event.attributes.memberHost)><profile-photo image=\"{{generatePhotoUrl({photoFileInfo: Guestlist.event.attributes.memberHost.attributes.photoFileInfo})}}\" ng-if=Guestlist.event.attributes.memberHost.attributes.photoFileInfo member=Guestlist.event.attributes.memberHost.attributes></profile-photo><photo-placeholder ng-if=!Guestlist.event.attributes.memberHost.attributes.photoFileInfo female=Guestlist.event.attributes.memberHost.attributes.isFemale></photo-placeholder><div id=profile-bio><h3>Hosted By</h3><h1>{{Guestlist.event.attributes.memberHost.attributes.firstName}}</h1><span class=alias>~{{Guestlist.event.attributes.memberHost.attributes.alias}}</span><br><span class=mobile>{{Guestlist.event.attributes.memberHost.attributes.mobileNumber | ukMobileNumber}}</span><br><ul class=verified-clubs ng-if=Guestlist.controls.verified><li><i class=cr-i-diamond ng-class={higher:!Guestlist.controls.longVenueName}></i> Verified at&nbsp;<br ng-if=Guestlist.controls.longVenueName><span class=verified-club>{{Guestlist.event.attributes.venue.attributes.venueName}}</span></li></ul></div></div><div class=container-fluid id=share-and-apply><div class=row><div class=col-xs-12><div ng-click=Guestlist.controls.go.apply()><div id=application ng-if=!Guestlist.controls.existingApplication.exists><div id=application-inner><span class=status>Get on {{Guestlist.event.attributes.memberHost.attributes.firstName}}'s Guestlist</span> Join</div></div><div ng-hide=Guestlist.controls.existingApplication.onList><div id=application class=applied ng-if=Guestlist.controls.existingApplication.exists><div id=application-inner><span class=status>Waiting for {{Guestlist.event.attributes.memberHost.attributes.firstName}}'s Response</span> Edit Request?</div></div></div><div id=application ng-if=Guestlist.controls.existingApplication.onList class=confirmed><div id=application-inner><span class=status>You're&nbsp;<str>on the list!</str></span> Edit RSVP?</div></div></div></div></div></div></div><div id=page-not-found ng-if=!Guestlist.controls.guestlistFound><i class=cr-i-alert></i><h1>Sorry</h1><p>We could not find the guestlist you were looking for.</p><a ui-sref=home>Home</a></div>"),a.put("views/event/new.html",'<div class=checkable></div><div class="checkable checked"></div>'),a.put("views/legal.html",'<div class="container infopage legal"><h1>Legal</h1><div class=row><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><h2>T&C and Privacy Policy</h2><p>You must Agree to our <a ui-sref=tandc>Terms and Conditions</a> to sign up and use Cloakroom.</p><p>For information on our Privacy Policy, <a ui-sref=privacypolicy>click here</a>.</p></div></div><div class=row><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><h2>Credits</h2><p>The <strong>Cloakroom</strong> service is a production of <strong>Cloakroom</strong>, a North-London based company founded by <a href=member/rai>Rai Butera</a>.</p><p>Cloakroom would like to thank the following for their assistance, contribution and support in creating a memorable experience for its members:</p><ul id=credits-list><li>Iconography and Art<ul><li>D. Stempel AG</li><li>Entypo</li><li>Bram Van Rijen</li><li>Michel Demers</li><li>Maico Amorim</li><li>Darren Baron</li><li>Ryan Hook</li><li>Gustav Salomonsson</li><li>Greg Pabst</li><li>Jordan Delcros</li><li>Anas Ramadan</li><li>Alex Rakas</li><li>Stephen JB Thomas</li><li>Wesley Hare</li><li>Daniel Llamas Soto</li><li>Entypo</li><li>James Zamyslianskyj</li><li>TukTuk Designs</li><li>Dmitry Baranovskiy</li><li>P.J Onori</li><li>Ryan Dell</li><li>Sam Fermette</li><li>Oleg Frolov</li><li>FontAwesome</li><li>Berkay Margin</li><li>Dmitry Mirolyubov</li><li>Useiconic</li><li>Lubos Volkov</li><li>Martin Chapman</li><li>Mateo Zlatar</li><li>S Walker</li><li>Tim Shedor</li><li>Dan Hetteix</li><li>JustVectorSocial</li><li>Foundation</li></ul></li><li>Software<ul><li>The AngularJS Team</li><li>Parse.com</li><li>Brandid</li><li>The Uploadcare Team</li><li>Twitter</li><li>Davemo</li><li>Snap.js</li><li>ocLazyLoad</li><li>Localforage</li><li>Moment</li><li>The jQuery Team</li></ul></li></ul></div></div></div>'),a.put("views/login.html",'<div id=login-container><cloakroom-logo></cloakroom-logo><fb-button ng-click=Login.withFacebook() ng-if="Login.vm.fbStage < 0">Login with Facebook</fb-button><fb-button ng-click=Login.withFacebook() ng-if="Login.vm.fbStage >= 0">Logging You In...</fb-button><mini-loading-bar ng-if="Login.vm.fbStage >= 0"></mini-loading-bar><form-divider ng-if="Login.vm.fbStage === -1"></form-divider><form id=login-form class=legacyCRForm name=loginForm novalidate ng-if="Login.vm.fbStage === -1"><div class=form-group ng-class="{\'has-error\':loginForm.loginAlias.$error && submitted, \'has-feedback\': Login.vm.showFeedback.loginAlias}"><input class=form-control placeholder="Your Alias or Mobile No." name=loginAlias id=login-alias ng-minlength=3 ng-maxlength=14 ng-model=Login.credentials.aliasOrMobile ng-change=change() ng-class="{error:Login.badFields.aliasOrMobile && loginForm.loginAlias.$invalid && submitted}" required><form-error ng-if="loginForm.loginAlias.$error.required && submitted">Please fill this in.</form-error><form-error ng-if="loginForm.loginAlias.$error.minlength && submitted">Too Short!</form-error><form-error ng-if="loginForm.loginAlias.$error.maxlength && !loginForm.loginAlias.$pristine">Too long!</form-error><span class="cr-i-alert form-control-feedback" ng-if="(Login.vm.showFeedback.loginAlias && loginForm.loginAlias.$invalid && submitted) || (loginForm.loginAlias.$invalid && loginForm.password.$dirty && submitted)"></span> <span class="cr-i-tick form-control-feedback" ng-if="Login.vm.showFeedback.loginAlias && loginForm.loginAlias.$valid"></span></div><div class=form-group ng-class="{\'has-error\':loginForm.password.$error && submitted, \'has-feedback\': Login.vm.showFeedback.password}"><input type=password class=form-control placeholder=Password name=password ng-minlength=4 id=login-password ng-change=change() ng-model=Login.credentials.password ng-class="{error:Login.badFields.password && loginForm.password.$invalid && submitted}" required><form-error ng-if="loginForm.password.$error.required && submitted">Please fill this in.</form-error><form-error ng-if="loginForm.password.$error.minlength && submitted">Too short!</form-error><span class="cr-i-alert form-control-feedback" ng-if="submitted && Login.vm.showFeedback.password && loginForm.password.$invalid"></span> <span class="cr-i-tick form-control-feedback" ng-if="submitted && Login.vm.showFeedback.password && loginForm.password.$valid"></span></div><div class=form-group><input type=submit class=button id=login-submit ng-click="Login.login(Login.credentials.aliasOrMobile, Login.credentials.password)" ng-class={unfilled:loginForm.$invalid} value={{Login.vm.loginButton}}></div></form><a id=login-forgot ng-click=Login.goToMembership() ng-if="Login.vm.fbStage === -1">invited?</a></div>'),a.put("views/member-search-result.html",'<a bindonce=match><div class="member-photo result-photo"><img bo-if=match.model.photoFileInfo bo-src-i="{{$root.generatePhotoUrl({photoFileInfo: match.model.photoFileInfo, size: \'xs\'})}}"><div bo-if=!match.model.photoFileInfo><photo-placeholder female=match.model.isFemale></photo-placeholder></div></div><div class=result-details><span bo-text=match.model.firstName></span>&nbsp;<span class=alias>~<span bo-text=match.model.alias></span></span></div></a>'),a.put("views/member/connect-facebook.html","<h1>Connect Facebook</h1>Connect It."),a.put("views/member/edit-profile.html",'<div class="container infopage formpage"><h1>Edit Profile</h1><div class=row id=before-form><div class=col-xs-12><div class="col-xs-1 col-sm-2"></div><div class="col-xs-10 col-sm-8"><p class="text-center instructions">To change any of your personal details, please fill in the appropriate field below and tap/click <strong>save</strong>. To cancel, just leave this page.</p></div><div class="col-xs-1 col-sm-2"></div></div></div><div class=row id=has-form><div class=center-block><div class=col-xs-12><form name=editProfileForm class=form-horizontal role=form><div class=form-group><label for=firstname class="control-label col-xs-2">First Name</label><div class=col-xs-10><input name=firstname class=form-control ng-model=edit.vm.fields.firstName.value placeholder={{currentUser.firstName}} ng-minlength=3 ng-maxlength=11 name-input ng-pattern="/^[A-Za-z ]+$/" required ng-change="edit.hideErrors(\'firstname\')"><form-error ng-if="editProfileForm.firstname.$error.minlength &&  edit.controls.error.firstname">Too Short!</form-error><form-error ng-if="editProfileForm.firstname.$error.maxlength &&  !editProfileForm.firstname.$pristine">Too long!</form-error><form-error ng-if="editProfileForm.firstname.$error.pattern &&  !editProfileForm.firstname.$pristine">Alphabetical characters only, please.</form-error></div></div><div class=form-group><label for=lastname class="control-label col-xs-2">Last Name</label><div class=col-xs-10><input name=lastname class=form-control ng-model=edit.vm.fields.lastName.value placeholder={{currentUser.lastName}} ng-minlength=2 ng-maxlength=26 name=lastname ng-pattern="/^[A-Za-z ]+$/" ng-change="edit.hideErrors(\'lastname\')" name-input=once><form-error ng-if="editProfileForm.lastname.$error.required && edit.controls.error.lastname">Please fill this in!</form-error><form-error ng-if="editProfileForm.lastname.$error.minlength &&  edit.controls.error.lastname">Too Short!</form-error><form-error ng-if="editProfileForm.lastname.$error.maxlength &&  !editProfileForm.lastname.$pristine">Too long!</form-error><form-error ng-if="editProfileForm.lastname.$error.pattern &&  !editProfileForm.lastname.$pristine">Alphabetical characters only, please.</form-error></div></div><div class=form-group><label for=mobilenumber class="control-label col-xs-2">Mobile No.</label><div class=col-xs-10><input class=form-control ng-model=edit.vm.fields.mobileNumber.value placeholder={{currentUser.mobileNumber}} name=mobile ng-change="edit.hideErrors(\'mobileNumber\')"><form-error ng-if="edit.controls.error.mobileNumber && edit.vm.fields.mobileNumber.value.length > 0">Invalid mobile number.</form-error><span class=help-block ng-if=edit.vm.fields.mobileNumber.modified>Please note that you will have to verify your new mobile number.</span></div></div><div class=form-group><label for=email class="control-label col-xs-2">Email Address</label><div class=col-xs-10><input type=email class=form-control ng-model=edit.vm.fields.email.value placeholder={{currentUser.email}} name=mobile ng-change="edit.hideErrors(\'email\')"><form-error ng-if="edit.controls.error.email && edit.vm.fields.email.value.length > 0">Invalid Email.</form-error></div></div><button class="btn btn-lg btn-block" ng-bind=edit.vm.buttonText ng-click=edit.saveChanges() ng-class="{\'btn-default\': !edit.controls.formValid || !edit.controls.somethingModified, \'btn-success\': edit.controls.formValid && edit.controls.somethingModified}">Save</button></form></div></div></div></div>'),a.put("views/member/home.html",'<div class="container home"><div id=welcome class=row><div class=row><div class="col-xs-0 col-md-3"></div><div class="col-xs-12 col-md-6"><div class="member-photo clickable" ng-click=changeOwnPhoto(Home.vm.user)><profile-photo ng-if=Home.status.has.photo image="{{generatePhotoUrl({photoFileInfo: Home.vm.user.photoFileInfo, size: \'medium\'})}}"></profile-photo><photo-placeholder female=Home.vm.user.isFemale ng-if=!Home.status.has.photo></photo-placeholder></div>Welcome,<str>{{Home.vm.user.firstName}}</str>!</div><div class="col-xs-0 col-md-3"></div></div></div><div id=home-search class="row homepage-heading"><div class="col-xs-0 col-md-2"></div><div class="col-xs-12 col-md-8" id=content><h2>Search</h2><h3>Looking for Someone You Know?</h3><div class=col-xs-12><form name=search novalidate><div class=form-group><label class="control-label label-inner-icon noncolumn" for=findMember><i class=cr-i-search></i></label><div class=col-xs-11><input class="form-control input has-feedback" name=findMember ng-model=Home.search.searchTerm placeholder="Type in a Member\'s Alias" ng-change=Home.search.change(Home.search.searchTerm) typeahead="result.username for result in Home.search.searching($viewValue)" typeahead-wait-ms=300 typeahead-min-length=3 typeahead-template-url=/views/member-search-result.html typeahead-loading=Home.search.loading typeahead-on-select="Home.search.go($item, $model, $label)"> <span class="form-control-feedback cr-i-delete-circle clickable" ng-if=Home.search.deletable ng-click="Home.search.searchTerm = \'\'; Home.search.deletable = false"></span><label for=findMember class=sr-only>Looking for someone you know on Cloakroom? Type in their <strong>alias</strong></label></div></div></form></div><mini-loading-bar ng-if=Home.search.loading></mini-loading-bar></div><div class="col-xs-0 col-md-2"></div></div><div id=my-events class=row><div class="row homepage-heading"><div class="col-xs-0 col-md-2"></div><div id=content class="col-xs-12 col-md-8" ng-if=Home.status.has.applications><h2>Your Events</h2><div bindonce ng-repeat="event in Home.vm.applications" bo-class="{\'col-xs-12\': $index === 0, \'notNext\': $index !== 0, \'col-xs-3\': $index !== 0, \'col-lg-2\': $index !== 0}"><h3 bo-if="Home.vm.controls.applicationCount > 0 && $index === 0">Next</h3><div class=event-card bo-class="{large: $index === 0, small: $index !== 0}" ng-click=Home.vm.controls.viewGuestlist(event.attributes.guestlist)><div class="venue-photo {{event.attributes.guestlist.attributes.venue.id}}" bo-class="{full: $index === 0}"></div><div class=event-text><div class=guestlistName bo-if="$index === 0">{{event.attributes.guestlist.attributes.guestlistName}}</div><venue-name venue=event.attributes.guestlist.attributes.venue class=venueName></venue-name><div class=eventDay bo-if="$index !== 0"><week-day date=event.attributes.guestlist.attributes.dateOfEvent></week-day></div><div bo-if="$index === 0"><div class=countdown live-time-difference=event.attributes.guestlist.attributes.dateOfEvent></div></div><div><div class=countdown short-time-difference=event.attributes.guestlist.attributes.dateOfEvent bo-if="$index !== 0"></div></div><div class=host bo-if="$index === 0">hosted by <strong>{{event.attributes.guestlist.attributes.memberHost.attributes.firstName}}</strong></div><div class="status {{event.status}}" bo-if="$index === 0"><i bo-class="{\'cr-i-tick\': event.status === \'accepted\',\'cr-i-locationpin\': event.status === \'complete\' ,\'cr-i-dot-3\' : event.status === \'applied\' || event.status === \'rejected\', \'cr-i-dot-2\': event.status === \'modified\'}"></i>{{Home.interpretStatus(event)}}</div></div></div><h3 bo-if="Home.vm.controls.applicationCount > 1 && $index === 0">Upcoming</h3></div><div class="col-xs-0 col-md-2"></div></div></div><div class=row id=suggestions-only ng-if="!Home.status.has.applications && !Home.status.has.linkedLists"><div class="col-xs-0 col-md-3"></div><div class="col-xs-12 col-md-6"><div id=empty-home><p class=text-center><i class="cr-i-alert small"></i></p><p class=text-center>No members <strong>linked</strong> to <strong>you</strong> are <strong>hosting</strong> or <strong>attending</strong> upcoming events.</p><p class=text-center ng-if=!Home.status.has.suggestions>Link more members or check back another time.</p></div><div id=content><h2 class=text-left ng-if=Home.status.has.suggestions>Why don\'t you check out...</h2></div><div id=eventfeed-feed class=row><div bindonce ng-repeat="item in Home.vm.linkedItems"><div class="linked-member-event col-xs-12" bo-if="item.type === \'suggestion\'"><div class=row><div class="col-xs-0 col-md-2"></div><div class="col-xs-2 col-md-1 eventfeed-icon" ng-click=Home.vm.controls.viewGuestlist(item.list)><div class=eventfeed-icon-inner><div class="eventfeed-icon-venue small"><div class="venue-photo {{item.list.attributes.venue.id}}"></div></div></div></div><div class="col-xs-10 col-md-9 eventfeed-text"><span class=subject bo-bind="item.list.attributes.dateOfEvent | date:\'EEEE d MMMM\'"></span><p class=message>a guestlist is being hosted at&nbsp;<venue-name venue=item.list.attributes.venue></venue-name>&nbsp;<span class=day live-time-difference=item.list.attributes.dateOfEvent></span>. <a bo-href-i="#/event/{{item.list.id}}/">view</a></p></div></div></div></div></div></div><div class="col-xs-0 col-md-3"></div></div><div id=eventfeed class=row ng-if="Home.status.has.linkedLists || (Home.vm.linkedItems && Home.vm.linkedItems.length > 0)"><div class=col-md-2></div><div class="col-xs-0 col-md-4"><div ng-if="Home.vm.recentActivities.all && Home.vm.recentActivities.all.length > 0"><div class="row homepage-heading"><h2>Your recent activity</h2></div><div class=row><ul id=home-recent><activity-item bindonce ng-repeat="activityItem in Home.vm.recentActivities.all" data=activityItem class={{activityItem.attributes.activity}}></activity-item></ul></div></div></div><div class=col-xs-0 ng-class="{\'col-md-4\': Home.vm.linkedItems && Home.vm.linkedItems.length > 0}"><div class="row homepage-heading" ng-show="Home.vm.linkedItems && Home.vm.linkedItems.length > 0"><h2>You may be interested&hellip;</h2></div><div id=eventfeed-feed class=row><div bindonce ng-repeat="item in Home.vm.linkedItems"><div class="host-event col-xs-12" bo-if="item.type === \'host\'"><div class=row><div class="col-xs-2 eventfeed-icon" ng-click=Home.vm.controls.viewGuestlist(item.list)><div class=eventfeed-icon-inner><div class="eventfeed-icon-venue small"><div class="venue-photo {{item.list.attributes.venue.id}}"></div></div><div class=eventfeed-icon-member bo-if=item.host.photoFileInfo><img class=member-photo bo-src="generatePhotoUrl({photoFileInfo: item.host.photoFileInfo, size: \'medium\'})"></div></div></div><div class="col-xs-10 eventfeed-text"><span class=subject>{{item.host.firstName}}</span><p class=message>is hosting&nbsp;<str><a bo-href-i="#/event/{{item.list.id}}/" bo-text=item.list.attributes.guestlistName></a></str> at&nbsp;<venue-name venue=item.list.attributes.venue></venue-name>&nbsp;<span class=day><event-weekday date={{item.list.attributes.dateOfEvent}}></event-weekday></span>. <span bo-if="item.info.linksAttending > 0"><br><span class=count>{{item.info.linksAttending}}</span> of your links {{item.info.linksAttending > 1 ? "are" : "is"}} going.</span> <a bo-href-i="event/{{item.list.id}}/">view</a></p></div></div></div><div class="linked-member-event col-xs-12" bo-if="item.type === \'guests\'"><div class=row><div class="col-xs-2 eventfeed-icon" ng-click=Home.vm.controls.viewGuestlist(item.list)><div class=eventfeed-icon-inner><div class="eventfeed-icon-venue small"><div class="venue-photo {{item.list.attributes.venue.id}}"></div></div></div></div><div class="col-xs-10 eventfeed-text"><span class=subject><str bo-text=item.info.linksAttending></str>&nbsp;of your Links</span><p class=message>{{item.info.linksAttending > 1 ? "are" : "is"}} going to&nbsp;<venue-name venue=item.list.attributes.venue></venue-name>&nbsp;<span class=day><event-weekday date={{item.list.attributes.dateOfEvent}}></event-weekday></span>. <a bo-href-i="#/event/{{item.list.id}}/">view</a></p></div></div></div><div class="linked-member-event col-xs-12" bo-if="item.type === \'suggestion\'"><div class=row><div class="col-xs-2 eventfeed-icon" ng-click=Home.vm.controls.viewGuestlist(item.list)><div class=eventfeed-icon-inner><div class="eventfeed-icon-venue small"><div class="venue-photo {{item.list.attributes.venue.id}}"></div></div></div></div><div class="col-xs-10 eventfeed-text"><span class=subject bo-bind="item.list.attributes.dateOfEvent | date:\'EEEE d MMMM\'"></span><p class=message>a guestlist is being hosted at&nbsp;<venue-name class=force-color venue=item.list.attributes.venue></venue-name>&nbsp;<span class=day live-time-difference=item.list.attributes.dateOfEvent></span>&nbsp;<a bo-href-i="#/event/{{item.list.id}}/">view</a></p></div></div></div></div></div></div><div class=col-md-2></div></div></div></div>'),a.put("views/member/my-links.html",'<div id=my-links class="container-fluid infopage"><h1>Links</h1><div class=row><div class=col-xs-12><label class="col-xs-1 control-label control-label-lg label-inner-icon" for=searchLinks><i class=cr-i-search></i></label><div class=col-xs-10><input class="form-control input-lg has-feedback" name=searchLinks placeholder="Type a link\'s Name or Alias" ng-model=links.searchTerm ng-change=links.actions.searching()><span class="form-control-feedback cr-i-delete-circle clickable" ng-if="links.searchTerm.length > 0" ng-click="links.searchTerm = \'\'"></span><label for=searchLinks class=sr-only>Search links by typing a link\'s Name or Cloakroom Alias</label></div></div></div><div class=row><div class=col-xs-12><div ng-if="links.controls.searching === true"><div class=row ng-if="links.search.ongoing === true"><div class=col-xs-12><mini-loading-bar></mini-loading-bar></div></div><div id=results ng-if="links.search.ongoing === false"><div ng-if="links.search.results.length === 0 && links.searchTerm !== \'\'">No results</div><div ng-if="links.search.results.length > 0"><div class="row link-item-wrapper" ng-repeat="link in links.search.results"><div class=link-item-container><div class="col-xs-2 icon"><profile-photo image={{link.photoUrl}} ng-if=link.photoUrl></profile-photo><photo-placeholder female=link.isFemale ng-if=!link.photoUrl></photo-placeholder></div><div class="col-xs-4 details"><span class=firstName ng-if=link.firstName>{{link.firstName}}</span> <span class=lastName ng-if=link.lastName>{{link.lastName}}</span> <span class=alias>~{{link.alias}}</span> <span class=mobileNumber ng-if=link.mobileNumber>link.mobileNumber</span></div><div class="col-xs-6 actions"><a ng-click="links.actions.unlink(link.id, link.firstName)">Unlink</a> <a ng-href=/member/{{link.username}}>View Profile</a></div></div></div></div></div></div><div ng-if="links.search.results.length === 0 || !links.controls.hideInitial || links.searchTerm === \'\'"><div class="row link-item-wrapper" ng-repeat="link in links.vm.data | filter: links.searchTerm"><div class=link-item-container><div class="col-xs-2 icon"><profile-photo image={{link.photoUrl}} ng-if=link.photoUrl></profile-photo><photo-placeholder female=link.isFemale ng-if=!link.photoUrl></photo-placeholder></div><div class="col-xs-4 details"><span class=firstName ng-if=link.firstName>{{link.firstName}}</span> <span class=lastName ng-if=link.lastName>{{link.lastName}}</span> <span class=alias>~{{link.alias}}</span> <span class=mobileNumber ng-if=link.mobileNumber>link.mobileNumber</span></div><div class="col-xs-6 actions"><a ng-click="links.actions.unlink(link.id, link.firstName)">Unlink</a> <a ng-href=/member/{{link.username}}>View Profile</a></div></div></div></div></div></div><div class=row><button type=button class="btn btn-default btn-block" ng-click=links.actions.nextPage() ng-if="(!links.controls.searching || links.searchTerm === \'\') && links.controls.showMoreButton && !links.controls.fetchingMore && (links.vm.data.length % 10 === 0 && links.vm.modified === false)">More</button><div class=col-xs-12 ng-if=links.controls.fetchingMore><mini-loading-bar></mini-loading-bar></div></div></div>'),a.put("views/member/password.html",'<div class="container infopage formpage"><h1>Change Password</h1><div class=row id=before-form><div class=col-xs-12><div class="col-xs-1 col-sm-2"></div><div class="col-xs-10 col-sm-8"><p class="text-center instructions">To change your password, please fill in the appropriate field below and tap/click <strong>save</strong>. To cancel, just leave this page.<br><strong>Please note</strong>: all passwords are <strong>cAsE-seNSitTIve</strong>, should be longer than <strong>8</strong> characters, and can only contain <strong>alphanumeric</strong> characters (A-Z, a-z, 0-9, no spaces or symbols).</p></div><div class="col-xs-1 col-sm-2"></div></div></div><div class=row id=has-form><div class=center-block><div class=col-xs-12><form name=changePasswordForm class=form-horizontal role=form><div class=form-group><label for=newPassword class="control-label col-xs-2">New</label><div class=col-xs-10><input type=password name=newPassword class=form-control ng-model=password.vm.fields.password.value placeholder="Your New Password" ng-minlength=8 ng-maxlength=32 required ng-change="password.hideErrors(\'newPassword\')"><form-error ng-if="changePasswordForm.newPassword.$error.minlength &&  password.controls.error.password">Too Short!</form-error><form-error ng-if="changePasswordForm.newPassword.$error.maxlength &&  !changePasswordForm.newPassword.$pristine">Too long!</form-error></div></div><div class=form-group><label for=repeatPassword class="control-label col-xs-2">Repeat</label><div class=col-xs-10><input type=password name=repeatPassword class=form-control ng-model=password.vm.fields.repeatPassword.value placeholder="Repeat Password" ng-minlength=8 ng-maxlength=32 name=repeatPassword ng-change="password.hideErrors(\'repeatPassword\')"><form-error ng-if="changePasswordForm.repeatPassword.$error.required && password.controls.error.repeatPassword">Please fill this in!</form-error><form-error ng-if="changePasswordForm.repeatPassword.$error.minlength &&  password.controls.error.repeatPassword">Too Short!</form-error><form-error ng-if="changePasswordForm.repeatPassword.$error.maxlength &&  !changePasswordForm.repeatPassword.$pristine">Too long!</form-error><form-error ng-if="password.vm.fields.repeatPassword.value !== password.vm.fields.password.value && !changePasswordForm.repeatPassword.$pristine">Does not match</form-error></div></div><button class="btn btn-lg btn-block" ng-bind=password.vm.buttonText ng-click=password.saveChanges() ng-class="{\'btn-default\': !password.controls.formValid || !password.controls.somethingModified, \'btn-success\': password.controls.formValid && password.controls.somethingModified}">Save</button></form></div></div></div></div>'),a.put("views/member/privacy-settings.html",'<div class="container infopage"><h1>Privacy Settings</h1>Privacy, who doesn\'t need it?</div>'),a.put("views/member/profile.html",'<div id=member-container ng-if=Profile.controls.profileFound><div class=profile-details ng-class={nonHost:!Profile.controls.hostProfile}><profile-photo image="{{generatePhotoUrl({photoFileInfo: member.photoFileInfo, size: large})}}" member=member ng-if=Profile.controls.photoExists ng-class="{clickable: Profile.member.id === currentUser.id}" ng-click=changeOwnPhoto()><div id=linking-indicator ng-show=Profile.controls.linking>Linked</div></profile-photo><photo-placeholder female=member.isFemale ng-if=!Profile.controls.photoExists ng-class="{clickable: Profile.member.id === currentUser.id}" ng-click=changeOwnPhoto()><div id=linking-indicator ng-show=Profile.controls.linking>Linked</div></photo-placeholder><div id=profile-bio><h1>{{member.firstName}}</h1><span class=alias>~{{member.alias}}</span><br><span class=mobile ng-if=member.isHost>{{member.mobileNumber | ukMobileNumber}}</span><br><a href="" id=link-member class=small ng-show=Profile.controls.showLinkButton ng-click=toggleMemberLink(member._id) ng-class={linked:Profile.controls.linking}><i class=cr-i-linking></i>{{Profile.controls.linking ? "Unlink" : "Link"}}{{member.firstname.length > 10 ? "" : " " + member.firstName}}</a><div id=member-additional ng-show=Profile.controls.showAddGuestbutton><div class=button ng-if=currentUser.isHost>Add to Guestlist</div></div></div></div><div id=upcoming ng-if=Profile.controls.hostProfile><h2>Upcoming Event:</h2><div id=upcoming-event class={{upcomingEvent.venue.id}} ng-class={noEvent:!upcomingEvent}><p ng-if=!upcomingEvent>{{member.alias}} has no upcoming guestlists.</p><div class=venue-card-details ng-if=upcomingEvent ng-click=Profile.controls.goToUpcomingEvent();><div class=inner><h2 ng-show=upcomingEvent.guestlistName>{{upcomingEvent.guestlistName}}</h2><h3>{{upcomingEvent.venue.attributes.venueName}}</h3><span class=date live-time-difference=upcomingEvent.dateOfEvent ng-if=upcomingEvent.dateOfEvent></span></div></div></div></div><div id=member-verified ng-if=Profile.controls.hostProfile><ul class=verified-clubs><li ng-repeat="club in verifiedVenues"><i class=cr-i-diamond></i>Verified at <span class=verified-club>{{club.attributes.venueName}}</span></li></ul></div></div><div id=page-not-found ng-if=!Profile.controls.profileFound><i class=cr-i-alert></i><h1>Sorry</h1><p>We could not find the member you were looking for.</p><a ui-sref=home>Home</a></div>'),a.put("views/member/verify-mobile.html",'<div id=verify-mobile class="container infopage formpage"><div class=row ng-if=!verification.vm.alreadyVerified><div class=col-xs-12><h1>Verify Mobile</h1></div></div><div class=row id=before-form ng-if="verification.controls.showForm && !verification.vm.alreadyVerified"><div class=col-xs-12><p class="instructions text-center">Please verify that you are the owner of <strong>{{currentUser.mobileNumber | ukMobileNumber}}</strong>.</p><p class="instructions text-center small">Cloakroom always <strong>respects</strong> your privacy. Your mobile number <strong>will never be shared</strong> to third parties and will not be publicly visible on your profile.</p></div></div><div class=row id=before-form ng-if="verification.controls.showForm && !verification.vm.alreadyVerified"><div class=col-xs-12><h3>Enter Code</h3></div></div><div class=row id=has-form ng-if="verification.controls.showForm && !verification.vm.alreadyVerified"><div class=col-xs-12><form name=enterCode class=form-horizontal novalidate><div class=col-xs-10><input name=secret id=inputSecret class="form-control input-lg" ng-model=verification.vm.ms placeholder="Enter Code" ng-disabled=verification.controls.checking required></div><div class=col-xs-1><button id=verifyCode type=button ng-if=!verification.controls.checking ng-click=verification.checkMS() class="btn btn-lg btn-success">Verify</button><div ng-if=verification.controls.checking><mini-loading-bar></mini-loading-bar></div></div></form></div></div><div class=row id=before-form ng-if="verification.controls.showButton && !verification.vm.alreadyVerified"><div class=col-xs-12><h3>Request Code</h3><p class="text-center instructions">Don\'t have a code yet?</p><div class=button-container ng-if=!verification.controls.buttonPressed><button type=button class="btn btn-primary" ng-click=verification.requestText() ng-bind=verification.vm.buttonText>Send SMS to {{currentUser.mobileNumber | ukMobileNumber}}</button></div><div class=button-container ng-if=verification.controls.buttonPressed><p class=text-center>A text has been sent to {{currentUser.mobileNumber | ukMobileNumber}} containing your code.</p></div></div><div class=col-xs-12><p id=after-button class="instructions text-center small">Not your number? <a ng-click=goTo.editProfile()>You can change it here.</a></p></div></div><div class=row id=alert ng-if="verification.controls.showResult && !verification.vm.alreadyVerified"><div class=col-xs-12><div class=row><div class=col-xs-12 ng-if=verification.vm.success><i class="cr-i-tick large green"></i><h2>Thank You!</h2><p>Your mobile number has been verified. Thank you!</p><button type=button ng-click=goTo.options() class="btn btn-block btn-lg btn-success">Back to Settings</button></div><div class=col-xs-12 ng-if=!verification.vm.success><i class="cr-i-x large red"></i><h2>Sorry</h2><p>Mobile number verification failed.</p><button type=button ng-click=verification.tryAgain() class="btn btn-block btn-lg btn-warning">Try Again?</button></div></div></div></div><div class=row id=alert ng-if=verification.vm.alreadyVerified><div class=col-xs-12><h1>Already Verified!</h1></div><div class=col-xs-12><i class="cr-i-alert large yellow"></i><p class=text-center>You have already verified your mobile number!</p></div><div class=col-xs-12 ng-click=goTo.options()><button type=button ng-click=goTo.options() class="btn btn-block btn-lg btn-success">Back to Settings</button></div></div></div>'),a.put("views/membership/new.html",'<div id=create-membership-container ng-if="Membership.canLogin && Membership.controls.displaySignup"><h1 ng-if=Membership.controls.showTitle>{{Membership.controls.title}}</h1><div ng-if="!Membership.controls.showForm && !Membership.controls.hideButtons"><fb-button ng-click="Membership.controls.buttonAction.fb(\'fb\')">Connect to Facebook</fb-button><p><str>cloakroom</str>&nbsp;will not post anything to your facebook,&nbsp;<str>ever</str>.</p><form-divider></form-divider><div class=button id=create-cloakroom ng-click="Membership.controls.buttonAction.cr(\'cr\')"><i class=cr-i-key></i>Create Account</div><p>Don\'t like Facebook? Choose this.</p><br><p><str>cloakroom</str>&nbsp;will&nbsp;<str>always</str>&nbsp;respect your privacy.</p></div><div ng-if=Membership.controls.askingInvite id=askingInvite><h1 id=invitationDetails>Invitation Details</h1><p>An invitation is required to become a Cloakroom member.</p><form name=checkInvitation ng-submit="Membership.controls.checkInvitation(Membership.newMember.invitedBy, Membership.newMember.mobileNumber)" novalidate><p class=question ng-if=Membership.controls.askInvitedBy>Who were you&nbsp;<str>invited by</str>?</p><input placeholder="Invited By (Alias)" ng-hide=Membership.controls.invitedByPrefilled ng-model=Membership.newMember.invitedBy name=invitedby ng-disabled=Membership.controls.invitedByPrefilled required><form-error ng-show="checkInvitation.invitedBy.$error.required && Membership.controls.error.invitedBy">Please fill in the Cloakroom alias of the member that invited you.</form-error><p class=question>What is your<str>mobile number</str>?</p><input name=mobileNumber placeholder="Mobile No." mobile-number-input ng-model=Membership.newMember.mobileNumber ng-pattern="/^\\(?(?:(?:0(?:0|11)\\)?[\\s-]?\\(?|\\+)44\\)?[\\s-]?\\(?(?:0\\)?[\\s-]?\\(?)?|0)(?:\\d{2}\\)?[\\s-]?\\d{4}[\\s-]?\\d{4}|\\d{3}\\)?[\\s-]?\\d{3}[\\s-]?\\d{3,4}|\\d{4}\\)?[\\s-]?(?:\\d{5}|\\d{3}[\\s-]?\\d{3})|\\d{5}\\)?[\\s-]?\\d{4,5}|8(?:00[\\s-]?11[\\s-]?11|45[\\s-]?46[\\s-]?4\\d))(?:(?:[\\s-]?(?:x|ext\\.?\\s?|\\#)\\d+)?)$/" required><form-error ng-if="Membership.controls.invitationErrors.mobileNumber && checkInvitation.mobileNumber.$error.required">Please fill in your mobile number.&nbsp;<strong>Cloakroom</strong>&nbsp;respects your privacy;&nbsp;<strong>only</strong>&nbsp;event hosts that&nbsp;<strong>you</strong>&nbsp;choose to link to will have access.</form-error><form-error ng-hide=!Membership.controls.invitationErrors.mobileNumber ng-if="checkInvitation.mobileNumber.$dirty && checkInvitation.mobileNumber.$error.pattern">That Mobile Number seems invalid. Please check and try again.</form-error><input type=submit class=formSubmit value="Check Invite" ng-class="{unfilled:checkInvitation.invitedby.$error.required || checkInvitation.mobileNumber.$error.required}" ng-click=Membership.controls.showInviteErrors() ng-disabled=Membership.controls.checkDisabled></form></div><div ng-if=Membership.controls.showForm><form ng-submit=createMembership() name=membershipForm novalidate><h3>You</h3><input placeholder="First Name" ng-model=Membership.newMember.firstName name=firstname ng-minlength=3 ng-maxlength=11 name-input ng-pattern="/^[A-Za-z ]+$/" required ng-change="hideErrors(\'firstname\')"><form-error ng-show="membershipForm.firstname.$error.required && Membership.controls.error.firstname">Missing!</form-error><form-error ng-show="membershipForm.firstname.$error.minlength &&  Membership.controls.error.firstname">Too Short!</form-error><form-error ng-show="membershipForm.firstname.$error.maxlength &&  !membershipForm.firstname.$pristine">Too long!</form-error><form-error ng-show="membershipForm.firstname.$error.pattern &&  !membershipForm.firstname.$pristine">Alphabetical characters only, please.</form-error><input placeholder="Last Name" ng-model=Membership.newMember.lastName ng-minlength=2 ng-maxlength=26 name=lastname ng-pattern="/^[A-Za-z ]+$/" ng-change="hideErrors(\'lastname\')" name-input=once required><form-error ng-show="membershipForm.lastname.$error.required && Membership.controls.error.lastname">Please fill this in!</form-error><form-error ng-show="membershipForm.lastname.$error.minlength &&  Membership.controls.error.lastname">Too Short!</form-error><form-error ng-show="membershipForm.lastname.$error.maxlength &&  !membershipForm.lastname.$pristine">Too long!</form-error><form-error ng-show="membershipForm.lastname.$error.pattern &&  !membershipForm.lastname.$pristine">Alphabetical characters only, please.</form-error><input type=email placeholder="Email Address" ng-model=Membership.newMember.email name=email required><form-error ng-show="membershipForm.email.$error.email && !membershipForm.email.$pristine">Invalid email address</form-error><div ng-if=!Membership.controls.mobileVerified id=form-mobile><input placeholder="Mobile No." ng-model=Membership.newMember.mobileNumber name=mobile required></div><input type=radio ng-model=Membership.newMember.isFemale ng-value=false id=male value=false ng-change=clickGender()><label for=male class=male><i class=cr-i-male></i></label><input type=radio ng-model=Membership.newMember.isFemale ng-value=true id=female value=true ng-change=clickGender()><label for=female class=female><i class=cr-i-female></i></label><h3>Security</h3><input placeholder="Invited By (Alias or Mobile)" ng-hide=Membership.controls.invitedByPrefilled ng-model=Membership.newMember.invitedBy name=invitedby ng-disabled=Membership.controls.invitedByPrefilled required><form-error ng-show="membershipForm.invitedBy.$error.required && Membership.controls.error.invitedBy">Missing!</form-error><input id=pw1 type=password placeholder=Password ng-model=Membership.newMember.password ng-minlength=4 ng-maxlength=32 name=password ng-change="hideErrors(\'password\')" required><form-error ng-show="membershipForm.password.$error.required && Membership.controls.error.password">Missing!</form-error><form-error ng-show="membershipForm.password.$error.minlength &&  Membership.controls.error.password">Too Short!</form-error><form-error ng-show="membershipForm.password.$error.maxlength &&  !membershipForm.password.$pristine">Too long!</form-error><input id=pw2 type=password placeholder="Confirm Password" ng-model=Membership.newMember.confirmPassword name=confirm ng-change="hideErrors(\'confirm\')" pw-check=pw1 required> <span class=form-error-text ng-show="membershipForm.confirm.$error.pwmatch && !membershipForm.password.$pristine && !membershipForm.confirm.$pristine">does not match</span> <input type=submit id=create-membership value="{{membershipForm.$invalid ? \'Form Incomplete\' : \'Continue\'}}" class=button ng-class={unfilled:membershipForm.$invalid}></form></div></div><div class=info-page ng-if=Membership.controls.invitation.taken><i class=cr-i-alert></i><h1>Taken!</h1><p>That&nbsp;<str>cloakroom</str>&nbsp;invitation has already been used!</p><p>If you are the recipient, or got here accidentally, try logging in.</p><a ui-sref=login>Login</a></div><div class=info-page ng-if=Membership.controls.invitation.processed><i class=cr-i-heart></i><h1>Welcome</h1><p>Welcome!</p><p>Your new membership is ready.</p><a ui-sref=home>Member Home</a></div><div class=info-page ng-if=Membership.controls.invitation.processing><i class=cr-i-heart></i><h1>Just a second...</h1><p>Your membership should be active shortly.</p><p>Thank you for your patience.</p><a ui-sref=home>Continue to Member Home</a></div><div class=info-page ng-if=Membership.controls.invitation.error><i class=cr-i-alert2></i><h1>Oh no!</h1><p>We were unable to find any membership invitation matching your request.</p><p>If you got here by mistake, please login.</p><a ui-sref=home>Login / Member Home</a></div><div class=info-page ng-if=!Membership.canLogin><i class=cr-i-alert2></i><h1>Disable Private Browsing</h1><p>Please turn off private browing and reload this page.</p></div>'),a.put("views/membership/new/choose-alias.html",'<div id=confirm-container><h1>Welcome, {{newMember.firstName}}!</h1><h2>Choose Your Alias</h2><p class=aboveInput>As a new<str>cloakroom</str>member, you should pick an <span class=alias>alias</span></p><form name=chooseAlias novalidate ng-submit=createMember()><input name=choice ng-model=alias ng-maxlength=16 ng-minlength=5 cloakroom-alias ng-change=status.hideAvailability() placeholder="how will you be known?" required> <span class=availability ng-show="!chooseAlias.choice.$pristine && showAvailability && chooseAlias.choice.$valid" ng-class={available:status.isAvailable}><i class=cr-i-alert2 ng-if=!status.isAvailable></i> alias is<str>{{status.isAvailable ? "available!" : "taken"}}</str></span><form-error ng-show="!chooseAlias.choice.$pristine && chooseAlias.choice.$error.minlength">5+ characters, please!</form-error><form-error ng-show="!chooseAlias.choice.$pristine && chooseAlias.choice.$error.maxlength">Less than 16 characters, please!</form-error><form-error ng-show="!chooseAlias.choice.$pristine && chooseAlias.choice.$error.cloakroomAlias && chooseAlias.choice.length > 0">No numbers, spaces or symbols, sorry!</form-error><p class=belowInput>We<str>protect</str>your full name\'s privacy.<br>It may be useful to share your<str>alias</str>with others.</p><div ng-if=!status.signingUp><input type=submit class=button value={{Alias.button.message}} ng-disable=chooseAlias.$invalid ng-class="{\'unfilled\':!chooseAlias.choice.$valid || !status.isAvailable, \'ready\': Alias.status.isAvailable}"></div><mini-loading-bar ng-if=status.signingUp></mini-loading-bar></form></div>'),a.put("views/membership/new/confirm-mobile.html","<div id=confirm-container><h1>Confirm Mobile</h1><p>Welcome,<str>{{newMember.firstname}}!</str></p><input ng-model=newMember.mobile ng-maxlength=11 ng-minlength=11 ng-required> <span class=help>we will<str>never</str>share your number outside of cloakroom</span><p><str>cloakroom</str>uses your phone number to help you communicate and protect your identity</p><div class=button>Continue</div></div>"),a.put("views/menu.html",'<div class=container-fluid id=menu-container ng-controller="MenuCtrl as Menu" ng-if=currentUser.isLogged><div class=row><div id=menu-user class=col-xs-12><div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 clickable" id=photo ng-click=GoTo.profilePhotoPicker()><profile-photo ng-if=Menu.status.has.photo image="{{generatePhotoUrl({photoFileInfo: currentUser.photoFileInfo, size: \'medium\'})}}"></profile-photo><photo-placeholder ng-if=!Menu.status.has.photo female=currentUser.isFemale></photo-placeholder></div><div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" id=details><h2>Logged in as:</h2><p class=name>{{currentUser.firstName}} {{currentUser.lastName}}</p><p class=alias>~{{currentUser.alias}}</p><a ng-href=member/{{currentUser.username}}>view profile</a></div></div></div><div class=row ng-if="notifications.unseenCount > 0 && Menu.status.has.notifications"><h2 id=menu-notifications-header>Notifications<label id=menu-notifications-count ng-if="notifications.unseenCount > 0 && Menu.status.has.notifications">{{notifications.unseenCount}}</label></h2></div><div class=row id=notifications-container ng-if="notifications.count > 0 && Menu.status.has.notifications"><div id=menu-notifications scrollable=""><notification-item ng-repeat="notification in notifications.all" ng-if=!notification.data.attributes.dismissed><div class="col-xs-12 notification-details" ng-if=!notification.data.attributes.dismissed><h3 ng-click=Menu.controls.viewNotification(notification)><i class=importance ng-class="{\'max\': notification.important, \'cr-i-alert\': notification.important, \'min\': !notification.important, \'seen\': notification.data.attributes.seen}"></i> <span ng-if="notification.type === \'ACTION_REQUIRED\'">{{generateTitle(\'ACTION_REQUIRED\', notification.data.attributes.actionRequired)}}</span> <span ng-if="notification.type === \'GUESTLIST_ACCEPTED\'"><i class="cr-i-tick green"></i>{{generateTitle(\'GUESTLIST_ACCEPTED\', \'none\')}}</span> <span class=seenIndicator ng-if=!notification.data.attributes.seen>&nbsp;new</span></h3><p ng-click="Menu.controls.viewNotification(notification, $index)">{{generateNotificationText(notification)}}</p></div><div class="col-xs-12 notification-time" ng-if=!notification.data.attributes.dismissed><span precise-time-difference={{notification.data.attributes.notificationDate}}></span></div></notification-item></div></div><div class="row menu-button" id=home ng-click=GoTo.home()><div class=col-xs-12><i class=cr-i-home></i>&nbsp;Home</div></div><div class="row menu-button" id=about ng-click=GoTo.about()><div class=col-xs-12><i class=cr-i-questionmark></i>&nbsp;About</div></div><div class="row menu-button" id=options ng-click=GoTo.options()><div class=col-xs-12><i class=cr-i-settings></i>&nbsp;Account Settings</div></div><div id=menu-logout class="row menu-button" ng-click=logout()><div class=col-xs-12><i class=cr-i-closewindow></i>&nbsp;logout</div></div></div>'),a.put("views/options.html",'<div class=container><div class=row><h1>Account Settings</h1><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">Column 1</div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">Column 2</div></div></div>'),a.put("views/options/profile-photo.html",'<div class=container-fluid id=choose-photo><div class=row><div class=col-xs-12><h1>Choose Profile Photo</h1></div></div><div class=row><div class=col-xs-12><div id=profile-picker><div id=clickable ng-click=picker.openDialog()><profile-photo ng-if="(picker.vm.controls.testing || (!picker.vm.controls.photoUrl && picker.vm.photoExists !== false))" image={{picker.vm.photo}}></profile-photo><photo-placeholder female=picker.vm.user.isFemale ng-if="picker.vm.controls.testing || (!picker.vm.photoExists)"></photo-placeholder></div><div class=picker-width><label class=instructions><strong>Tap/Click</strong> to Select a New Profile Photo</label><p id=privacy>Your profile photo will be visible to other members.</p></div><input type=hidden role=uploadcare-uploader data-crop="200x200 minimum" data-images-only=true data-preview-step=true data-multiple-min=1 data-multiple-max=1></div></div></div><div class=row><div class=col-xs-12><div class=picker-width><button type=button class="btn btn-success btn-lg btn-block" ng-click=picker.finish()>Save Changes</button></div></div></div></div>'),a.put("views/partials/cloakroom-header.html",'<nav id=cloakroom-header><div class=button-group ng-if=showMenuButton id=menu><button id=nav-menu-button ng-click=toggleMenu()><a><i class=cr-i-menu></i></a></button><div id=nav-notifications ng-if="notifications.unseenCount > 0 && status.has.notifications" ng-hide="menuOpen || isViewLoading || hideNotifications || notifications.count === 0 || notifications.unseenCount === 0">{{notifications.unseenCount}}</div><label id=menu-label for=nav-menu-button>menu</label></div><header class="cloakroom-logo logo-header" ng-click=goHome()></header><div ng-if=showingHomeButton ng-click=goHome() class=button-group id=home><button id=nav-home-button><a href=# ng-click=goHome()><i class=cr-i-home></i></a></button><label id=home-label for=nav-home-button>home</label></div></nav>'),a.put("views/partials/cloakroom-logo.html",'<header class="cloakroom-logo logo-large"></header>'),a.put("views/partials/editApplicationForm.html",'<form name=editForm class=form-horizontal ng-submit=saveApplication() novalidate><div class=control-group><label class=control-label for=inputName>Name</label><div class=controls><input style=width:97% id=inputName ng-model=editedApplication.name placeholder=Name required></div></div><div class=control-group><label class=control-label for=inputReason>Reason</label><div class=controls><input style=width:97% id=inputReason ng-model=editedApplication.reason placeholder=Reason required></div></div><div class=control-group><div class=controls><button type=submit ng-disabled=editForm.$invalid class="btn btn-block btn-large btn-success">Save To Parse</button></div></div></form>'),a.put("views/partials/modals/error.html","<div id=modal-overlay><h1>{{errorTitle}}</h1><p>{{errorText}}</p><div class=buttons-container><a class=button ng-if=extraLink.show ng-href=extraLink.url>{{extraLink.text}}</a><div class=button ng-click=close()>Got it.</div></div></div><div id=modal-fade></div>"),a.put("views/partials/modals/form.html",'<div class=modal-header><button type=button class=close ng-click=dismiss(false) data-dismiss=modal aria-hidden=true>&times;</button><h4 class=modal-title>{{title}}</h4></div><div class=modal-body><p ng-bind-html=text></p><p class=extra-link ng-if=extraLink.show>{{extraLink.preMessage}}: <a ng-href={{extraLink.href}}>{{extraLink.text}}</a></p><form class=form-horizontal role=form><div class=form-group><label for=name class="col-sm-2 control-label">{{firstInput}}</label><div class=col-sm-10><input class=form-control placeholder={{firstInputPlaceholder}} ng-model=data.firstInput></div></div><div class=form-group ng-if=showTwoInputs><label for=age class="col-sm-2 control-label">{{secondInput}}</label><div class=col-sm-10><input class=form-control placeholder={{secondInputPlaceholder}} ng-model=data.secondInput></div></div></form></div><div class=modal-footer><button type=button ng-click=cancel(false) class="btn btn-default" data-dismiss=modal>{{noText}}</button> <button type=button ng-click=ok(true) class="btn btn-primary" data-dismiss=modal>{{yesText}}</button></div>'),a.put("views/partials/modals/yesno.html",'<div class=modal-header><button type=button class=close ng-click=dismiss(false) data-dismiss=modal aria-hidden=true>&times;</button><h4 class=modal-title>{{title}}</h4></div><div class=modal-body><p ng-bind-html=text></p><p class=extra-link ng-if=extraLink.show>{{extraLink.preMessage}} <a ng-click=goToExtraLink()>{{extraLink.text}}</a></p></div><div class=modal-footer><button type=button ng-click=cancel(false) class="btn btn-danger" data-dismiss=modal ng-if=showNoButton>{{noText}}</button> <button type=button ng-click=ok(true) class="btn btn-success" data-dismiss=modal ng-if=showNoButton>{{yesText}}</button> <button type=button ng-click=ok(true) class="btn btn-primary" data-dismiss=modal ng-if=!showNoButton>{{yesText}}</button></div>'),a.put("views/partials/old/guest.html",'<div class=guestlist-item><div class=guestlist-item-main ng-class="{female: {{guest.is_female}}}"><div class=guestlist-item-pic ng-class="{female: {{guest.is_female}}}"><img ng-src="img/square/{{guest.name + guest.lastname | lowercase}}.jpg" alt="{{guest.name}} {{guest.lastname}}"></div><div class=guestlist-item-name>{{guest.name}}</div><div class=guestlist-item-phone>{{guest.mobile_number}}</div></div><button class=guestlist-item-checkin></button></div>'),a.put("views/partials/old/guestlist.html",'<night-details></night-details><promoter-dashboard></promoter-dashboard><guest ng-repeat="guest in guests"></guest>'),a.put("views/partials/old/night-details.html","<div id=guestlist-details><h2>Mahiki Monday</h2><span class=guestlist-countdown><strong>1</strong> day, <strong>3</strong> hours, <strong>37</strong> minutes Away.</span></div><div id=guestlist-stats><h3><strong>47</strong> Guests</h3><p><span class=male-base>12M</span> <span class=female-base>25F</span> <span class=plus-base>10+</span></p></div>"),a.put("views/partials/old/promoter-dashboard.html","<div id=guestlist-promoter-shortcuts><div id=guestlist-addguest-shortcut><div id=guestlist-addguest-notifications><p>4</p></div><p>Add</p></div><div id=guestlist-shout-shortcut><p>Shout</p></div><div id=guestlist-settings-shortcut><p>Settings</p></div></div>"),a.put("views/partials/profile-photo.html",'<div id=profile-dp><img ng-src={{image}} alt="{{firstName}} {{lastName}}"><div ng-transclude></div></div>'),a.put("views/privacy-policy.html",'<div class="container infopage legal"><h1>Privacy Policy</h1><div class=row><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><h2 id=background>Background</h2><p class=text-left>This privacy policy applies between you, the User of this Website and Cloakroom Ltd, the owner and provider of this Website. Cloakroom Ltd takes the privacy of your information very seriously. This privacy policy applies to our use of any and all Data collected by us or provided by you in relation to your use of the Website. Please read this privacy policy carefully.</p><h2 id=definitionsandinterpretation>Definitions and Interpretation</h2><ol><li>In these privacy policy, the following definitions are used:<ul><li><strong>Content</strong><ul><li>any text, graphics, images, audio, video, software, data compilations, page layout, underlying code and software and any other form of information capable of being stored in a computer that appears on or forms part of this Website;</li></ul></li><li><strong>Data</strong><ul><li>a small text file placed on your computer by this Website when you visit certain parts of the Website and/or when you use certain features of the Website. Details of the cookies used by this Website are set out in the clause below (Cookies);</li></ul></li><li><strong>Cloakroom Ltd</strong>, <strong>we</strong>, or <strong>our</strong><ul><li>the owner and operator of the Website known as Cloakroom Ltd, as identified at the end of these terms and conditions;</li></ul></li><li><strong>UK and EU Cookie Law</strong><ul><li>the Privacy and Electronic Communications (EC Directive) Regulations 2003 as amended by the Privacy and Electronic Communications (EC Directive) (Amendment) Regulations 2011;</li></ul></li><li><strong>Service</strong><ul><li>collectively any online facilities, tools, services or information that Cloakroom Ltd makes available through the Website either now or in the future;</li></ul></li><li><strong>System</strong><ul><li>any online communications infrastructure that Cloakroom Ltd makes available through the Website either now or in the future. This includes, but is not limited to, web-based email, message boards, live chat facilities and email links;</li></ul></li><li><strong>User</strong>/__Users__ or <strong>you</strong><ul><li>any third party that accesses the Website and is not either (i) employed by Cloakroom Ltd and acting in the course of their employment or (ii) engaged as a consultant or otherwise providing services to Cloakroom Ltd and accessing the Website in connection with the provision of such services; and</li></ul></li><li><strong>Website</strong><ul><li>the website that you are currently using, http://cloakroom.me, and any sub-domains of this site unless expressly excluded by their own terms and conditions.</li></ul></li></ul></li><li>In these terms and ocnditions, unless the context requires a different interpretation:<ul><li>the singular includes the plural and vice versa;</li><li>references to sub-clauses, clauses, schedules or appendices are to sub-clauses, clauses, schedules or appendices of these terms and conditions;</li><li>a reference to a person includes firms, companies, government entities, trusts and partnerships;</li><li>&#8216;including&#8217; is understood to mean &#8216;including without limitation&#8217;;</li><li>reference to any statutory provision includes any modification or amendment of it;</li><li>the headings and sub-headings do not form part of these terms and conditions.</li></ul></li></ol><p>Scope of this privacy policy</p><p>This privacy policy applies only to the actions of Cloakroom Ltd and Users with respect to this Website. It does not extend to any websites that can be accessed from this Website including, but not limited to, any links we may provide to social media websites.</p><h2 id=datacollected>Data collected</h2><ul><li>We may collect the following Data, which includes personal Data, from you:<ul><li>Name</li><li>Date of Birth;</li><li>Gender;</li><li>Contact Information such as email addresses and telephone numbers;</li><li>Demographic information such as post code, preferences and interests;</li><li>IP address (automatically collected);</li><li>Web browser type and version (automatically collected);</li><li>Operating system (automatically collected);</li><li>contacts lists</li><li>linked users</li><li>venue check-ins</li><li>user-to-user communications</li><li>guest lists</li><li>guestlist applications and entries</li><li>user photos (uploaded to or otherwise provided to Cloakroom by the user themselves)</li><li>user photos (imported from third parties at the user&apos;s request)</li><li>contact telephone details</li></ul></li><li>in each case above, in accordance with this privacy policy.</li></ul><h2 id=ouruseofdata>Our use of Data</h2><ul><li><p>For purposes of the Data Protection Act 1998, Cloakroom Ltd is the &#8220;data controller&#8221;.</p></li><li><p>We will retain any Data you submit for 1 month.</p></li><li>Data required for the site to function and to serve you will be kept for longer than 1 month. This includes, but is not limited to:<ul><li>Your alias.</li><li>Your password.</li><li>Your first name.</li><li>Your last name.</li><li>Your profile photo.</li><li>Your applications to guestlists.</li><li>Your mobile number.</li><li>Whether that mobile number is verified or not.</li><li>Who you are &#8220;linking&#8221;.</li></ul></li><li><p>Unless we are obliged or permitted by law to do so, and subject to any third party disclosures specifically set out in this policy, your Data will not be disclosed to third parties. This includes our affiliates and / or other companies within our group.<br>All personal Data is stored securely in accordance with the principles of the Data Protection Act 1998. For more details on security see the clause below (Security).</p></li><li>Any or all of the above Data may be required by us from time to time in order to provide you with the best possible service and experience when using our Website. Specifically, Data may be used by us for the following reasons:<ul><li>internal record keeping;</li><li>improvement of our products / services;</li><li>contact for market research purposes which may be done using email, telephone, fax or mail. Such information may be used to customise or update the Website;</li><li>delivery of the Cloakroom platform and service;</li><li>in each case, in accordance with this privacy policy.</li></ul></li></ul><h2 id=thirdpartywebsitesandservices>Third party websites and services</h2><ul><li>Cloakroom Ltd may, from time to time, employ the services of other parties for dealing with certain processes necessary for the operation of the Website. The providers of such services do not have access to certain personal Data provided by Users of this Website.</li></ul><h2 id=linkstootherwebsites>Links to other websites</h2><ul><li>This Website may, from time to time, provide links to other websites. We have no control over such websites and are not responsible for the content of these websites. This privacy policy does not extend to your use of such websites. You are advised to read the privacy policy or statement of other websites prior to using them.</li></ul><h2 id=changesofbusinessownershipandcontrol>Changes of business ownership and control</h2><ul><li>Cloakroom Ltd may, from time to time, expand or reduce our business and this may involve the sale and/or the transfer of control of all or part of Cloakroom Ltd. Data provided by Users will, where it is relevant to any part of our business so transferred, be transferred along with that part and the new owner or newly controlling party will, under the terms of this privacy policy, be permitted to use the Data for the purposes for which it was originally supplied to us.</li><li>We may also disclose Data to a prospective purchaser of our business or any part of it.</li><li>In the above instances, we will take steps with the aim of ensuring your privacy is protected.</li></ul><h2 id=controllinguseofyourdata>Controlling use of your Data</h2><ul><li>Wherever you are required to submit Data, you will be given options to restrict our use of that Data. This may include the following:<ul><li>use of Data for direct marketing purposes; and</li><li>sharing Data with third parties.</li><li>Functionality of the Website</li></ul></li><li><p>To use all features and functions available on the Website, you may be required to submit certain Data.<br>You may restrict your internet browser&#8217;s use of Cookies. For more information see the clause below (Cookies).</p></li></ul><h2 id=accessingyourowndata>Accessing your own Data</h2><p>You have the right to ask for a copy of any of your personal Data held by Cloakroom Ltd (where such Data is held) on payment of a small fee, which will not exceed £10.</p><h2 id=security>Security</h2><p>Data security is of great importance to Cloakroom Ltd and to protect your Data we have put in place suitable physical, electronic and managerial procedures to safeguard and secure Data collected via this Website.<br>If password access is required for certain parts of the Website, you are responsible for keeping this password confidential.<br>We endeavour to do our best to protect your personal Data. However, transmission of information over the internet is not entirely secure and is done at your own risk. We cannot ensure the security of your Data transmitted to the Website.</p><h2 id=cookies>Cookies</h2><ul><li>This Website may place and access certain Cookies on your computer. Cloakroom Ltd uses Cookies to improve your experience of using the Website and to improve our range of services. Cloakroom Ltd has carefully chosen these Cookies and has taken steps to ensure that your privacy is protected and respected at all times.</li><li>All Cookies used by this Website are used in accordance with current UK and EU Cookie Law.</li><li>Before the Website places Cookies on your computer, you will be presented with a message bar requesting your consent to set those Cookies. By giving your consent to the placing of Cookies, you are enabling Cloakroom Ltd to provide a better experience and service to you. You may, if you wish, deny consent to the placing of Cookies; however certain features of the Website may not function fully or as intended.</li><li>This Website may place the following Cookies:</li></ul><table><colgroup><col style=text-align:left><col style=text-align:left></colgroup><thead><tr><th style=text-align:left>Type of Cookie</th><th style=text-align:left>Purpose</th></tr></thead><tbody><tr><td style=text-align:left>Strictly Necessary Cookies</td><td style=text-align:left>These are cookies that are required for the operation of our website. They include, for example, cookies that enable you to log into secure areas of our website, use a shopping cart or make use of e-billing services.</td></tr><tr><td style=text-align:left>Functionality Cookies</td><td style=text-align:left>These are used to recognise you when you return to our website. This enables us to personalise our content for you, greet you by name and remember your preferences (for example, your choice of language or region).</td></tr></tbody></table><ul><li>You can choose to delete Cookies at any time; however you may lose any information that enables you to access the Website more quickly and efficiently including, but not limited to, personalisation settings.</li><li>It is recommended that you ensure that your internet browser is up-to-date and that you consult the help and guidance provided by the developer of your internet browser if you are unsure about adjusting your privacy settings.</li></ul><h2 id=transfersoutsidetheeuropeaneconomicarea>Transfers outside the European Economic Area</h2><ul><li><p>Data which we collect from you may be stored and processed in and transferred to countries outside of the European Economic Area (EEA). For example, this could occur if our servers are located in a country outside the EEA or one of our service providers is situated in a country outside the EEA. We also share information with our group companies, some of which are located outside the EEA. These countries may not have data protection laws equivalent to those in force in the EEA.</p></li><li><p>If we transfer Data outside the EEA in this way, we will take steps with the aim of ensuring that your privacy rights continue to be protected as outlined in this privacy policy. You expressly agree to such transfers of Data.</p></li></ul><h2 id=general>General</h2><ul><li><p>You may not transfer any of your rights under this privacy policy to any other person. We may transfer our rights under this privacy policy where we reasonably believe your rights will not be affected.</p></li><li><p>If any court or competent authority finds that any provision of this privacy policy (or part of any provision) is invalid, illegal or unenforceable, that provision or part-provision will, to the extent required, be deemed to be deleted, and the validity and enforceability of the other provisions of this privacy policy will not be affected.</p></li><li><p>Unless otherwise agreed, no delay, act or omission by a party in exercising any right or remedy will be deemed a waiver of that, or any other, right or remedy.</p></li><li><p>This privacy policy is governed by and interpreted according to English law. All disputes arising under this privacy policy are subject to the exclusive jurisdiction of the English courts.</p></li></ul><h2 id=changestothisprivacypolicy>Changes to this privacy policy</h2><ul><li>Cloakroom Ltd reserves the right to change this privacy policy as we may deem necessary from time to time or as may be required by law. Any changes will be immediately posted on the Website and you are deemed to have accepted the terms of the privacy policy on your first use of the Website following the alterations.</li></ul><h2 id=cloakroomltddetails>Cloakroom Ltd details</h2><ul><li><strong>Cloakroom Ltd</strong> operates the Website http://cloakroom.me.</li><li><strong>Cloakroom Ltd</strong> is a company incorporated in England and Wales with registered number 08612801 whose registered address is 10 Grass Park, Finchley, N3 1UB.</li></ul><p>You can contact Cloakroom Ltd by email on <a href=mailto:team@cloakroom.me>team@cloakroom.me</a></p></div></div></div>'),a.put("views/settings.html",'<div ng-cloak></div><div class="container infopage" ng-show=!isViewLoading><div class=row><h1>Account Settings</h1><div class="col-xs-0 col-md-2"><br></div><div class="col-xs-12 col-md-8"><ul class=list-group><li class="list-group-item button" ng-click="goTo.path(\'/my-links\')">My <strong>Links</strong></li><li class="list-group-item button" ng-click="goTo.path(\'/edit-profile\')">Edit <strong>Personal Details</strong></li><li ng-click=goTo.profilePhotoPicker() class="list-group-item button">Choose <strong>Profile Picture</strong></li><li class="list-group-item button" ng-click="goTo.path(\'/verify-mobile/\')" ng-if=!currentUser.verifiedMobileNumber>Verify Mobile Number</li><li class="list-group-item button" ng-click="goTo.path(\'/change-password\')">Change <strong>Password</strong></li><li class="list-group-item button" ng-click=fb.button()><span ng-if=!fb.processing>{{fb.isLinked ? "Unlink" : "Connect"}}&nbsp;<strong>Facebook Account</strong></span><span ng-if=fb.processing>{{fb.isLinked ? "Unlinking" : "Connecting"}}...</span></li></ul><ul class=list-group><a href=mailto:team@cloakroom.me><li class="list-group-item button">Contact Us</li></a></ul><ul class=list-group><li class="list-group-item button" ng-click="goTo.path(\'/legal\')">Legal</li></ul></div><div class="col-xs-0 col-md-2"><br></div></div></div>'),a.put("views/tanc.html",'<div class="container infopage"><h1>Legal</h1><div class=row><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><h2>T&C and Privacy Policy</h2>You must Agree to our <a ui-sref=tandc>Terms and Conditions</a> to sign up and use Cloakroom. For information on our Privacy Policy, <a ui-sref=privacypolicy>click here</a>.</div></div><div class=row><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><h2>Credits</h2><p>The **Cloakroom** service is a production of **Cloakroom**, a North-London based company founded by <a href=#/members/rai>Rai Butera</a>.</p><p>Cloakroom would like to thank the following for their assistance, contribution and support in creating a memorable experience for its members:</p></div></div></div>'),a.put("views/tandc.html",'<div class="container infopage legal"><h1>Privacy Policy</h1><div class=row><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><h2 id=background>Background</h2><p>These terms and conditions apply between you, the User of this Website, and Cloakroom Ltd, the owner(s) of this Website. Please read these terms and conditions carefully, as they affect your legal rights. Your agreement to comply with and be bound by these terms and conditions is deemed to occur upon your first use of the Website. If you do not agree to be bound by these terms and conditions, you should stop using the Website immediately.</p><p>You must be at least 18 years of age to use this Website. By using the Website and agreeing to these terms and conditions, you represent and warrant that you are at least 18 years of age.</p><h2 id=definitionsandinterpretation>Definitions and Interpretation</h2><ol><li>In these terms and conditions, the following definitions are used:<ul><li><strong>Content</strong><ul><li>any text, graphics, images, audio, video, software, data compilations, page layout, underlying code and software and any other form of information capable of being stored in a computer that appears on or forms part of this Website;</li></ul></li><li><strong>Cloakroom Ltd</strong>, <strong>we</strong>, or <strong>our</strong><ul><li>the owner and operator of the Website known as Cloakroom Ltd, as identified at the end of these terms and conditions;</li></ul></li><li><strong>Service</strong><ul><li>collectively any online facilities, tools, services or information that Cloakroom Ltd makes available through the Website either now or in the future;</li></ul></li><li><strong>System</strong><ul><li>any online communications infrastructure that Cloakroom Ltd makes available through the Website either now or in the future. This includes, but is not limited to, web-based email, message boards, live chat facilities and email links;</li></ul></li><li><strong>User</strong>/__Users__ or <strong>you</strong><ul><li>any third party that accesses the Website and is not either (i) employed by Cloakroom Ltd and acting in the course of their employment or (ii) engaged as a consultant or otherwise providing services to Cloakroom Ltd and accessing the Website in connection with the provision of such services; and</li></ul></li><li><strong>Website</strong><ul><li>the website that you are currently using http://cloakroom.me and any sub-domains of this site, unless expressly excluded by their own terms and conditions.</li></ul></li></ul></li><li>In these terms and conditions, unless the context requires a different interpretation:<ul><li>the singular includes the plural and vice versa;</li><li>references to sub-clauses, clauses, schedules or appendices are to sub-clauses, clauses, schedules or appendices of these terms and conditions;</li><li>a reference to a person includes firms, companies, government entities, trusts and partnerships;</li><li>&#8216;including&#8217; is understood to mean &#8216;including without limitation&#8217;;</li><li>reference to any statutory provision includes any modification or amendment of it;</li><li>the headings and sub-headings do not form part of these terms and conditions.</li></ul></li></ol><h2 id=intellectualpropertyandacceptableuse>Intellectual property and acceptable use</h2><ul><li><p>All Content included on the Website, unless uploaded by Users, is the property of Cloakroom Ltd, our affiliates or other relevant third parties. By continuing to use the Website you acknowledge that such Content is protected by copyright, trademarks, database rights and other intellectual property rights. Nothing on this site shall be construed as granting, by implication, estoppel, or otherwise, any license or right to use any trademark, logo or service mark displayed on the site without the owner&#8217;s prior written permission</p></li><li>You may, for your own personal, non-commercial use only, do the following:<ul><li>retrieve, display and view the Content on a computer screen</li><li>download and store the Content in electronic form on a disk (but not on any server or other storage device connected to a network)</li><li>print one copy of the Content</li></ul></li><li><p>You must not otherwise reproduce, modify, copy, distribute or use for commercial purposes any Content without the written permission of Cloakroom Ltd.</p></li><li><p>You acknowledge that you are responsible for any Content you may submit via the Website, including the legality, reliability, appropriateness, originality and copyright of any such Content. You may not upload to, distribute or otherwise publish through the Website any Content that (i) is confidential, proprietary, false, fraudulent, libellous, defamatory, obscene, threatening, invasive of privacy or publicity rights, infringing on intellectual property rights, abusive, illegal or otherwise objectionable; (ii) may constitute or encourage a criminal offence, violate the rights of any party or otherwise give rise to liability or violate any law; or (iii) may contain software viruses, political campaigning, chain letters, mass mailings, or any form of &#8220;spam.&#8221;</p></li><li><p>You may not use a false email address or other identifying information, impersonate any person or entity or otherwise mislead as to the origin of any content. You may not upload commercial content onto the Website.</p></li><li><p>You represent and warrant that you own or otherwise control all the rights to the Content you post; that the Content is accurate; that use of the Content you supply does not violate any provision of these terms and conditions and will not cause injury to any person; and that you will indemnify Cloakroom Ltd for all claims resulting from Content you supply.</p></li></ul><h2 id=prohibiteduse>Prohibited use</h2><ul><li><p>You may not use the Website for any of the following purposes:</p></li><li><p>in any way which causes, or may cause, damage to the Website or interferes with any other person&#8217;s use or enjoyment of the Website; in any way which is harmful, unlawful, illegal, abusive, harassing, threatening or otherwise objectionable or in breach of any applicable law, regulation, governmental order; making, transmitting or storing electronic copies of Content protected by copyright without the permission of the owner.</p></li></ul><h2 id=registration>Registration</h2><ul><li><p>You must ensure that the details provided by you on registration or at any time are correct and complete.</p></li><li><p>You must inform us immediately of any changes to the information that you provide when registering by updating your personal details to ensure we can communicate with you effectively.</p></li><li><p>We may suspend or cancel your registration with immediate effect for any reasonable purposes or if you breach these terms and conditions.</p></li><li><p>You may cancel your registration at any time by informing us in writing to the address at the end of these terms and conditions. If you do so, you must immediately stop using the Website. Cancellation or suspension of your registration does not affect your statutory rights.</p></li></ul><h2 id=passwordandsecurity>Password and security</h2><ul><li><p>When you register on this Website, you will be asked to create a password, which you should keep confidential and not disclose or share with anyone.</p></li><li><p>If we have reason to believe that there is or is likely to be any misuse of the Website or breach of security, we may require you to change your password or suspend your account.</p></li></ul><h2 id=linkstootherwebsites>Links to other websites</h2><ul><li><p>This Website may contain links to other sites. Unless expressly stated, these sites are not under the control of Cloakroom Ltd or that of our affiliates.</p></li><li><p>We assume no responsibility for the content of such Websites and disclaim liability for any and all forms of loss or damage arising out of the use of them.</p></li><li><p>The inclusion of a link to another site on this Website does not imply any endorsement of the sites themselves or of those in control of them.</p></li></ul><h2 id=privacypolicy>Privacy Policy</h2><ul><li>Use of the Website is also governed by our Privacy Policy, which is incorporated into these terms and conditions by this reference. To view the Privacy Policy, please click on the following: http://legal.cloakroom.me/privacy.html.</li></ul><h2 id=availabilityofthewebsiteanddisclaimers>Availability of the Website and disclaimers</h2><ul><li><p>The Service is provided &#8220;as is&#8221; and on an &#8220;as available&#8221; basis. We give no warranty that the Service will be free of defects and/or faults. To the maximum extent permitted by the law, we provide no warranties (express or implied) of fitness for a particular purpose, accuracy of information, compatibility and satisfactory quality. Cloakroom Ltd is under no obligation to update information on the Website.</p></li><li><p>Whilst Cloakroom Ltd uses reasonable endeavours to ensure that the Website is secure and free of errors, viruses and other malware, we give no warranty or guaranty in that regard and all Users take responsibility for their own security, that of their personal details and their computers.</p></li><li><p>Cloakroom Ltd accepts no liability for any disruption or non-availability of the Website.</p></li><li><p>Cloakroom Ltd reserves the right to alter, suspend or discontinue any part (or the whole of) the Website including, but not limited to, any products and/or services available. These terms and conditions shall continue to apply to any modified version of the Website unless it is expressly stated otherwise.</p></li></ul><h2 id=limitationofliability>Limitation of liability</h2><ul><li><p>Nothing in these terms and conditions will: (a) limit or exclude our or your liability for death or personal injury resulting from our or your negligence, as applicable; (b) limit or exclude our or your liability for fraud or fraudulent misrepresentation; or (c) limit or exclude any of our or your liabilities in any way that is not permitted under applicable law.</p></li><li><p>We will not be liable to you in respect of any losses arising out of events beyond our reasonable control.</p><ul><li>To the maximum extent permitted by law, Cloakroom Ltd accepts no liability for any of the following:<ul><li>any business losses, such as loss of profits, income, revenue, anticipated savings, business, contracts, goodwill or commercial opportunities;loss or corruption of any data, database or software; any special, indirect or consequential loss or damage.</li></ul></li></ul></li></ul><h2 id=general>General</h2><ul><li><p>You may not transfer any of your rights under these terms and conditions to any other person. We may transfer our rights under these terms and conditions where we reasonably believe your rights will not be affected.</p></li><li><p>These terms and conditions may be varied by us from time to time. Such revised terms will apply to the Website from the date of publication. Users should check the terms and conditions regularly to ensure familiarity with the then current version.</p></li><li><p>These terms and conditions together with the Privacy Policy contain the whole agreement between the parties relating to its subject matter and supersede all prior discussions, arrangements or agreements that might have taken place in relation to the terms and conditions.</p></li><li><p>The Contracts (Rights of Third Parties) Act 1999 shall not apply to these terms and conditions and no third party will have any right to enforce or rely on any provision of these terms and conditions.</p></li><li><p>If any court or competent authority finds that any provision of these terms and conditions (or part of any provision) is invalid, illegal or unenforceable, that provision or part-provision will, to the extent required, be deemed to be deleted, and the validity and enforceability of the other provisions of these terms and conditions will not be affected.</p></li><li><p>Unless otherwise agreed, no delay, act or omission by a party in exercising any right or remedy will be deemed a waiver of that, or any other, right or remedy.</p></li><li><p>These terms and conditions will be governed by and interpreted according to English law. All disputes arising under these terms and conditions will be subject to the exclusive jurisdiction of the English courts.</p></li></ul><h2 id=cloakroomltddetails>Cloakroom Ltd details</h2><ul><li><strong>Cloakroom Ltd</strong> operates the Website http://cloakroom.me.</li><li><strong>Cloakroom Ltd</strong> is a company incorporated in England and Wales with registered number 08612801 whose registered address is 10 Grass Park, Finchley, N3 1UB.</li></ul><p>You can contact Cloakroom Ltd by email on <a href=mailto:team@cloakroom.me>team@cloakroom.me</a></p></div></div></div>'),a.put("views/test/test.html",'<button type=button class="btn btn-default" ng-click=test.switchPanel()>Switch Panel</button><div id=test-container><div id=testPanel ng-if=test.controls.showPanel><hr><h1>Test:</h1><input class="form-control test" placeholder="test option" ng-model=test.controls.option><div class="btn btn-danger" ng-click=test.setupTest(test.controls.option)>Setup</div><div class="btn btn-warning" ng-click=test.runTest(test.controls.option)>Run</div><div class="btn btn-success" ng-click=test.checkTest(test.controls.option)>Check</div><hr><div><h2>Run</h2>{{test.text.output}}<br><br><code>{{test.outputObject}}</code></div><hr><div><h2>Check</h2>{{test.text.check}}<br><br><code>{{test.checkObject}}</code></div></div><div id=UIsandbox ng-if=test.controls.UIsandbox ng-class={iPhone:test.controls.iPhone}><button type=button class="btn btn-danger" ng-click=close()>Close Modal</button> <button type=button class="btn btn-primary" ng-click=open()>Open Modal</button> <button type=button class="btn btn-info" ng-click="open(\'lg\')">Large</button>   </div></div>')
}]);